<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SLAMflex SE: libSLAMflex -  android project/jni/MapMaker.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../thumbnail.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SLAMflex SE
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">SLAMflex provides detection and tracking of dominant planes for smartphone devices. This plane can then be used to show AR content relative to the plane orientation. The detection of plane is performed in the field of view of the smartphone camera. In subsequent frames it is tracked. The interface returns the plane position and orientation.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_64138f433da6323d37c35d94c20fed44.html">libSLAMflex -  android project</a></li><li class="navelem"><a class="el" href="../../dir_f496a2d090f5040e1d0b8f142d0646a8.html">jni</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MapMaker.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dd/d72/a00541.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2008 Isis Innovation Limited</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/ddb/a00542.html">MapMaker.h</a>&quot;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/ddf/a00544.html">MapPoint.h</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d1a/a00485.html">Bundle.h</a>&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d95/a00556.html">PatchFinder.h</a>&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/dde/a00587.html">SmallMatrixOpts.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/db7/a00525.html">HomographyInit.h</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d6e/a00610.html">vector_image_ref.h</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/dc0/a00611.html">vision.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d44/a00527.html">image_interpolate.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/db1/a00590.html">SVD.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/dad/a00591.html">SymEigen.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#define WIN32_LEAN_AND_MEAN</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;windows.h&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../de/d85/a00618.html">CVD</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d4/d2a/a00632.html">std</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// Constructor sets up internal reference variable to Map.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// Most of the intialisation is done by Reset()..</span></div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a095e4e32cf2d29098f5ba6be201d9daf">   29</a></span>&#160;<a class="code" href="../../da/d2e/a00238.html#a095e4e32cf2d29098f5ba6be201d9daf">MapMaker::MapMaker</a>(<a class="code" href="../../d4/d08/a00237.html">Map</a>&amp; m, <span class="keyword">const</span> <a class="code" href="../../d0/d33/a00027.html">ATANCamera</a> &amp;cam)</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  : mMap(m), mCamera(cam)</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a919708e6565165405fd5370f0987d63d">mbResetRequested</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a1baa21c897468de2f9ee654a6438e8c9">Reset</a>();</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="../../d3/d29/a00419.html#a4b5bb123039054efc597f23b9d9e1cd8">start</a>(); <span class="comment">// This CVD::thread func starts the map-maker thread with function run()</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a4c687f57c614a609f7ec434cee0954de">mgvdWiggleScale</a>=<a class="code" href="../../dd/d4d/a00519.html#ad998045dffe4236d255e6da207a6bffb">MapMakerWiggleScale</a>; <span class="comment">// Default to 10cm between keyframes</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;};</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a1baa21c897468de2f9ee654a6438e8c9">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a1baa21c897468de2f9ee654a6438e8c9">MapMaker::Reset</a>()</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// This is only called from within the mapmaker thread...</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a59d9d701fafb7adf3e9754b7b14c8cc0">Reset</a>();</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.clear();</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">mqNewQueue</a>.empty()) <a class="code" href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">mqNewQueue</a>.pop();</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.clear(); <span class="comment">// TODO: actually erase old keyframes</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">mvpKeyFrameQueue</a>.clear(); <span class="comment">// TODO: actually erase old keyframes</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a8cfc18567123cd2d054a41c0a5731ec5">mbBundleRunning</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a9010241199b5b242ef3fb56f34c5c6d9">mbResetDone</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a919708e6565165405fd5370f0987d63d">mbResetRequested</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a99d08a8ec4f80cfa846ee7bd4da1e485">mbBundleAbortRequested</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a67a058274e28423ec9e771aa18192afd">counterForConvergenceLimit</a> = <a class="code" href="../../dd/d4d/a00519.html#aacce71097269c8b28177b653df0bb99b">CounterForConvergenceLimit</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a74990580eaf0e89c81dec004b262227b">   56</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a74990580eaf0e89c81dec004b262227b">MapMaker::SetSendMessageToUnity</a>(<a class="code" href="../../d7/ddb/a00361.html">SendMessage</a> sm)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a61c9bb8187e2197ff45dbcd7203b7810">sendStringToUnity</a> = sm;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">// CHECK_RESET is a handy macro which makes the mapmaker thread stop</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">// what it&#39;s doing and reset, if required.</span></div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">   64</a></span>&#160;<span class="preprocessor">#define CHECK_RESET if(mbResetRequested) {Reset(); continue;};</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a7d73ebc06bba5755f86e62aafa22e422">   66</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a7d73ebc06bba5755f86e62aafa22e422">MapMaker::run</a>()</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;{</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="../../d3/d29/a00419.html#a875f8d943ae1ca5b78fc5a388ac6107f">shouldStop</a>())  <span class="comment">// ShouldStop is a CVD::Thread func which return true if the thread is told to exit.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <a class="code" href="../../d3/d29/a00419.html#a4849f1e10df897f12f9efb89e054f6f2">sleep</a>(5); <span class="comment">// Sleep not really necessary, especially if mapmaker is busy</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="comment">// Handle any GUI commands encountered..</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordflow">while</span>(!<a class="code" href="../../da/d2e/a00238.html#ae03e861c5fbf007178a4329e79034193">mvQueuedCommands</a>.empty())</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#a6afb212b6070e2e2e79b0616db69638b">GUICommandHandler</a>(<a class="code" href="../../da/d2e/a00238.html#ae03e861c5fbf007178a4329e79034193">mvQueuedCommands</a>.begin()-&gt;sCommand, <a class="code" href="../../da/d2e/a00238.html#ae03e861c5fbf007178a4329e79034193">mvQueuedCommands</a>.begin()-&gt;sParams);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#ae03e861c5fbf007178a4329e79034193">mvQueuedCommands</a>.erase(<a class="code" href="../../da/d2e/a00238.html#ae03e861c5fbf007178a4329e79034193">mvQueuedCommands</a>.begin());</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a81c598897a9b30ece4f2a9acffaa6572">IsGood</a>())  <span class="comment">// Nothing to do if there is no map yet!</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <span class="comment">// From here on, mapmaker does various map-maintenance jobs in a certain priority</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="comment">// Hierarchy. For example, if there&#39;s a new key-frame to be added (QueueSize() is &gt;0)</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="comment">// then that takes high priority.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="comment">// Should we run local bundle adjustment?</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">if</span>(!<a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> &amp;&amp; <a class="code" href="../../da/d2e/a00238.html#ab6bd69f268aa8f05416c5071b93d5731">QueueSize</a>() == 0)  </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a2962f5bcf1a82d1a495a22582955cbb2">BundleAdjustRecent</a>();   </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="comment">// Are there any newly-made map points which need more measurements from older key-frames?</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> &amp;&amp; <a class="code" href="../../da/d2e/a00238.html#ab6bd69f268aa8f05416c5071b93d5731">QueueSize</a>() == 0)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#aee8e87553a9f5093fc3197f08fc7efc5">ReFindNewlyMade</a>();  </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="comment">// Run global bundle adjustment?</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> &amp;&amp; !<a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a> &amp;&amp; <a class="code" href="../../da/d2e/a00238.html#ab6bd69f268aa8f05416c5071b93d5731">QueueSize</a>() == 0)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#ae7e294031f100c07e72ac167478fb587">BundleAdjustAll</a>();</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="comment">// Very low priorty: re-find measurements marked as outliers</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> &amp;&amp; <a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a> &amp;&amp; rand()%20 == 0 &amp;&amp; <a class="code" href="../../da/d2e/a00238.html#ab6bd69f268aa8f05416c5071b93d5731">QueueSize</a>() == 0)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#af81acbc8521774e9f6b69efc8f0907e4">ReFindFromFailureQueue</a>();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#a4fd01daa4cb3639d06395090393b98ae">HandleBadPoints</a>();</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <a class="code" href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      <span class="comment">// Any new key-frames to be added?</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#ab6bd69f268aa8f05416c5071b93d5731">QueueSize</a>() &gt; 0)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a886570cf889020c5d8fa2e01ce75996c">AddKeyFrameFromTopOfQueue</a>(); <span class="comment">// Integrate into map data struct, and process</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">// Tracker calls this to demand a reset</span></div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a132fc4c7223676386cb8da420b151796">  120</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a132fc4c7223676386cb8da420b151796">MapMaker::RequestReset</a>()</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;{</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a9010241199b5b242ef3fb56f34c5c6d9">mbResetDone</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a919708e6565165405fd5370f0987d63d">mbResetRequested</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a63ec8516f1baefda696eeca0f7a2f376">  126</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/d2e/a00238.html#a63ec8516f1baefda696eeca0f7a2f376">MapMaker::ResetDone</a>()</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;{</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../da/d2e/a00238.html#a9010241199b5b242ef3fb56f34c5c6d9">mbResetDone</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">// HandleBadPoints() Does some heuristic checks on all points in the map to see if </span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">// they should be flagged as bad, based on tracker feedback.</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a4fd01daa4cb3639d06395090393b98ae">  133</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a4fd01daa4cb3639d06395090393b98ae">MapMaker::HandleBadPoints</a>()</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// Did the tracker see this point as an outlier more often than as an inlier?</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size(); i++)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <a class="code" href="../../d9/d21/a00240.html">MapPoint</a> &amp;p = *<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i];</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">if</span>(p.<a class="code" href="../../d9/d21/a00240.html#a1f48161af9746079917bc36150c5c0df">nMEstimatorOutlierCount</a> &gt; 20 &amp;&amp; p.<a class="code" href="../../d9/d21/a00240.html#a1f48161af9746079917bc36150c5c0df">nMEstimatorOutlierCount</a> &gt; p.<a class="code" href="../../d9/d21/a00240.html#af3b32587aca37b06999a3a896e898dff">nMEstimatorInlierCount</a>)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    p.<a class="code" href="../../d9/d21/a00240.html#a93a91222a63f14d8992cf4742baf3619">bBad</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// All points marked as bad will be erased - erase all records of them</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// from keyframes in which they might have been measured.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size(); i++)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;bBad)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="../../d9/d21/a00240.html">MapPoint</a> *p = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i];</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); j++)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k = *<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[j];</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span>(k.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.count(p))</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          k.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.erase(p);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// Move bad points to the trash list.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a3ad3feb9bd254e8c548d79e3ffdfb9a0">MoveBadPointsToTrash</a>();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;}</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a270d6592f31c8026c809501ff4f2c2b9">  160</a></span>&#160;<a class="code" href="../../da/d2e/a00238.html#a270d6592f31c8026c809501ff4f2c2b9">MapMaker::~MapMaker</a>()</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a99d08a8ec4f80cfa846ee7bd4da1e485">mbBundleAbortRequested</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <a class="code" href="../../d3/d29/a00419.html#a1bc36ace032d86194d221db82f9d4c1f">stop</a>(); <span class="comment">// makes shouldStop() return true</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;Waiting for mapmaker to die..&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: %s&quot;</span>, <span class="stringliteral">&quot;Waiting for mapmaker to die..&quot;</span>);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <a class="code" href="../../d3/d29/a00419.html#a65607c7a8760418de9fbaff0d53e8529">join</a>();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot; .. mapmaker has died.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: %s&quot;</span>, <span class="stringliteral">&quot;.. mapmaker has died.&quot;</span>);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">// Finds 3d coords of point in reference frame B from two z=1 plane projections</span></div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a0dd86d4dbdd106b8c51a2e9db54d8eff">  173</a></span>&#160;<a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> <a class="code" href="../../da/d2e/a00238.html#a0dd86d4dbdd106b8c51a2e9db54d8eff">MapMaker::ReprojectPoint</a>(<a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> se3AfromB, <span class="keyword">const</span> <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> &amp;v2A, <span class="keyword">const</span> <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> &amp;v2B)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;3,4&gt;</a> PDash;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  PDash.slice&lt;0,0,3,3&gt;() = se3AfromB.<a class="code" href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">get_rotation</a>().get_matrix();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  PDash.slice&lt;0,3,3,1&gt;() = se3AfromB.<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>().as_col();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;4&gt;</a> A;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  A[0][0] = -1.0; A[0][1] =  0.0; A[0][2] = v2B[0]; A[0][3] = 0.0;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  A[1][0] =  0.0; A[1][1] = -1.0; A[1][2] = v2B[1]; A[1][3] = 0.0;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  A[2] = v2A[0] * PDash[2] - PDash[0];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  A[3] = v2A[1] * PDash[2] - PDash[1];</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="../../d4/dbc/a00414.html">SVD&lt;4,4&gt;</a> svd(A);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;4&gt;</a> v4Smallest = svd.<a class="code" href="../../d4/dbc/a00414.html#aed67d44bde8f88928223508616471796">get_VT</a>()[3];</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span>(v4Smallest[3] == 0.0)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    v4Smallest[3] = 0.00001;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">project</a>(v4Smallest);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">// InitFromStereo() generates the initial match from two keyframes</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">// and a vector of image correspondences. Uses the </span></div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#ad7c06731385e36073b32dba5d8eadb98">  196</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/d2e/a00238.html#ad7c06731385e36073b32dba5d8eadb98">MapMaker::InitFromStereo</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kF,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kS,</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                  vector&lt;pair&lt;ImageRef, ImageRef&gt; &gt; &amp;vTrailMatches,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                  <a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> &amp;se3TrackerPose)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a182f1ce425b31f467f1f85029fca0b1b">mdWiggleScale</a> = <a class="code" href="../../da/d2e/a00238.html#a4c687f57c614a609f7ec434cee0954de">mgvdWiggleScale</a>; <span class="comment">// Cache this for the new map.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a700b037d4c41f7aa2ab1b42ed57759b8">SetImageSize</a>(kF.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[0].<a class="code" href="../../d0/d53/a00232.html#aa2fda57784edbadc7673541d76d32384">im</a>.<a class="code" href="../../d1/d98/a00407.html#a1fe56e4395ac4f7e342c75a222c84e14">size</a>());</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  vector&lt;HomographyMatch&gt; vMatches;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vTrailMatches.size(); i++)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <a class="code" href="../../d8/d00/a00186.html">HomographyMatch</a> m;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      m.<a class="code" href="../../d8/d00/a00186.html#ad617aa0a0a4b0519a96fea4883a2d18c">v2CamPlaneFirst</a> = <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(vTrailMatches[i].first);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      m.<a class="code" href="../../d8/d00/a00186.html#ac2ba2a37537a9206aae6603d06d0937e">v2CamPlaneSecond</a> = <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(vTrailMatches[i].second);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      m.<a class="code" href="../../d8/d00/a00186.html#af17dfb8b7fc2a00fd27329e848067104">m2PixelProjectionJac</a> = <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ac2d98569d643dc40416fbc5fa1abba19">GetProjectionDerivs</a>();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      vMatches.push_back(m);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> se3;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordtype">bool</span> bGood;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="../../de/df3/a00185.html">HomographyInit</a> <a class="code" href="../../de/df3/a00185.html">HomographyInit</a>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  bGood = HomographyInit.<a class="code" href="../../de/df3/a00185.html#a5e1820d32f78f975ade1dd79267214ec">Compute</a>(vMatches, 5.0, se3);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">if</span>(!bGood)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;  Could not init from stereo pair, try again.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: %s&quot;</span>, <span class="stringliteral">&quot;Could not init from stereo pair, try again.&quot;</span>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">// Check that the initialiser estimated a non-zero baseline</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">double</span> dTransMagn = sqrt(se3.<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>() * se3.<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>());</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordflow">if</span>(dTransMagn == 0)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;  Estimated zero baseline from stereo pair, try again.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: %s&quot;</span>, <span class="stringliteral">&quot;  Estimated zero baseline from stereo pair, try again.&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">// change the scale of the map so the second camera is wiggleScale away from the first</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  se3.<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>() *= <a class="code" href="../../da/d2e/a00238.html#a182f1ce425b31f467f1f85029fca0b1b">mdWiggleScale</a>/dTransMagn;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pkFirst = <span class="keyword">new</span> <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a>();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pkSecond = <span class="keyword">new</span> <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a>();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  *pkFirst = kF;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  *pkSecond = kS;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  pkFirst-&gt;<a class="code" href="../../dc/d55/a00226.html#a9ec9520a915b479c66d6c36402a48d75">bFixed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  pkFirst-&gt;<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a> = <a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a>();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  pkSecond-&gt;<a class="code" href="../../dc/d55/a00226.html#a9ec9520a915b479c66d6c36402a48d75">bFixed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  pkSecond-&gt;<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a> = se3;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="comment">// Construct map from the stereo matches.</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="../../d7/df2/a00312.html">PatchFinder</a> finder;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vMatches.size(); i++)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <a class="code" href="../../d9/d21/a00240.html">MapPoint</a> *p = <span class="keyword">new</span> <a class="code" href="../../d9/d21/a00240.html">MapPoint</a>();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">// Patch source stuff:</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a672c3703014d88356b74aab95729522b">pPatchSourceKF</a> = pkFirst;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a8f25f0ad4b410ee531991e9dbbd212d5">nSourceLevel</a> = 0;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a4bed63a6f5a86bbf08c94d46298d05b6">v3Normal_NC</a> = <a class="code" href="../../d0/de7/a00523.html#a0bbd0ef9cb4419e4037c4c6e7e2835e3">makeVector</a>( 0,0,-1);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#ae303940d5542eb614c0609ad0681846f">irCenter</a> = vTrailMatches[i].first;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a29a8af803dea1e8cf37f52971d59a40d">v3Center_NC</a> = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(p-&gt;<a class="code" href="../../d9/d21/a00240.html#ae303940d5542eb614c0609ad0681846f">irCenter</a>));</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#aeeb275f21ac310dc15b78ebccd2cf4c3">v3OneDownFromCenter_NC</a> = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(p-&gt;<a class="code" href="../../d9/d21/a00240.html#ae303940d5542eb614c0609ad0681846f">irCenter</a> + <a class="code" href="../../d7/da0/a00198.html">ImageRef</a>(0,1)));</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a8c958cd63519400a12190d3ed3a7c8e3">v3OneRightFromCenter_NC</a> = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(p-&gt;<a class="code" href="../../d9/d21/a00240.html#ae303940d5542eb614c0609ad0681846f">irCenter</a> + <a class="code" href="../../d7/da0/a00198.html">ImageRef</a>(1,0)));</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(p-&gt;<a class="code" href="../../d9/d21/a00240.html#a29a8af803dea1e8cf37f52971d59a40d">v3Center_NC</a>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(p-&gt;<a class="code" href="../../d9/d21/a00240.html#aeeb275f21ac310dc15b78ebccd2cf4c3">v3OneDownFromCenter_NC</a>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(p-&gt;<a class="code" href="../../d9/d21/a00240.html#a8c958cd63519400a12190d3ed3a7c8e3">v3OneRightFromCenter_NC</a>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#ae5075b6febd541a4eec4a28653008334">RefreshPixelVectors</a>();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="comment">// Do sub-pixel alignment on the second image</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      finder.<a class="code" href="../../d7/df2/a00312.html#aee68ca3c5c899b56b52c4fce7fb177b0">MakeTemplateCoarseNoWarp</a>(*p);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      finder.<a class="code" href="../../d7/df2/a00312.html#ae420a3f2a92e22913edbc22d937fe6e9">MakeSubPixTemplate</a>();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      finder.<a class="code" href="../../d7/df2/a00312.html#a25e62e13dfd15dccff6a3e4c76b7d13e">SetSubPixPos</a>(<a class="code" href="../../de/d85/a00618.html#a54292001c2bdcba3cc04de6ce55f6735">vec</a>(vTrailMatches[i].second));</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordtype">bool</span> bGood = finder.<a class="code" href="../../d7/df2/a00312.html#a8d19042d223df949d37476be75c5c47d">IterateSubPixToConvergence</a>(*pkSecond,10);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordflow">if</span>(!bGood)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    { </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keyword">delete</span> p; <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="comment">// Triangulate point:</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2SecondPos = finder.<a class="code" href="../../d7/df2/a00312.html#a151b80cb6e09bd8f91171f717379e85a">GetSubPixPos</a>();</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a03926fa19108aea2b524e8a244853eb7">v3WorldPos</a> = <a class="code" href="../../da/d2e/a00238.html#a0dd86d4dbdd106b8c51a2e9db54d8eff">ReprojectPoint</a>(se3, <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(v2SecondPos), vMatches[i].v2CamPlaneFirst);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d9/d21/a00240.html#a03926fa19108aea2b524e8a244853eb7">v3WorldPos</a>[2] &lt; 0.0)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keyword">delete</span> p; <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="comment">// Not behind map? Good, then add to map.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a> = <span class="keyword">new</span> <a class="code" href="../../d0/d27/a00239.html">MapMakerData</a>();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.push_back(p);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="comment">// Construct first two measurements and insert into relevant DBs:</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="../../d3/d1a/a00251.html">Measurement</a> mFirst;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      mFirst.<a class="code" href="../../d3/d1a/a00251.html#a66c7c032b20703d9e081527bb30f086b">nLevel</a> = 0;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      mFirst.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> = <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113a205bee79ebde00d15f3bbd0e1cf2a8b5">Measurement::SRC_ROOT</a>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      mFirst.<a class="code" href="../../d3/d1a/a00251.html#a5f70cb9184ceda4c08eb7a87ec415017">v2RootPos</a> = <a class="code" href="../../de/d85/a00618.html#a54292001c2bdcba3cc04de6ce55f6735">vec</a>(vTrailMatches[i].first);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      mFirst.<a class="code" href="../../d3/d1a/a00251.html#a94a607fe08b7bc351c58ef685a99cc27">bSubPix</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      pkFirst-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>[p] = mFirst;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">sMeasurementKFs</a>.insert(pkFirst);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <a class="code" href="../../d3/d1a/a00251.html">Measurement</a> mSecond;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      mSecond.<a class="code" href="../../d3/d1a/a00251.html#a66c7c032b20703d9e081527bb30f086b">nLevel</a> = 0;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      mSecond.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> = <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113ac615ce28616d89dc3458d23f76565256">Measurement::SRC_TRAIL</a>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      mSecond.<a class="code" href="../../d3/d1a/a00251.html#a5f70cb9184ceda4c08eb7a87ec415017">v2RootPos</a> = finder.<a class="code" href="../../d7/df2/a00312.html#a151b80cb6e09bd8f91171f717379e85a">GetSubPixPos</a>();</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      mSecond.<a class="code" href="../../d3/d1a/a00251.html#a94a607fe08b7bc351c58ef685a99cc27">bSubPix</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      pkSecond-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>[p] = mSecond;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      p-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">sMeasurementKFs</a>.insert(pkSecond);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.push_back(pkFirst);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.push_back(pkSecond);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  pkFirst-&gt;<a class="code" href="../../dc/d55/a00226.html#af87142bc44ffa9ed3d9aa11f7f34ae59">MakeKeyFrame_Rest</a>();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  pkSecond-&gt;<a class="code" href="../../dc/d55/a00226.html#af87142bc44ffa9ed3d9aa11f7f34ae59">MakeKeyFrame_Rest</a>();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;5; i++)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#ae7e294031f100c07e72ac167478fb587">BundleAdjustAll</a>();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">// Estimate the feature depth distribution in the first two key-frames</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// (Needed for epipolar search)</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a87b67b4e9d0f25434c4c30661e068bb8">RefreshSceneDepth</a>(pkFirst);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a87b67b4e9d0f25434c4c30661e068bb8">RefreshSceneDepth</a>(pkSecond);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#af572c94fd8630c331f4f07a0d969b672">mdWiggleScaleDepthNormalized</a> = <a class="code" href="../../da/d2e/a00238.html#a182f1ce425b31f467f1f85029fca0b1b">mdWiggleScale</a> / pkFirst-&gt;<a class="code" href="../../dc/d55/a00226.html#a994d0023adb8348cfa6ecd4f61db0b8b">dSceneDepthMean</a>;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(0);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(3);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(1);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(2);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#adf4266adb1e18e4e4382060d42c544d9">counterForConvergence</a> = 0;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a>)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../da/d2e/a00238.html#adf4266adb1e18e4e4382060d42c544d9">counterForConvergence</a> &lt; <a class="code" href="../../da/d2e/a00238.html#a67a058274e28423ec9e771aa18192afd">counterForConvergenceLimit</a>)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          <a class="code" href="../../da/d2e/a00238.html#adf4266adb1e18e4e4382060d42c544d9">counterForConvergence</a>++;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      }</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#ae7e294031f100c07e72ac167478fb587">BundleAdjustAll</a>();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: mbBundleConverged_Full, counter:  %i&quot;</span>, <a class="code" href="../../da/d2e/a00238.html#adf4266adb1e18e4e4382060d42c544d9">counterForConvergence</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a919708e6565165405fd5370f0987d63d">mbResetRequested</a>)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// Rotate and translate the map so the dominant plane is at z=0:</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a8dc84e6436a9d0793a760cd6fb723dfb">ApplyGlobalTransformationToMap</a>(<a class="code" href="../../da/d2e/a00238.html#a63f5b9461a837c2e20c0905d0ff04df3">CalcPlaneAligner</a>());</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a248c8ef67476482fd303153494410c0b">bGood</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  se3TrackerPose = pkSecond-&gt;<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;  MapMaker: made initial map with &quot;</span> &lt;&lt; <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size() &lt;&lt; <span class="stringliteral">&quot; points.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot; MapMaker: made initial map with: %i&quot;</span>, <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size());</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  ostringstream tmp;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  tmp &lt;&lt; <span class="stringliteral">&quot;MapMaker: made initial map with &quot;</span>&lt;&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size()&lt;&lt;<span class="stringliteral">&quot; points.&quot;</span>&lt;&lt; endl;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a61c9bb8187e2197ff45dbcd7203b7810">sendStringToUnity</a>.<a class="code" href="../../d7/ddb/a00361.html#a5a856797c959c03cb9b014100c607e8a">SendStringToUnity</a>(tmp.str().c_str());</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">// ThinCandidates() Thins out a key-frame&#39;s candidate list.</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">// Candidates are those salient corners where the mapmaker will attempt </span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">// to make a new map point by epipolar search. We don&#39;t want to make new points</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">// where there are already existing map points, this routine erases such candidates.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">// Operates on a single level of a keyframe.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a7df530be186d2f1f85601804b9d1749e">  369</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a7df530be186d2f1f85601804b9d1749e">MapMaker::ThinCandidates</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k, <span class="keywordtype">int</span> nLevel)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;{</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  vector&lt;Candidate&gt; &amp;vCSrc = k.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel].<a class="code" href="../../d0/d53/a00232.html#a36ae51f17356652e76d6ef3f9fb94a06">vCandidates</a>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  vector&lt;Candidate&gt; vCGood;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  vector&lt;ImageRef&gt; irBusyLevelPos;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">// Make a list of `busy&#39; image locations, which already have features at the same level</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">// or at one level higher.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="../../d7/d41/a00532.html#a683a761fc48a5b3913ef277030403c86">meas_it</a> it = k.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.begin(); it!=k.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.end(); it++)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">if</span>(!(it-&gt;second.nLevel == nLevel || it-&gt;second.nLevel == nLevel + 1))</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      irBusyLevelPos.push_back(<a class="code" href="../../de/d85/a00618.html#a68b6ddc8a27058be99ca964f9c8a46a6">ir_rounded</a>(it-&gt;second.v2RootPos / <a class="code" href="../../d4/d33/a00536.html#a45d6c59ea32d3126b1479831bac8b90e">LevelScale</a>(nLevel)));</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// Only keep those candidates further than 10 pixels away from busy positions.</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nMinMagSquared = 10*10;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vCSrc.size(); i++)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <a class="code" href="../../d7/da0/a00198.html">ImageRef</a> irC = vCSrc[i].irLevelPos;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordtype">bool</span> bGood = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;irBusyLevelPos.size(); j++)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <a class="code" href="../../d7/da0/a00198.html">ImageRef</a> irB = irBusyLevelPos[j];</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">if</span>((irB - irC).mag_squared() &lt; nMinMagSquared)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          bGood = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">if</span>(bGood)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    vCGood.push_back(vCSrc[i]);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    } </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  vCSrc = vCGood;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">// Adds map points by epipolar search to the last-added key-frame, at a single</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">// specified pyramid level. Does epipolar search in the target keyframe as closest by</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">// the ClosestKeyFrame function.</span></div>
<div class="line"><a name="l00407"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">  407</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">MapMaker::AddSomeMapPoints</a>(<span class="keywordtype">int</span> nLevel)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;{</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kSrc = *(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size() - 1]); <span class="comment">// The new keyframe</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kTarget = *(<a class="code" href="../../da/d2e/a00238.html#a7d7f6b30b4027d59fc1867cf8d7b0f33">ClosestKeyFrame</a>(kSrc));   </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <a class="code" href="../../d0/d53/a00232.html">Level</a> &amp;l = kSrc.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel];</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a7df530be186d2f1f85601804b9d1749e">ThinCandidates</a>(kSrc, nLevel);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i&lt;l.<a class="code" href="../../d0/d53/a00232.html#a36ae51f17356652e76d6ef3f9fb94a06">vCandidates</a>.size(); i++)</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a78b57ee0be0cf621f51c6656bd40db38">AddPointEpipolar</a>(kSrc, kTarget, nLevel, i);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;};</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">// Rotates/translates the whole map and all keyframes</span></div>
<div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a8dc84e6436a9d0793a760cd6fb723dfb">  420</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a8dc84e6436a9d0793a760cd6fb723dfb">MapMaker::ApplyGlobalTransformationToMap</a>(<a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> se3NewFromOld)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;{</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]-&gt;se3CfromW = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]-&gt;se3CfromW * se3NewFromOld.<a class="code" href="../../df/d73/a00358.html#ad3b5bb26f63db1896fd8976fe356856b">inverse</a>();</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <a class="code" href="../../da/dbf/a00393.html">SO3&lt;&gt;</a> so3Rot = se3NewFromOld.<a class="code" href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">get_rotation</a>();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size(); i++)</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;v3WorldPos = </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    se3NewFromOld * <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;v3WorldPos;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;RefreshPixelVectors();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">// Applies a global scale factor to the map</span></div>
<div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a7acc986af8bf436463c1812fe1704c1f">  435</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a7acc986af8bf436463c1812fe1704c1f">MapMaker::ApplyGlobalScaleToMap</a>(<span class="keywordtype">double</span> dScale)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;{</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]-&gt;se3CfromW.get_translation() *= dScale;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size(); i++)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      (*<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]).v3WorldPos *= dScale;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      (*<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]).v3PixelRight_W *= dScale;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      (*<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]).v3PixelDown_W *= dScale;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      (*<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]).RefreshPixelVectors();</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">// The tracker entry point for adding a new keyframe;</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">// the tracker thread doesn&#39;t want to hang about, so </span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">// just dumps it on the top of the mapmaker&#39;s queue to </span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">// be dealt with later, and return.</span></div>
<div class="line"><a name="l00453"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#aa7d96efe0b86dcc43c64bce43d94d0fb">  453</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#aa7d96efe0b86dcc43c64bce43d94d0fb">MapMaker::AddKeyFrame</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;{</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pK = <span class="keyword">new</span> <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  *pK = k;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  pK-&gt;<a class="code" href="../../dc/d55/a00226.html#a8e4056b6358b9ace6e4d0da2194c7594">pSBI</a> = NULL; <span class="comment">// Mapmaker uses a different SBI than the tracker, so will re-gen its own</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">mvpKeyFrameQueue</a>.push_back(pK);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a8cfc18567123cd2d054a41c0a5731ec5">mbBundleRunning</a>)   <span class="comment">// Tell the mapmaker to stop doing low-priority stuff and concentrate on this KF first.</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a99d08a8ec4f80cfa846ee7bd4da1e485">mbBundleAbortRequested</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">// Mapmaker&#39;s code to handle incoming key-frames.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a886570cf889020c5d8fa2e01ce75996c">  464</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a886570cf889020c5d8fa2e01ce75996c">MapMaker::AddKeyFrameFromTopOfQueue</a>()</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;{</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">mvpKeyFrameQueue</a>.size() == 0)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pK = <a class="code" href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">mvpKeyFrameQueue</a>[0];</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">mvpKeyFrameQueue</a>.erase(<a class="code" href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">mvpKeyFrameQueue</a>.begin());</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  pK-&gt;<a class="code" href="../../dc/d55/a00226.html#af87142bc44ffa9ed3d9aa11f7f34ae59">MakeKeyFrame_Rest</a>();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.push_back(pK);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">// Any measurements? Update the relevant point&#39;s measurement counter status map</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="../../d7/d41/a00532.html#a683a761fc48a5b3913ef277030403c86">meas_it</a> it = pK-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.begin();</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      it!=pK-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.end();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      it++)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      it-&gt;first-&gt;pMMData-&gt;sMeasurementKFs.insert(pK);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      it-&gt;second.Source = <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113ac6ae81d05781e68262cd1b96400f8ae6">Measurement::SRC_TRACKER</a>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">// And maybe we missed some - this now adds to the map itself, too.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#aacf6ccdbb7319145759f91c26c328925">ReFindInSingleKeyFrame</a>(*pK);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(3);       <span class="comment">// .. and add more map points by epipolar search.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(0);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(1);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">AddSomeMapPoints</a>(2);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">// Tries to make a new map point out of a single candidate point</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">// by searching for that point in another keyframe, and triangulating</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">// if a match is found.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a78b57ee0be0cf621f51c6656bd40db38">  497</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/d2e/a00238.html#a78b57ee0be0cf621f51c6656bd40db38">MapMaker::AddPointEpipolar</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kSrc, </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kTarget, </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="keywordtype">int</span> nLevel,</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="keywordtype">int</span> nCandidate)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;{</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d7/d6e/a00190.html">Image&lt;Vector&lt;2&gt;</a> &gt; imUnProj;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> bMadeCache = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">if</span>(!bMadeCache)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      imUnProj.<a class="code" href="../../d7/d6e/a00190.html#a76a692cdb0afd83cc8f0cfe86813ad6a">resize</a>(kSrc.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[0].<a class="code" href="../../d0/d53/a00232.html#aa2fda57784edbadc7673541d76d32384">im</a>.<a class="code" href="../../d1/d98/a00407.html#a1fe56e4395ac4f7e342c75a222c84e14">size</a>());</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <a class="code" href="../../d7/da0/a00198.html">ImageRef</a> <a class="code" href="../../de/d85/a00618.html#ab323db82d94f28c3a207b04311136a51">ir</a>;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">do</span> imUnProj[<a class="code" href="../../de/d85/a00618.html#ab323db82d94f28c3a207b04311136a51">ir</a>] = <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(ir);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="keywordflow">while</span>(ir.<a class="code" href="../../d7/da0/a00198.html#a0eb956391ba9f250ee00f15a294dc334">next</a>(imUnProj.<a class="code" href="../../d1/d98/a00407.html#a1fe56e4395ac4f7e342c75a222c84e14">size</a>()));</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      bMadeCache = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordtype">int</span> nLevelScale = <a class="code" href="../../d4/d33/a00536.html#a45d6c59ea32d3126b1479831bac8b90e">LevelScale</a>(nLevel);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="../../d1/dc6/a00037.html">Candidate</a> &amp;candidate = kSrc.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel].<a class="code" href="../../d0/d53/a00232.html#a36ae51f17356652e76d6ef3f9fb94a06">vCandidates</a>[nCandidate];</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <a class="code" href="../../d7/da0/a00198.html">ImageRef</a> irLevelPos = candidate.<a class="code" href="../../d1/dc6/a00037.html#a6a248428aa892f2f571bd280ff4915ee">irLevelPos</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2RootPos = <a class="code" href="../../d4/d33/a00536.html#acc2bcb395bb1daa33db81ad8f7de84a5">LevelZeroPos</a>(irLevelPos, nLevel);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Ray_SC = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(v2RootPos));</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(v3Ray_SC);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3LineDirn_TC = kTarget.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>.<a class="code" href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">get_rotation</a>() * (kSrc.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>.<a class="code" href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">get_rotation</a>().inverse() * v3Ray_SC);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// Restrict epipolar search to a relatively narrow depth range</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// to increase reliability</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">double</span> dMean = kSrc.<a class="code" href="../../dc/d55/a00226.html#a994d0023adb8348cfa6ecd4f61db0b8b">dSceneDepthMean</a>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordtype">double</span> dSigma = kSrc.<a class="code" href="../../dc/d55/a00226.html#a666d792dbb1302b0ebfc38f2d8355e76">dSceneDepthSigma</a>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordtype">double</span> dStartDepth = max(<a class="code" href="../../da/d2e/a00238.html#a182f1ce425b31f467f1f85029fca0b1b">mdWiggleScale</a>, dMean - dSigma);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordtype">double</span> dEndDepth = min(40 * <a class="code" href="../../da/d2e/a00238.html#a182f1ce425b31f467f1f85029fca0b1b">mdWiggleScale</a>, dMean + dSigma);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3CamCenter_TC = kTarget.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a> * kSrc.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>.<a class="code" href="../../df/d73/a00358.html#ad3b5bb26f63db1896fd8976fe356856b">inverse</a>().<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>(); <span class="comment">// The camera end</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3RayStart_TC = v3CamCenter_TC + dStartDepth * v3LineDirn_TC;                               <span class="comment">// the far-away end</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3RayEnd_TC = v3CamCenter_TC + dEndDepth * v3LineDirn_TC;                               <span class="comment">// the far-away end</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">if</span>(v3RayEnd_TC[2] &lt;= v3RayStart_TC[2])  <span class="comment">// it&#39;s highly unlikely that we&#39;ll manage to get anything out if we&#39;re facing backwards wrt the other camera&#39;s view-ray</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">if</span>(v3RayEnd_TC[2] &lt;= 0.0 )  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keywordflow">if</span>(v3RayStart_TC[2] &lt;= 0.0)</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    v3RayStart_TC += v3LineDirn_TC * (0.001 - v3RayStart_TC[2] / v3LineDirn_TC[2]);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2A = <a class="code" href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">project</a>(v3RayStart_TC);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2B = <a class="code" href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">project</a>(v3RayEnd_TC);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2AlongProjectedLine = v2A-v2B;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span>(v2AlongProjectedLine * v2AlongProjectedLine &lt; 0.00000001)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;v2AlongProjectedLine too small.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(v2AlongProjectedLine);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2Normal;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  v2Normal[0] = v2AlongProjectedLine[1];</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  v2Normal[1] = -v2AlongProjectedLine[0];</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordtype">double</span> dNormDist = v2A * v2Normal;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">if</span>(fabs(dNormDist) &gt; <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a0ee8b994cfc26cb8113cb741f116d10a">LargestRadiusInImage</a>() )</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordtype">double</span> dMinLen = min(v2AlongProjectedLine * v2A, v2AlongProjectedLine * v2B) - 0.05;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordtype">double</span> dMaxLen = max(v2AlongProjectedLine * v2A, v2AlongProjectedLine * v2B) + 0.05;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordflow">if</span>(dMinLen &lt; -2.0)  dMinLen = -2.0;</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">if</span>(dMaxLen &lt; -2.0)  dMaxLen = -2.0;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordflow">if</span>(dMinLen &gt; 2.0)   dMinLen = 2.0;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">if</span>(dMaxLen &gt; 2.0)   dMaxLen = 2.0;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// Find current-frame corners which might match this</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <a class="code" href="../../d7/df2/a00312.html">PatchFinder</a> Finder;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  Finder.<a class="code" href="../../d7/df2/a00312.html#aee68ca3c5c899b56b52c4fce7fb177b0">MakeTemplateCoarseNoWarp</a>(kSrc, nLevel, irLevelPos);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">if</span>(Finder.<a class="code" href="../../d7/df2/a00312.html#a0eec8894904ce79ec503d556ca853106">TemplateBad</a>())  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  vector&lt;Vector&lt;2&gt; &gt; &amp;vv2Corners = kTarget.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel].<a class="code" href="../../d0/d53/a00232.html#ae808e99245a500d750e5b2b0020ca4ce">vImplaneCorners</a>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  vector&lt;ImageRef&gt; &amp;vIR = kTarget.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel].<a class="code" href="../../d0/d53/a00232.html#a6a78a28fc72de71b2640f6aef2161b07">vCorners</a>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordflow">if</span>(!kTarget.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel].<a class="code" href="../../d0/d53/a00232.html#af7aeb49dc6feb05123de49d9c17cecfc">bImplaneCornersCached</a>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vIR.size(); i++)   <span class="comment">// over all corners in target img..</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    vv2Corners.push_back(imUnProj[<a class="code" href="../../de/d85/a00618.html#ab323db82d94f28c3a207b04311136a51">ir</a>(<a class="code" href="../../d4/d33/a00536.html#acc2bcb395bb1daa33db81ad8f7de84a5">LevelZeroPos</a>(vIR[i], nLevel))]);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      kTarget.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel].<a class="code" href="../../d0/d53/a00232.html#af7aeb49dc6feb05123de49d9c17cecfc">bImplaneCornersCached</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordtype">int</span> nBest = -1;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordtype">int</span> nBestZMSSD = Finder.<a class="code" href="../../d7/df2/a00312.html#a4cbaa59c947171f27fafe5fcd0523ba0">mnMaxSSD</a> + 1;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordtype">double</span> dMaxDistDiff = <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a9876a55ce3fbbf3cf9a4a1d1f1f89fd2">OnePixelDist</a>() * (4.0 + 1.0 * nLevelScale);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordtype">double</span> dMaxDistSq = dMaxDistDiff * dMaxDistDiff;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vv2Corners.size(); i++)   <span class="comment">// over all corners in target img..</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2Im = vv2Corners[i];</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keywordtype">double</span> dDistDiff = dNormDist - v2Im * v2Normal;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">if</span>(dDistDiff * dDistDiff &gt; dMaxDistSq)    <span class="keywordflow">continue</span>; <span class="comment">// skip if not along epi line</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">if</span>(v2Im * v2AlongProjectedLine &lt; dMinLen) <span class="keywordflow">continue</span>; <span class="comment">// skip if not far enough along line</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">if</span>(v2Im * v2AlongProjectedLine &gt; dMaxLen) <span class="keywordflow">continue</span>; <span class="comment">// or too far</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordtype">int</span> nZMSSD = Finder.<a class="code" href="../../d7/df2/a00312.html#adafdd7c5bce8800e2219ed1f34e7f2b3">ZMSSDAtPoint</a>(kTarget.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[nLevel].<a class="code" href="../../d0/d53/a00232.html#aa2fda57784edbadc7673541d76d32384">im</a>, vIR[i]);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="keywordflow">if</span>(nZMSSD &lt; nBestZMSSD)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      nBest = i;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      nBestZMSSD = nZMSSD;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    } </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">if</span>(nBest == -1)   <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// Nothing found.</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="comment">//  Found a likely candidate along epipolar ray</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  Finder.<a class="code" href="../../d7/df2/a00312.html#ae420a3f2a92e22913edbc22d937fe6e9">MakeSubPixTemplate</a>();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  Finder.<a class="code" href="../../d7/df2/a00312.html#a25e62e13dfd15dccff6a3e4c76b7d13e">SetSubPixPos</a>(<a class="code" href="../../d4/d33/a00536.html#acc2bcb395bb1daa33db81ad8f7de84a5">LevelZeroPos</a>(vIR[nBest], nLevel));</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordtype">bool</span> bSubPixConverges = Finder.<a class="code" href="../../d7/df2/a00312.html#a8d19042d223df949d37476be75c5c47d">IterateSubPixToConvergence</a>(kTarget,10);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordflow">if</span>(!bSubPixConverges)</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="comment">// Now triangulate the 3d point...</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3New;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  v3New = kTarget.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>.<a class="code" href="../../df/d73/a00358.html#ad3b5bb26f63db1896fd8976fe356856b">inverse</a>() *  </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#a0dd86d4dbdd106b8c51a2e9db54d8eff">ReprojectPoint</a>(kSrc.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a> * kTarget.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>.<a class="code" href="../../df/d73/a00358.html#ad3b5bb26f63db1896fd8976fe356856b">inverse</a>(),</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;           <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(v2RootPos), </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;           <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(Finder.<a class="code" href="../../d7/df2/a00312.html#a151b80cb6e09bd8f91171f717379e85a">GetSubPixPos</a>()));</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <a class="code" href="../../d9/d21/a00240.html">MapPoint</a> *pNew = <span class="keyword">new</span> <a class="code" href="../../d9/d21/a00240.html">MapPoint</a>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a03926fa19108aea2b524e8a244853eb7">v3WorldPos</a> = v3New;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a> = <span class="keyword">new</span> <a class="code" href="../../d0/d27/a00239.html">MapMakerData</a>();</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="comment">// Patch source stuff:</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a672c3703014d88356b74aab95729522b">pPatchSourceKF</a> = &amp;kSrc;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a8f25f0ad4b410ee531991e9dbbd212d5">nSourceLevel</a> = nLevel;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a4bed63a6f5a86bbf08c94d46298d05b6">v3Normal_NC</a> = <a class="code" href="../../d0/de7/a00523.html#a0bbd0ef9cb4419e4037c4c6e7e2835e3">makeVector</a>( 0,0,-1);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#ae303940d5542eb614c0609ad0681846f">irCenter</a> = irLevelPos;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a29a8af803dea1e8cf37f52971d59a40d">v3Center_NC</a> = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(v2RootPos));</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a8c958cd63519400a12190d3ed3a7c8e3">v3OneRightFromCenter_NC</a> = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(v2RootPos + <a class="code" href="../../de/d85/a00618.html#a54292001c2bdcba3cc04de6ce55f6735">vec</a>(<a class="code" href="../../d7/da0/a00198.html">ImageRef</a>(nLevelScale,0))));</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#aeeb275f21ac310dc15b78ebccd2cf4c3">v3OneDownFromCenter_NC</a>  = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">UnProject</a>(v2RootPos + <a class="code" href="../../de/d85/a00618.html#a54292001c2bdcba3cc04de6ce55f6735">vec</a>(<a class="code" href="../../d7/da0/a00198.html">ImageRef</a>(0,nLevelScale))));</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a29a8af803dea1e8cf37f52971d59a40d">v3Center_NC</a>);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#aeeb275f21ac310dc15b78ebccd2cf4c3">v3OneDownFromCenter_NC</a>);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a8c958cd63519400a12190d3ed3a7c8e3">v3OneRightFromCenter_NC</a>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#ae5075b6febd541a4eec4a28653008334">RefreshPixelVectors</a>();</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.push_back(pNew);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">mqNewQueue</a>.push(pNew);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <a class="code" href="../../d3/d1a/a00251.html">Measurement</a> m;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> = <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113a205bee79ebde00d15f3bbd0e1cf2a8b5">Measurement::SRC_ROOT</a>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a5f70cb9184ceda4c08eb7a87ec415017">v2RootPos</a> = v2RootPos;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a66c7c032b20703d9e081527bb30f086b">nLevel</a> = nLevel;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a94a607fe08b7bc351c58ef685a99cc27">bSubPix</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  kSrc.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>[pNew] = m;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> = <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113a58c1047e24fc271743d242d0dc5cb76b">Measurement::SRC_EPIPOLAR</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a5f70cb9184ceda4c08eb7a87ec415017">v2RootPos</a> = Finder.<a class="code" href="../../d7/df2/a00312.html#a151b80cb6e09bd8f91171f717379e85a">GetSubPixPos</a>();</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  kTarget.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>[pNew] = m;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">sMeasurementKFs</a>.insert(&amp;kSrc);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">sMeasurementKFs</a>.insert(&amp;kTarget);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;}</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div>
<div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a8a2a25fb4916fb9537fabe1aa6cb57f1">  651</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../da/d2e/a00238.html#a8a2a25fb4916fb9537fabe1aa6cb57f1">MapMaker::KeyFrameLinearDist</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k1, <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k2)</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;{</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3KF1_CamPos = k1.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>.<a class="code" href="../../df/d73/a00358.html#ad3b5bb26f63db1896fd8976fe356856b">inverse</a>().<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>();</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3KF2_CamPos = k2.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>.<a class="code" href="../../df/d73/a00358.html#ad3b5bb26f63db1896fd8976fe356856b">inverse</a>().<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>();</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Diff = v3KF2_CamPos - v3KF1_CamPos;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordtype">double</span> dDist = sqrt(v3Diff * v3Diff);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">return</span> dDist;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;}</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a89eec0aa6ee1069ed36ece6c3f260467">  660</a></span>&#160;vector&lt;KeyFrame*&gt; <a class="code" href="../../da/d2e/a00238.html#a89eec0aa6ee1069ed36ece6c3f260467">MapMaker::NClosestKeyFrames</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;{</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  vector&lt;pair&lt;double, KeyFrame* &gt; &gt; vKFandScores;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i] == &amp;k)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordtype">double</span> dDist = <a class="code" href="../../da/d2e/a00238.html#a8a2a25fb4916fb9537fabe1aa6cb57f1">KeyFrameLinearDist</a>(k, *<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      vKFandScores.push_back(make_pair(dDist, <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]));</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordflow">if</span>(N &gt; vKFandScores.size())</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    N = vKFandScores.size();</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  partial_sort(vKFandScores.begin(), vKFandScores.begin() + N, vKFandScores.end());</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  vector&lt;KeyFrame*&gt; vResult;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;N; i++)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    vResult.push_back(vKFandScores[i].second);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">return</span> vResult;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;}</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a7d7f6b30b4027d59fc1867cf8d7b0f33">  680</a></span>&#160;<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a>* <a class="code" href="../../da/d2e/a00238.html#a7d7f6b30b4027d59fc1867cf8d7b0f33">MapMaker::ClosestKeyFrame</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;{</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="keywordtype">double</span> dClosestDist = 9999999999.9;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordtype">int</span> nClosest = -1;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i] == &amp;k)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordtype">double</span> dDist = <a class="code" href="../../da/d2e/a00238.html#a8a2a25fb4916fb9537fabe1aa6cb57f1">KeyFrameLinearDist</a>(k, *<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">if</span>(dDist &lt; dClosestDist)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      dClosestDist = dDist;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      nClosest = i;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  assert(nClosest != -1);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[nClosest];</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;}</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#abb1d9ea9b87bb26bf32ffed49e2b0790">  699</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../da/d2e/a00238.html#abb1d9ea9b87bb26bf32ffed49e2b0790">MapMaker::DistToNearestKeyFrame</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kCurrent)</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;{</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pClosest = <a class="code" href="../../da/d2e/a00238.html#a7d7f6b30b4027d59fc1867cf8d7b0f33">ClosestKeyFrame</a>(kCurrent);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">double</span> dDist = <a class="code" href="../../da/d2e/a00238.html#a8a2a25fb4916fb9537fabe1aa6cb57f1">KeyFrameLinearDist</a>(kCurrent, *pClosest);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordflow">return</span> dDist;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;}</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#ae0efe8db35ef6dca5309bdd1d061906d">  706</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/d2e/a00238.html#ae0efe8db35ef6dca5309bdd1d061906d">MapMaker::NeedNewKeyFrame</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kCurrent)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;{</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pClosest = <a class="code" href="../../da/d2e/a00238.html#a7d7f6b30b4027d59fc1867cf8d7b0f33">ClosestKeyFrame</a>(kCurrent);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordtype">double</span> dDist = <a class="code" href="../../da/d2e/a00238.html#a8a2a25fb4916fb9537fabe1aa6cb57f1">KeyFrameLinearDist</a>(kCurrent, *pClosest);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  dDist *= (1.0 / kCurrent.<a class="code" href="../../dc/d55/a00226.html#a994d0023adb8348cfa6ecd4f61db0b8b">dSceneDepthMean</a>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keywordflow">if</span>(dDist &gt; <a class="code" href="../../dd/d4d/a00519.html#a84136448201b0ca697325a75459d7100">MapMakerMaxKFDistWiggleMult</a> * <a class="code" href="../../da/d2e/a00238.html#af572c94fd8630c331f4f07a0d969b672">mdWiggleScaleDepthNormalized</a>)</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;}</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">// Perform bundle adjustment on all keyframes, all map points</span></div>
<div class="line"><a name="l00718"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#ae7e294031f100c07e72ac167478fb587">  718</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#ae7e294031f100c07e72ac167478fb587">MapMaker::BundleAdjustAll</a>()</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;{</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">// construct the sets of kfs/points to be adjusted:</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">// in this case, all of them</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  set&lt;KeyFrame*&gt; sAdj;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  set&lt;KeyFrame*&gt; sFixed;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]-&gt;bFixed)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      sFixed.insert(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      sAdj.insert(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]);</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  set&lt;MapPoint*&gt; sMapPoints;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size();i++)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    sMapPoints.insert(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ac002856d5ddb45d7c0b4c5c7881ea5e5">BundleAdjust</a>(sAdj, sFixed, sMapPoints, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;}</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">// Peform a local bundle adjustment which only adjusts</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">// recently added key-frames</span></div>
<div class="line"><a name="l00739"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a2962f5bcf1a82d1a495a22582955cbb2">  739</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a2962f5bcf1a82d1a495a22582955cbb2">MapMaker::BundleAdjustRecent</a>()</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;{</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size() &lt; 8)  </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    { <span class="comment">// Ignore this unless map is big enough</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="comment">// First, make a list of the keyframes we want adjusted in the adjuster.</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="comment">// This will be the last keyframe inserted, and its four nearest neighbors</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  set&lt;KeyFrame*&gt; sAdjustSet;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pkfNewest = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.back();</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  sAdjustSet.insert(pkfNewest);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  vector&lt;KeyFrame*&gt; vClosest = <a class="code" href="../../da/d2e/a00238.html#a89eec0aa6ee1069ed36ece6c3f260467">NClosestKeyFrames</a>(*pkfNewest, 4);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;4; i++)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span>(vClosest[i]-&gt;bFixed == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      sAdjustSet.insert(vClosest[i]);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="comment">// Now we find the set of features which they contain.</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  set&lt;MapPoint*&gt; sMapPoints;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordflow">for</span>(set&lt;KeyFrame*&gt;::iterator iter = sAdjustSet.begin();</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      iter!=sAdjustSet.end();</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      iter++)</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      map&lt;MapPoint*,Measurement&gt; &amp;mKFMeas = (*iter)-&gt;mMeasurements;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="../../d7/d41/a00532.html#a683a761fc48a5b3913ef277030403c86">meas_it</a> jiter = mKFMeas.begin(); jiter!= mKFMeas.end(); jiter++)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    sMapPoints.insert(jiter-&gt;first);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    };</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="comment">// Finally, add all keyframes which measure above points as fixed keyframes</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  set&lt;KeyFrame*&gt; sFixedSet;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordflow">for</span>(vector&lt;KeyFrame*&gt;::iterator it = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.begin(); it!=<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.end(); it++)</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="keywordflow">if</span>(sAdjustSet.count(*it))</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordtype">bool</span> bInclude = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="../../d7/d41/a00532.html#a683a761fc48a5b3913ef277030403c86">meas_it</a> jiter = (*it)-&gt;mMeasurements.begin(); jiter!= (*it)-&gt;mMeasurements.end(); jiter++)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">if</span>(sMapPoints.count(jiter-&gt;first))</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        bInclude = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">if</span>(bInclude)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    sFixedSet.insert(*it);</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#ac002856d5ddb45d7c0b4c5c7881ea5e5">BundleAdjust</a>(sAdjustSet, sFixedSet, sMapPoints, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;}</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">// Common bundle adjustment code. This creates a bundle-adjust instance, populates it, and runs it.</span></div>
<div class="line"><a name="l00789"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#ac002856d5ddb45d7c0b4c5c7881ea5e5">  789</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#ac002856d5ddb45d7c0b4c5c7881ea5e5">MapMaker::BundleAdjust</a>(set&lt;KeyFrame*&gt; sAdjustSet, set&lt;KeyFrame*&gt; sFixedSet, set&lt;MapPoint*&gt; sMapPoints, <span class="keywordtype">bool</span> bRecent)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;{</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html">Bundle</a> b(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>);   <span class="comment">// Our bundle adjuster</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a8cfc18567123cd2d054a41c0a5731ec5">mbBundleRunning</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a4d21d52cbab5260c2298226164879018">mbBundleRunningIsRecent</a> = bRecent;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">// The bundle adjuster does different accounting of keyframes and map points;</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="comment">// Translation maps are stored:</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  map&lt;MapPoint*, int&gt; mPoint_BundleID;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  map&lt;int, MapPoint*&gt; mBundleID_Point;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  map&lt;KeyFrame*, int&gt; mView_BundleID;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  map&lt;int, KeyFrame*&gt; mBundleID_View;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="comment">// Add the keyframes&#39; poses to the bundle adjuster. Two parts: first nonfixed, then fixed.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">for</span>(set&lt;KeyFrame*&gt;::iterator it = sAdjustSet.begin(); it!= sAdjustSet.end(); it++)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordtype">int</span> nBundleID = b.<a class="code" href="../../d4/d8c/a00035.html#ae70602edb7b657e68e4219d3f66c491b">AddCamera</a>((*it)-&gt;se3CfromW, (*it)-&gt;bFixed);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      mView_BundleID[*it] = nBundleID;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      mBundleID_View[nBundleID] = *it;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordflow">for</span>(set&lt;KeyFrame*&gt;::iterator it = sFixedSet.begin(); it!= sFixedSet.end(); it++)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordtype">int</span> nBundleID = b.<a class="code" href="../../d4/d8c/a00035.html#ae70602edb7b657e68e4219d3f66c491b">AddCamera</a>((*it)-&gt;se3CfromW, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      mView_BundleID[*it] = nBundleID;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      mBundleID_View[nBundleID] = *it;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="comment">// Add the points&#39; 3D position</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">for</span>(set&lt;MapPoint*&gt;::iterator it = sMapPoints.begin(); it!=sMapPoints.end(); it++)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordtype">int</span> nBundleID = b.<a class="code" href="../../d4/d8c/a00035.html#add96334653e0619414c6f695eb876c1e">AddPoint</a>((*it)-&gt;v3WorldPos);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      mPoint_BundleID[*it] = nBundleID;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      mBundleID_Point[nBundleID] = *it;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="comment">// Add the relevant point-in-keyframe measurements</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordflow">if</span>(mView_BundleID.count(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]) == 0)</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keywordtype">int</span> nKF_BundleID = mView_BundleID[<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]];</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keywordflow">for</span>(<a class="code" href="../../d7/d41/a00532.html#a683a761fc48a5b3913ef277030403c86">meas_it</a> it= <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]-&gt;mMeasurements.begin();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      it!= <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]-&gt;mMeasurements.end();</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      it++)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keywordflow">if</span>(mPoint_BundleID.count(it-&gt;first) == 0)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="keywordtype">int</span> nPoint_BundleID = mPoint_BundleID[it-&gt;first];</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      b.<a class="code" href="../../d4/d8c/a00035.html#a671f50417b518e0930bfcc09a1b1b41e">AddMeas</a>(nKF_BundleID, nPoint_BundleID, it-&gt;second.v2RootPos, <a class="code" href="../../d4/d33/a00536.html#a45d6c59ea32d3126b1479831bac8b90e">LevelScale</a>(it-&gt;second.nLevel) * <a class="code" href="../../d4/d33/a00536.html#a45d6c59ea32d3126b1479831bac8b90e">LevelScale</a>(it-&gt;second.nLevel));</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// Run the bundle adjuster. This returns the number of successful iterations</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="keywordtype">int</span> nAccepted = b.<a class="code" href="../../d4/d8c/a00035.html#a5352ae090e38171322b6037776d0ff95">Compute</a>(&amp;<a class="code" href="../../da/d2e/a00238.html#a99d08a8ec4f80cfa846ee7bd4da1e485">mbBundleAbortRequested</a>);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">if</span>(nAccepted &lt; 0)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="comment">// Crap: - LM Ran into a serious problem!</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="comment">// This is probably because the initial stereo was messed up.</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="comment">// Get rid of this map and start again! </span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;!! MapMaker: Cholesky failure in bundle adjust. &quot;</span> &lt;&lt; endl</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;   The map is probably corrupt: Ditching the map. &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#a919708e6565165405fd5370f0987d63d">mbResetRequested</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">// Bundle adjustment did some updates, apply these to the map</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordflow">if</span>(nAccepted &gt; 0)</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">for</span>(map&lt;MapPoint*,int&gt;::iterator itr = mPoint_BundleID.begin();</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      itr!=mPoint_BundleID.end();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      itr++)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    itr-&gt;first-&gt;v3WorldPos = b.<a class="code" href="../../d4/d8c/a00035.html#a6e02e2734d763c902a457c2ca6496b3a">GetPoint</a>(itr-&gt;second);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="keywordflow">for</span>(map&lt;KeyFrame*,int&gt;::iterator itr = mView_BundleID.begin();</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      itr!=mView_BundleID.end();</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      itr++)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    itr-&gt;first-&gt;se3CfromW = b.<a class="code" href="../../d4/d8c/a00035.html#a8ecc89fd42395a78fc286b237f7f4007">GetCamera</a>(itr-&gt;second);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordflow">if</span>(bRecent)</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    };</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">if</span>(b.<a class="code" href="../../d4/d8c/a00035.html#abd17195bae194ceaa0de36753f73be44">Converged</a>())</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">mbBundleConverged_Recent</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">if</span>(!bRecent)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">mbBundleConverged_Full</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a8cfc18567123cd2d054a41c0a5731ec5">mbBundleRunning</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a99d08a8ec4f80cfa846ee7bd4da1e485">mbBundleAbortRequested</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// Handle outlier measurements:</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  vector&lt;pair&lt;int,int&gt; &gt; vOutliers_PC_pair = b.<a class="code" href="../../d4/d8c/a00035.html#a4a797da14a8d29f9bf5f3e39303d3492">GetOutlierMeasurements</a>();</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vOutliers_PC_pair.size(); i++)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <a class="code" href="../../d9/d21/a00240.html">MapPoint</a> *pp = mBundleID_Point[vOutliers_PC_pair[i].first];</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pk = mBundleID_View[vOutliers_PC_pair[i].second];</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <a class="code" href="../../d3/d1a/a00251.html">Measurement</a> &amp;m = pk-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>[pp];</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">if</span>(pp-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#ae912e06715985c8b2ea4ab251d49d217">GoodMeasCount</a>() &lt;= 2 || m.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> == <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113a205bee79ebde00d15f3bbd0e1cf2a8b5">Measurement::SRC_ROOT</a>)   <span class="comment">// Is the original source kf considered an outlier? That&#39;s bad.</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    pp-&gt;<a class="code" href="../../d9/d21/a00240.html#a93a91222a63f14d8992cf4742baf3619">bBad</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="comment">// Do we retry it? Depends where it came from!!</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">if</span>(m.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> == <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113ac6ae81d05781e68262cd1b96400f8ae6">Measurement::SRC_TRACKER</a> || m.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> == <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113a58c1047e24fc271743d242d0dc5cb76b">Measurement::SRC_EPIPOLAR</a>)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.push_back(pair&lt;KeyFrame*,MapPoint*&gt;(pk,pp));</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        pp-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.insert(pk);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      pk-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.erase(pp);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      pp-&gt;<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">sMeasurementKFs</a>.erase(pk);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;}</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">// Mapmaker&#39;s try-to-find-a-point-in-a-keyframe code. This is used to update</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">// data association if a bad measurement was detected, or if a point</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">// was never searched for in a keyframe in the first place. This operates</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">// much like the tracker! So most of the code looks just like in </span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">// TrackerData.h.</span></div>
<div class="line"><a name="l00911"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#abebf774e59b5235bb445fcd1f1e5a95d">  911</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/d2e/a00238.html#abebf774e59b5235bb445fcd1f1e5a95d">MapMaker::ReFind_Common</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k, <a class="code" href="../../d9/d21/a00240.html">MapPoint</a> &amp;p)</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;{</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">// abort if either a measurement is already in the map, or we&#39;ve</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="comment">// decided that this point-kf combo is beyond redemption</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordflow">if</span>(p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">sMeasurementKFs</a>.count(&amp;k)</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;     || p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.count(&amp;k))</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keyword">static</span> <a class="code" href="../../d7/df2/a00312.html">PatchFinder</a> Finder;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Cam = k.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>*p.<a class="code" href="../../d9/d21/a00240.html#a03926fa19108aea2b524e8a244853eb7">v3WorldPos</a>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">if</span>(v3Cam[2] &lt; 0.001)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    {</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.insert(&amp;k);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2ImPlane = <a class="code" href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">project</a>(v3Cam);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordflow">if</span>(v2ImPlane* v2ImPlane &gt; <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a0ee8b994cfc26cb8113cb741f116d10a">LargestRadiusInImage</a>() * <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a0ee8b994cfc26cb8113cb741f116d10a">LargestRadiusInImage</a>())</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    {</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.insert(&amp;k);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2Image = <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a7b8759d7fec56601d10e60ae487b96f7">Project</a>(v2ImPlane);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a47a3acba7e89c611cf41ff92bcce2d20">Invalid</a>())</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.insert(&amp;k);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <a class="code" href="../../d7/da0/a00198.html">ImageRef</a> irImageSize = k.<a class="code" href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">aLevels</a>[0].<a class="code" href="../../d0/d53/a00232.html#aa2fda57784edbadc7673541d76d32384">im</a>.<a class="code" href="../../d1/d98/a00407.html#a1fe56e4395ac4f7e342c75a222c84e14">size</a>();</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordflow">if</span>(v2Image[0] &lt; 0 || v2Image[1] &lt; 0 || v2Image[0] &gt; irImageSize[0] || v2Image[1] &gt; irImageSize[1])</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.insert(&amp;k);</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;2&gt;</a> m2CamDerivs = <a class="code" href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ac2d98569d643dc40416fbc5fa1abba19">GetProjectionDerivs</a>();</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  Finder.<a class="code" href="../../d7/df2/a00312.html#ac18c27a1e4b82b1ca70f38e7b30e9ca5">MakeTemplateCoarse</a>(p, k.<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a>, m2CamDerivs);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  </div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keywordflow">if</span>(Finder.<a class="code" href="../../d7/df2/a00312.html#a0eec8894904ce79ec503d556ca853106">TemplateBad</a>())</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.insert(&amp;k);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    }</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  </div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordtype">bool</span> bFound = Finder.<a class="code" href="../../d7/df2/a00312.html#ab0fd585ba92b6b34eeb3c62ebcc30553">FindPatchCoarse</a>(<a class="code" href="../../de/d85/a00618.html#ab323db82d94f28c3a207b04311136a51">ir</a>(v2Image), k, 4);  <span class="comment">// Very tight search radius!</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordflow">if</span>(!bFound)</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    {</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">sNeverRetryKFs</a>.insert(&amp;k);</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="comment">// If we found something, generate a measurement struct and put it in the map</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <a class="code" href="../../d3/d1a/a00251.html">Measurement</a> m;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a66c7c032b20703d9e081527bb30f086b">nLevel</a> = Finder.<a class="code" href="../../d7/df2/a00312.html#ab7a3700856e0d86d37bcce1bbc2c4921">GetLevel</a>();</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  m.<a class="code" href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Source</a> = <a class="code" href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113aec472b0785dc395d045fbe27f9a14db0">Measurement::SRC_REFIND</a>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keywordflow">if</span>(Finder.<a class="code" href="../../d7/df2/a00312.html#ab7a3700856e0d86d37bcce1bbc2c4921">GetLevel</a>() &gt; 0)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      Finder.<a class="code" href="../../d7/df2/a00312.html#ae420a3f2a92e22913edbc22d937fe6e9">MakeSubPixTemplate</a>();</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;      Finder.<a class="code" href="../../d7/df2/a00312.html#a8d19042d223df949d37476be75c5c47d">IterateSubPixToConvergence</a>(k,8);</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      m.<a class="code" href="../../d3/d1a/a00251.html#a5f70cb9184ceda4c08eb7a87ec415017">v2RootPos</a> = Finder.<a class="code" href="../../d7/df2/a00312.html#a151b80cb6e09bd8f91171f717379e85a">GetSubPixPos</a>();</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      m.<a class="code" href="../../d3/d1a/a00251.html#a94a607fe08b7bc351c58ef685a99cc27">bSubPix</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      m.<a class="code" href="../../d3/d1a/a00251.html#a5f70cb9184ceda4c08eb7a87ec415017">v2RootPos</a> = Finder.<a class="code" href="../../d7/df2/a00312.html#a408d56e1452dedb8ea6e422524efc860">GetCoarsePosAsVector</a>();</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      m.<a class="code" href="../../d3/d1a/a00251.html#a94a607fe08b7bc351c58ef685a99cc27">bSubPix</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    };</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordflow">if</span>(k.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.count(&amp;p))</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    {</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      assert(0); <span class="comment">// This should never happen, we checked for this at the start.</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  k.<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>[&amp;p] = m;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  p.<a class="code" href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">pMMData</a>-&gt;<a class="code" href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">sMeasurementKFs</a>.insert(&amp;k);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;}</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">// A general data-association update for a single keyframe</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">// Do this on a new key-frame when it&#39;s passed in by the tracker</span></div>
<div class="line"><a name="l00992"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#aacf6ccdbb7319145759f91c26c328925">  992</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d2e/a00238.html#aacf6ccdbb7319145759f91c26c328925">MapMaker::ReFindInSingleKeyFrame</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;k)</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;{</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  vector&lt;MapPoint*&gt; vToFind;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size(); i++)</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    vToFind.push_back(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keywordtype">int</span> nFoundNow = 0;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vToFind.size(); i++)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#abebf774e59b5235bb445fcd1f1e5a95d">ReFind_Common</a>(k,*vToFind[i]))</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      nFoundNow++;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordflow">return</span> nFoundNow;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;};</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">// When new map points are generated, they&#39;re only created from a stereo pair</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">// this tries to make additional measurements in other KFs which they might</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">// be in.</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#aee8e87553a9f5093fc3197f08fc7efc5"> 1009</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#aee8e87553a9f5093fc3197f08fc7efc5">MapMaker::ReFindNewlyMade</a>()</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;{</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">mqNewQueue</a>.empty())</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordtype">int</span> nFound = 0;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordtype">int</span> nBad = 0;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">mqNewQueue</a>.empty() &amp;&amp; <a class="code" href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">mvpKeyFrameQueue</a>.size() == 0)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <a class="code" href="../../d9/d21/a00240.html">MapPoint</a>* pNew = <a class="code" href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">mqNewQueue</a>.front();</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <a class="code" href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">mqNewQueue</a>.pop();</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="keywordflow">if</span>(pNew-&gt;<a class="code" href="../../d9/d21/a00240.html#a93a91222a63f14d8992cf4742baf3619">bBad</a>)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      nBad++;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#abebf774e59b5235bb445fcd1f1e5a95d">ReFind_Common</a>(*<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i], *pNew))</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      nFound++;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    }</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;};</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">// Dud measurements get a second chance.</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#af81acbc8521774e9f6b69efc8f0907e4"> 1031</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#af81acbc8521774e9f6b69efc8f0907e4">MapMaker::ReFindFromFailureQueue</a>()</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;{</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.size() == 0)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  sort(<a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.begin(), <a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.end());</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  vector&lt;pair&lt;KeyFrame*, MapPoint*&gt; &gt;::iterator it;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordtype">int</span> nFound=0;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordflow">for</span>(it = <a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.begin(); it!=<a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.end(); it++)</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../da/d2e/a00238.html#abebf774e59b5235bb445fcd1f1e5a95d">ReFind_Common</a>(*it-&gt;first, *it-&gt;second))</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      nFound++;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.erase(<a class="code" href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">mvFailureQueue</a>.begin(), it);</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;};</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">// Is the tracker&#39;s camera pose in cloud-cuckoo land?</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#ad6e7b73f40be91fe7f58d5ed724db787"> 1046</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/d2e/a00238.html#ad6e7b73f40be91fe7f58d5ed724db787">MapMaker::IsDistanceToNearestKeyFrameExcessive</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> &amp;kCurrent)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;{</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../da/d2e/a00238.html#abb1d9ea9b87bb26bf32ffed49e2b0790">DistToNearestKeyFrame</a>(kCurrent) &gt; <a class="code" href="../../da/d2e/a00238.html#a182f1ce425b31f467f1f85029fca0b1b">mdWiggleScale</a> * 10.0;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;}</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">// Find a dominant plane in the map, find an SE3&lt;&gt; to put it as the z=0 plane</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a63f5b9461a837c2e20c0905d0ff04df3"> 1052</a></span>&#160;<a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> <a class="code" href="../../da/d2e/a00238.html#a63f5b9461a837c2e20c0905d0ff04df3">MapMaker::CalcPlaneAligner</a>()</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;{</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nPoints = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size();</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordflow">if</span>(nPoints &lt; 10)</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;  MapMaker: CalcPlane: too few points to calc plane.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a>();</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    };</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keywordtype">int</span> nRansacs = <a class="code" href="../../dd/d4d/a00519.html#a7efec1be8bf6c331182c1470463381a7">MapMakerPlaneAlignerRansacs</a>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3BestMean;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3BestNormal;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordtype">double</span> dBestDistSquared = 9999999999999999.9;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  </div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nRansacs; i++)</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordtype">int</span> nA = rand()%nPoints;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordtype">int</span> nB = nA;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="keywordtype">int</span> nC = nA;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <span class="keywordflow">while</span>(nB == nA)</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    nB = rand()%nPoints;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keywordflow">while</span>(nC == nA || nC==nB)</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    nC = rand()%nPoints;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Mean = 0.33333333 * (<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[nA]-&gt;v3WorldPos + </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                       <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[nB]-&gt;v3WorldPos + </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                       <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[nC]-&gt;v3WorldPos);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3CA = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[nC]-&gt;v3WorldPos  - <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[nA]-&gt;v3WorldPos;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3BA = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[nB]-&gt;v3WorldPos  - <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[nA]-&gt;v3WorldPos;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Normal = v3CA ^ v3BA;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      <span class="keywordflow">if</span>(v3Normal * v3Normal  == 0)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(v3Normal);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      </div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keywordtype">double</span> dSumError = 0.0;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nPoints; i++)</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Diff = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;v3WorldPos - v3Mean;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <span class="keywordtype">double</span> dDistSq = v3Diff * v3Diff;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <span class="keywordflow">if</span>(dDistSq == 0.0)</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordtype">double</span> dNormDist = fabs(v3Diff * v3Normal);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      <span class="keywordflow">if</span>(dNormDist &gt; 0.05)</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        dNormDist = 0.05;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      dSumError += dNormDist;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      <span class="keywordflow">if</span>(dSumError &lt; dBestDistSquared)</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    {</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      dBestDistSquared = dSumError;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      v3BestMean = v3Mean;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      v3BestNormal = v3Normal;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="comment">// Done the ransacs, now collect the supposed inlier set</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  vector&lt;Vector&lt;3&gt; &gt; vv3Inliers;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nPoints; i++)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Diff = <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;v3WorldPos - v3BestMean;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="keywordtype">double</span> dDistSq = v3Diff * v3Diff;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordflow">if</span>(dDistSq == 0.0)</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordtype">double</span> dNormDist = fabs(v3Diff * v3BestNormal);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keywordflow">if</span>(dNormDist &lt; 0.05)</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    vv3Inliers.push_back(<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;v3WorldPos);</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    }</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="comment">// With these inliers, calculate mean and cov</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3MeanOfInliers = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vv3Inliers.size(); i++)</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    v3MeanOfInliers+=vv3Inliers[i];</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  v3MeanOfInliers *= (1.0 / vv3Inliers.size());</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;3&gt;</a> m3Cov = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vv3Inliers.size(); i++)</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Diff = vv3Inliers[i] - v3MeanOfInliers;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      m3Cov += v3Diff.as_col() * v3Diff.as_row();</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    };</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="comment">// Find the principal component with the minimal variance: this is the plane normal</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <a class="code" href="../../d0/dd6/a00415.html">SymEigen&lt;3&gt;</a> sym(m3Cov);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Normal = sym.<a class="code" href="../../d0/dd6/a00415.html#af3b55b25ac040ce826a229b4521ea64d">get_evectors</a>()[0];</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  </div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="comment">// Use the version of the normal which points towards the cam center</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="keywordflow">if</span>(v3Normal[2] &gt; 0)</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    v3Normal *= -1.0;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;3&gt;</a> m3Rot = <a class="code" href="../../d0/de7/a00523.html#a33cfd229bb53b4055e430bd993782d41">Identity</a>;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  m3Rot[2] = v3Normal;</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  m3Rot[0] = m3Rot[0] - (v3Normal * (m3Rot[0] * v3Normal));</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <a class="code" href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">normalize</a>(m3Rot[0]);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  m3Rot[1] = m3Rot[2] ^ m3Rot[0];</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> se3Aligner;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  se3Aligner.<a class="code" href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">get_rotation</a>() = m3Rot;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3RMean = se3Aligner * v3MeanOfInliers;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  se3Aligner.<a class="code" href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">get_translation</a>() = -v3RMean;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  </div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="keywordflow">return</span> se3Aligner;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;}</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">// Calculates the depth(z-) distribution of map points visible in a keyframe</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">// This function is only used for the first two keyframes - all others</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">// get this filled in by the tracker</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a87b67b4e9d0f25434c4c30661e068bb8"> 1159</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a87b67b4e9d0f25434c4c30661e068bb8">MapMaker::RefreshSceneDepth</a>(<a class="code" href="../../dc/d55/a00226.html">KeyFrame</a> *pKF)</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;{</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordtype">double</span> dSumDepth = 0.0;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordtype">double</span> dSumDepthSquared = 0.0;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordtype">int</span> nMeas = 0;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordflow">for</span>(<a class="code" href="../../d7/d41/a00532.html#a683a761fc48a5b3913ef277030403c86">meas_it</a> it = pKF-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.begin(); it!=pKF-&gt;<a class="code" href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">mMeasurements</a>.end(); it++)</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <a class="code" href="../../d9/d21/a00240.html">MapPoint</a> &amp;point = *it-&gt;first;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3PosK = pKF-&gt;<a class="code" href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">se3CfromW</a> * point.<a class="code" href="../../d9/d21/a00240.html#a03926fa19108aea2b524e8a244853eb7">v3WorldPos</a>;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      dSumDepth += v3PosK[2];</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      dSumDepthSquared += v3PosK[2] * v3PosK[2];</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      nMeas++;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    }</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  assert(nMeas &gt; 2); <span class="comment">// If not then something is seriously wrong with this KF!!</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  pKF-&gt;<a class="code" href="../../dc/d55/a00226.html#a994d0023adb8348cfa6ecd4f61db0b8b">dSceneDepthMean</a> = dSumDepth / nMeas;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  pKF-&gt;<a class="code" href="../../dc/d55/a00226.html#a666d792dbb1302b0ebfc38f2d8355e76">dSceneDepthSigma</a> = sqrt((dSumDepthSquared / nMeas) - (pKF-&gt;<a class="code" href="../../dc/d55/a00226.html#a994d0023adb8348cfa6ecd4f61db0b8b">dSceneDepthMean</a>) * (pKF-&gt;<a class="code" href="../../dc/d55/a00226.html#a994d0023adb8348cfa6ecd4f61db0b8b">dSceneDepthMean</a>));</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;}</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div>
<div class="line"><a name="l01178"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#ac12684b9215fd27c9aff2142d3c399d1"> 1178</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#ac12684b9215fd27c9aff2142d3c399d1">MapMaker::GUICommandCallBack</a>(<span class="keywordtype">void</span>* ptr, <span class="keywordtype">string</span> sCommand, <span class="keywordtype">string</span> sParams)</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;{</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <a class="code" href="../../d1/d22/a00057.html">Command</a> c;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  c.<a class="code" href="../../d1/d22/a00057.html#a79daf7e66fafd4d6e1451ad40953df50">sCommand</a> = sCommand;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  c.<a class="code" href="../../d1/d22/a00057.html#a1f0e42bef573f24cf76cff2bcab6dc85">sParams</a> = sParams;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  ((<a class="code" href="../../da/d2e/a00238.html">MapMaker</a>*) ptr)-&gt;mvQueuedCommands.push_back(c);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;}</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div>
<div class="line"><a name="l01186"></a><span class="lineno"><a class="line" href="../../da/d2e/a00238.html#a6afb212b6070e2e2e79b0616db69638b"> 1186</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d2e/a00238.html#a6afb212b6070e2e2e79b0616db69638b">MapMaker::GUICommandHandler</a>(<span class="keywordtype">string</span> sCommand, <span class="keywordtype">string</span> sParams)  <span class="comment">// Called by the callback func..</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;{</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordflow">if</span>(sCommand==<span class="stringliteral">&quot;SaveMap&quot;</span>)</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;  MapMaker: Saving the map.... &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      ofstream ofs(<span class="stringliteral">&quot;map.dump&quot;</span>);</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>.size(); i++)</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    {</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      ofs &lt;&lt; <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;v3WorldPos &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      ofs &lt;&lt; <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">vpPoints</a>[i]-&gt;nSourceLevel &lt;&lt; endl;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      ofs.close();</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>.size(); i++)</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      ostringstream ost1;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      ost1 &lt;&lt; <span class="stringliteral">&quot;keyframes/&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;.jpg&quot;</span>;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">//    img_save(mMap.vpKeyFrames[i]-&gt;aLevels[0].im, ost1.str());</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      ostringstream ost2;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      ost2 &lt;&lt; <span class="stringliteral">&quot;keyframes/&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;.info&quot;</span>;</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      ofstream ofs2;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      ofs2.open(ost2.str().c_str());</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      ofs2 &lt;&lt; <a class="code" href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">mMap</a>.<a class="code" href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">vpKeyFrames</a>[i]-&gt;se3CfromW &lt;&lt; endl;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      ofs2.close();</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    }</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;  ... done saving map.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    }</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;! MapMaker::GUICommandHandler: unhandled command &quot;</span>&lt;&lt; sCommand &lt;&lt; endl;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  exit(1);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;}; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div>
<div class="ttc" id="a00523_html_a5e7bc0436889e9d226d132ae265e341b"><div class="ttname"><a href="../../d0/de7/a00523.html#a5e7bc0436889e9d226d132ae265e341b">TooN::normalize</a></div><div class="ttdeci">void normalize(Vector&lt; Size, Precision, Base &gt; v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d14/a00522_source.html#l00138">helpers.h:138</a></div></div>
<div class="ttc" id="a00238_html_ab613565be3873740470c4b2fc438f41d"><div class="ttname"><a href="../../da/d2e/a00238.html#ab613565be3873740470c4b2fc438f41d">MapMaker::mbBundleConverged_Recent</a></div><div class="ttdeci">bool mbBundleConverged_Recent</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00124">MapMaker.h:124</a></div></div>
<div class="ttc" id="a00240_html_a93a91222a63f14d8992cf4742baf3619"><div class="ttname"><a href="../../d9/d21/a00240.html#a93a91222a63f14d8992cf4742baf3619">MapPoint::bBad</a></div><div class="ttdeci">bool bBad</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00043">MapPoint.h:43</a></div></div>
<div class="ttc" id="a00519_html_aacce71097269c8b28177b653df0bb99b"><div class="ttname"><a href="../../dd/d4d/a00519.html#aacce71097269c8b28177b653df0bb99b">CounterForConvergenceLimit</a></div><div class="ttdeci">const int CounterForConvergenceLimit</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00053">globals.h:53</a></div></div>
<div class="ttc" id="a00251_html_a94a607fe08b7bc351c58ef685a99cc27"><div class="ttname"><a href="../../d3/d1a/a00251.html#a94a607fe08b7bc351c58ef685a99cc27">Measurement::bSubPix</a></div><div class="ttdeci">bool bSubPix</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00047">KeyFrame.h:47</a></div></div>
<div class="ttc" id="a00238_html_a7d7f6b30b4027d59fc1867cf8d7b0f33"><div class="ttname"><a href="../../da/d2e/a00238.html#a7d7f6b30b4027d59fc1867cf8d7b0f33">MapMaker::ClosestKeyFrame</a></div><div class="ttdeci">KeyFrame * ClosestKeyFrame(KeyFrame &amp;k)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00680">MapMaker.cpp:680</a></div></div>
<div class="ttc" id="a00532_html_a683a761fc48a5b3913ef277030403c86"><div class="ttname"><a href="../../d7/d41/a00532.html#a683a761fc48a5b3913ef277030403c86">meas_it</a></div><div class="ttdeci">std::map&lt; MapPoint *, Measurement &gt;::iterator meas_it</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00097">KeyFrame.h:97</a></div></div>
<div class="ttc" id="a00185_html_a5e1820d32f78f975ade1dd79267214ec"><div class="ttname"><a href="../../de/df3/a00185.html#a5e1820d32f78f975ade1dd79267214ec">HomographyInit::Compute</a></div><div class="ttdeci">bool Compute(std::vector&lt; HomographyMatch &gt; vMatches, double dMaxPixelError, SE3&lt;&gt; &amp;se3SecondCameraPose)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d24/a00524_source.html#l00033">HomographyInit.cpp:33</a></div></div>
<div class="ttc" id="a00536_html_a45d6c59ea32d3126b1479831bac8b90e"><div class="ttname"><a href="../../d4/d33/a00536.html#a45d6c59ea32d3126b1479831bac8b90e">LevelScale</a></div><div class="ttdeci">int LevelScale(int nLevel)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d33/a00536_source.html#l00020">LevelHelpers.h:20</a></div></div>
<div class="ttc" id="a00610_html"><div class="ttname"><a href="../../da/d6e/a00610.html">vector_image_ref.h</a></div></div>
<div class="ttc" id="a00226_html_a8e4056b6358b9ace6e4d0da2194c7594"><div class="ttname"><a href="../../dc/d55/a00226.html#a8e4056b6358b9ace6e4d0da2194c7594">KeyFrame::pSBI</a></div><div class="ttdeci">SmallBlurryImage * pSBI</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00094">KeyFrame.h:94</a></div></div>
<div class="ttc" id="a00393_html"><div class="ttname"><a href="../../da/dbf/a00393.html">TooN::SO3</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/a00589_source.html#l00039">so3.h:39</a></div></div>
<div class="ttc" id="a00238_html_ad6e7b73f40be91fe7f58d5ed724db787"><div class="ttname"><a href="../../da/d2e/a00238.html#ad6e7b73f40be91fe7f58d5ed724db787">MapMaker::IsDistanceToNearestKeyFrameExcessive</a></div><div class="ttdeci">bool IsDistanceToNearestKeyFrameExcessive(KeyFrame &amp;kCurrent)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l01046">MapMaker.cpp:1046</a></div></div>
<div class="ttc" id="a00035_html_add96334653e0619414c6f695eb876c1e"><div class="ttname"><a href="../../d4/d8c/a00035.html#add96334653e0619414c6f695eb876c1e">Bundle::AddPoint</a></div><div class="ttdeci">int AddPoint(Vector&lt; 3 &gt; v3Pos)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00065">Bundle.cpp:65</a></div></div>
<div class="ttc" id="a00238_html_a6afb212b6070e2e2e79b0616db69638b"><div class="ttname"><a href="../../da/d2e/a00238.html#a6afb212b6070e2e2e79b0616db69638b">MapMaker::GUICommandHandler</a></div><div class="ttdeci">void GUICommandHandler(std::string sCommand, std::string sParams)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l01186">MapMaker.cpp:1186</a></div></div>
<div class="ttc" id="a00519_html_a72e78bd45df360f888f03e1280e7c09c"><div class="ttname"><a href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a></div><div class="ttdeci">#define LOGV(LOG_TAG,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00010">globals.h:10</a></div></div>
<div class="ttc" id="a00239_html"><div class="ttname"><a href="../../d0/d27/a00239.html">MapMakerData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00030">MapMaker.h:30</a></div></div>
<div class="ttc" id="a00238_html_a409a42e627dfb983f113cf458fd689b6"><div class="ttname"><a href="../../da/d2e/a00238.html#a409a42e627dfb983f113cf458fd689b6">MapMaker::mqNewQueue</a></div><div class="ttdeci">std::queue&lt; MapPoint * &gt; mqNewQueue</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00115">MapMaker.h:115</a></div></div>
<div class="ttc" id="a00519_html_a7ce0df38eb467e59f209470c8f5ac4e6"><div class="ttname"><a href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a></div><div class="ttdeci">#define LOG_TAG</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00009">globals.h:9</a></div></div>
<div class="ttc" id="a00027_html"><div class="ttname"><a href="../../d0/d33/a00027.html">ATANCamera</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/a00480_source.html#l00066">ATANCamera.h:66</a></div></div>
<div class="ttc" id="a00238_html_a0dd86d4dbdd106b8c51a2e9db54d8eff"><div class="ttname"><a href="../../da/d2e/a00238.html#a0dd86d4dbdd106b8c51a2e9db54d8eff">MapMaker::ReprojectPoint</a></div><div class="ttdeci">Vector&lt; 3 &gt; ReprojectPoint(SE3&lt;&gt; se3AfromB, const Vector&lt; 2 &gt; &amp;v2A, const Vector&lt; 2 &gt; &amp;v2B)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00173">MapMaker.cpp:173</a></div></div>
<div class="ttc" id="a00238_html_ad9c072d5a0132be6407c72996ee2796a"><div class="ttname"><a href="../../da/d2e/a00238.html#ad9c072d5a0132be6407c72996ee2796a">MapMaker::AddSomeMapPoints</a></div><div class="ttdeci">void AddSomeMapPoints(int nLevel)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00407">MapMaker.cpp:407</a></div></div>
<div class="ttc" id="a00240_html_a1f48161af9746079917bc36150c5c0df"><div class="ttname"><a href="../../d9/d21/a00240.html#a1f48161af9746079917bc36150c5c0df">MapPoint::nMEstimatorOutlierCount</a></div><div class="ttdeci">int nMEstimatorOutlierCount</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00070">MapPoint.h:70</a></div></div>
<div class="ttc" id="a00238_html_a89eec0aa6ee1069ed36ece6c3f260467"><div class="ttname"><a href="../../da/d2e/a00238.html#a89eec0aa6ee1069ed36ece6c3f260467">MapMaker::NClosestKeyFrames</a></div><div class="ttdeci">std::vector&lt; KeyFrame * &gt; NClosestKeyFrames(KeyFrame &amp;k, unsigned int N)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00660">MapMaker.cpp:660</a></div></div>
<div class="ttc" id="a00591_html"><div class="ttname"><a href="../../d9/dad/a00591.html">SymEigen.h</a></div></div>
<div class="ttc" id="a00035_html_a5352ae090e38171322b6037776d0ff95"><div class="ttname"><a href="../../d4/d8c/a00035.html#a5352ae090e38171322b6037776d0ff95">Bundle::Compute</a></div><div class="ttdeci">int Compute(bool *pbAbortSignal)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00114">Bundle.cpp:114</a></div></div>
<div class="ttc" id="a00312_html_ab0fd585ba92b6b34eeb3c62ebcc30553"><div class="ttname"><a href="../../d7/df2/a00312.html#ab0fd585ba92b6b34eeb3c62ebcc30553">PatchFinder::FindPatchCoarse</a></div><div class="ttdeci">bool FindPatchCoarse(CVD::ImageRef ir, KeyFrame &amp;kf, unsigned int nRange)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/a00555_source.html#l00179">PatchFinder.cpp:179</a></div></div>
<div class="ttc" id="a00238_html_ae03e861c5fbf007178a4329e79034193"><div class="ttname"><a href="../../da/d2e/a00238.html#ae03e861c5fbf007178a4329e79034193">MapMaker::mvQueuedCommands</a></div><div class="ttdeci">std::vector&lt; Command &gt; mvQueuedCommands</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00109">MapMaker.h:109</a></div></div>
<div class="ttc" id="a00556_html"><div class="ttname"><a href="../../d6/d95/a00556.html">PatchFinder.h</a></div></div>
<div class="ttc" id="a00527_html"><div class="ttname"><a href="../../d9/d44/a00527.html">image_interpolate.h</a></div></div>
<div class="ttc" id="a00358_html_a6f349984d701630586ac4955c35733f7"><div class="ttname"><a href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">TooN::SE3::get_rotation</a></div><div class="ttdeci">SO3&lt; Precision &gt; &amp; get_rotation()</div><div class="ttdoc">Returns the rotation part of the transformation as a SO3. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/a00573_source.html#l00064">se3.h:64</a></div></div>
<div class="ttc" id="a00415_html"><div class="ttname"><a href="../../d0/dd6/a00415.html">TooN::SymEigen</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dad/a00591_source.html#l00260">SymEigen.h:260</a></div></div>
<div class="ttc" id="a00523_html_a33cfd229bb53b4055e430bd993782d41"><div class="ttname"><a href="../../d0/de7/a00523.html#a33cfd229bb53b4055e430bd993782d41">TooN::Identity</a></div><div class="ttdeci">static Operator&lt; Internal::Identity&lt; Internal::One &gt; &gt; Identity</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de9/a00552_source.html#l00748">objects.h:748</a></div></div>
<div class="ttc" id="a00312_html_ab7a3700856e0d86d37bcce1bbc2c4921"><div class="ttname"><a href="../../d7/df2/a00312.html#ab7a3700856e0d86d37bcce1bbc2c4921">PatchFinder::GetLevel</a></div><div class="ttdeci">int GetLevel()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/a00556_source.html#l00063">PatchFinder.h:63</a></div></div>
<div class="ttc" id="a00544_html"><div class="ttname"><a href="../../d2/ddf/a00544.html">MapPoint.h</a></div></div>
<div class="ttc" id="a00238_html_a67a058274e28423ec9e771aa18192afd"><div class="ttname"><a href="../../da/d2e/a00238.html#a67a058274e28423ec9e771aa18192afd">MapMaker::counterForConvergenceLimit</a></div><div class="ttdeci">int counterForConvergenceLimit</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00136">MapMaker.h:136</a></div></div>
<div class="ttc" id="a00190_html_a76a692cdb0afd83cc8f0cfe86813ad6a"><div class="ttname"><a href="../../d7/d6e/a00190.html#a76a692cdb0afd83cc8f0cfe86813ad6a">CVD::Image::resize</a></div><div class="ttdeci">void resize(const ImageRef &amp;size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d35/a00526_source.html#l00749">image.h:749</a></div></div>
<div class="ttc" id="a00238_html_a78b57ee0be0cf621f51c6656bd40db38"><div class="ttname"><a href="../../da/d2e/a00238.html#a78b57ee0be0cf621f51c6656bd40db38">MapMaker::AddPointEpipolar</a></div><div class="ttdeci">bool AddPointEpipolar(KeyFrame &amp;kSrc, KeyFrame &amp;kTarget, int nLevel, int nCandidate)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00497">MapMaker.cpp:497</a></div></div>
<div class="ttc" id="a00238_html_a74990580eaf0e89c81dec004b262227b"><div class="ttname"><a href="../../da/d2e/a00238.html#a74990580eaf0e89c81dec004b262227b">MapMaker::SetSendMessageToUnity</a></div><div class="ttdeci">void SetSendMessageToUnity(SendMessage sm)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00056">MapMaker.cpp:56</a></div></div>
<div class="ttc" id="a00542_html"><div class="ttname"><a href="../../d0/ddb/a00542.html">MapMaker.h</a></div></div>
<div class="ttc" id="a00240_html_a29a8af803dea1e8cf37f52971d59a40d"><div class="ttname"><a href="../../d9/d21/a00240.html#a29a8af803dea1e8cf37f52971d59a40d">MapPoint::v3Center_NC</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3Center_NC</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00054">MapPoint.h:54</a></div></div>
<div class="ttc" id="a00027_html_a7b8759d7fec56601d10e60ae487b96f7"><div class="ttname"><a href="../../d0/d33/a00027.html#a7b8759d7fec56601d10e60ae487b96f7">ATANCamera::Project</a></div><div class="ttdeci">Vector&lt; 2 &gt; Project(const Vector&lt; 2 &gt; &amp;camframe)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/a00479_source.html#l00109">ATANCamera.cpp:109</a></div></div>
<div class="ttc" id="a00238_html_a61c9bb8187e2197ff45dbcd7203b7810"><div class="ttname"><a href="../../da/d2e/a00238.html#a61c9bb8187e2197ff45dbcd7203b7810">MapMaker::sendStringToUnity</a></div><div class="ttdeci">SendMessage sendStringToUnity</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00134">MapMaker.h:134</a></div></div>
<div class="ttc" id="a00312_html_aee68ca3c5c899b56b52c4fce7fb177b0"><div class="ttname"><a href="../../d7/df2/a00312.html#aee68ca3c5c899b56b52c4fce7fb177b0">PatchFinder::MakeTemplateCoarseNoWarp</a></div><div class="ttdeci">void MakeTemplateCoarseNoWarp(MapPoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/a00555_source.html#l00152">PatchFinder.cpp:152</a></div></div>
<div class="ttc" id="a00240_html_aeeb275f21ac310dc15b78ebccd2cf4c3"><div class="ttname"><a href="../../d9/d21/a00240.html#aeeb275f21ac310dc15b78ebccd2cf4c3">MapPoint::v3OneDownFromCenter_NC</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3OneDownFromCenter_NC</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00055">MapPoint.h:55</a></div></div>
<div class="ttc" id="a00419_html_a1bc36ace032d86194d221db82f9d4c1f"><div class="ttname"><a href="../../d3/d29/a00419.html#a1bc36ace032d86194d221db82f9d4c1f">CVD::Thread::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">Tell the thread to stop. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00043">thread.cpp:43</a></div></div>
<div class="ttc" id="a00618_html_a54292001c2bdcba3cc04de6ce55f6735"><div class="ttname"><a href="../../de/d85/a00618.html#a54292001c2bdcba3cc04de6ce55f6735">CVD::vec</a></div><div class="ttdeci">TooN::Vector&lt; 2 &gt; vec(const ImageRef &amp;ir)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d6e/a00610_source.html#l00032">vector_image_ref.h:32</a></div></div>
<div class="ttc" id="a00238_html_ab6bd69f268aa8f05416c5071b93d5731"><div class="ttname"><a href="../../da/d2e/a00238.html#ab6bd69f268aa8f05416c5071b93d5731">MapMaker::QueueSize</a></div><div class="ttdeci">int QueueSize()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00058">MapMaker.h:58</a></div></div>
<div class="ttc" id="a00035_html"><div class="ttname"><a href="../../d4/d8c/a00035.html">Bundle</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00105">Bundle.h:105</a></div></div>
<div class="ttc" id="a00232_html_aa2fda57784edbadc7673541d76d32384"><div class="ttname"><a href="../../d0/d53/a00232.html#aa2fda57784edbadc7673541d76d32384">Level::im</a></div><div class="ttdeci">CVD::Image&lt; CVD::byte &gt; im</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00059">KeyFrame.h:59</a></div></div>
<div class="ttc" id="a00238_html_a63ec8516f1baefda696eeca0f7a2f376"><div class="ttname"><a href="../../da/d2e/a00238.html#a63ec8516f1baefda696eeca0f7a2f376">MapMaker::ResetDone</a></div><div class="ttdeci">bool ResetDone()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00126">MapMaker.cpp:126</a></div></div>
<div class="ttc" id="a00618_html_a68b6ddc8a27058be99ca964f9c8a46a6"><div class="ttname"><a href="../../de/d85/a00618.html#a68b6ddc8a27058be99ca964f9c8a46a6">CVD::ir_rounded</a></div><div class="ttdeci">ImageRef ir_rounded(const TooN::Vector&lt; 2 &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d6e/a00610_source.html#l00051">vector_image_ref.h:51</a></div></div>
<div class="ttc" id="a00226_html_a9ec9520a915b479c66d6c36402a48d75"><div class="ttname"><a href="../../dc/d55/a00226.html#a9ec9520a915b479c66d6c36402a48d75">KeyFrame::bFixed</a></div><div class="ttdeci">bool bFixed</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00083">KeyFrame.h:83</a></div></div>
<div class="ttc" id="a00312_html_ae420a3f2a92e22913edbc22d937fe6e9"><div class="ttname"><a href="../../d7/df2/a00312.html#ae420a3f2a92e22913edbc22d937fe6e9">PatchFinder::MakeSubPixTemplate</a></div><div class="ttdeci">void MakeSubPixTemplate()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/a00555_source.html#l00254">PatchFinder.cpp:254</a></div></div>
<div class="ttc" id="a00237_html_a248c8ef67476482fd303153494410c0b"><div class="ttname"><a href="../../d4/d08/a00237.html#a248c8ef67476482fd303153494410c0b">Map::bGood</a></div><div class="ttdeci">bool bGood</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d79/a00540_source.html#l00037">Map.h:37</a></div></div>
<div class="ttc" id="a00226_html_a666d792dbb1302b0ebfc38f2d8355e76"><div class="ttname"><a href="../../dc/d55/a00226.html#a666d792dbb1302b0ebfc38f2d8355e76">KeyFrame::dSceneDepthSigma</a></div><div class="ttdeci">double dSceneDepthSigma</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00092">KeyFrame.h:92</a></div></div>
<div class="ttc" id="a00240_html_a4bed63a6f5a86bbf08c94d46298d05b6"><div class="ttname"><a href="../../d9/d21/a00240.html#a4bed63a6f5a86bbf08c94d46298d05b6">MapPoint::v3Normal_NC</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3Normal_NC</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00057">MapPoint.h:57</a></div></div>
<div class="ttc" id="a00312_html_a25e62e13dfd15dccff6a3e4c76b7d13e"><div class="ttname"><a href="../../d7/df2/a00312.html#a25e62e13dfd15dccff6a3e4c76b7d13e">PatchFinder::SetSubPixPos</a></div><div class="ttdeci">void SetSubPixPos(Vector&lt; 2 &gt; v2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/a00556_source.html#l00096">PatchFinder.h:96</a></div></div>
<div class="ttc" id="a00240_html_a31da46621e41ac7cb508b3f264841269"><div class="ttname"><a href="../../d9/d21/a00240.html#a31da46621e41ac7cb508b3f264841269">MapPoint::pMMData</a></div><div class="ttdeci">MapMakerData * pMMData</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00064">MapPoint.h:64</a></div></div>
<div class="ttc" id="a00523_html_addcb08d3afb49cc2c43beb32546b9aa2"><div class="ttname"><a href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">TooN::unproject</a></div><div class="ttdeci">Vector&lt;(Size==Dynamic?Dynamic:Size+1), Precision &gt; unproject(const Vector&lt; Size, Precision, Base &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d14/a00522_source.html#l00166">helpers.h:166</a></div></div>
<div class="ttc" id="a00361_html_a5a856797c959c03cb9b014100c607e8a"><div class="ttname"><a href="../../d7/ddb/a00361.html#a5a856797c959c03cb9b014100c607e8a">SendMessage::SendStringToUnity</a></div><div class="ttdeci">void SendStringToUnity(const char *st)</div><div class="ttdoc">Send string to Unity3D </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dbe/a00574_source.html#l00046">SendMessage.cpp:46</a></div></div>
<div class="ttc" id="a00251_html_a35f6df617a54c2b0feaa68df21fa9113a205bee79ebde00d15f3bbd0e1cf2a8b5"><div class="ttname"><a href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113a205bee79ebde00d15f3bbd0e1cf2a8b5">Measurement::SRC_ROOT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00049">KeyFrame.h:49</a></div></div>
<div class="ttc" id="a00238_html_ae0efe8db35ef6dca5309bdd1d061906d"><div class="ttname"><a href="../../da/d2e/a00238.html#ae0efe8db35ef6dca5309bdd1d061906d">MapMaker::NeedNewKeyFrame</a></div><div class="ttdeci">bool NeedNewKeyFrame(KeyFrame &amp;kCurrent)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00706">MapMaker.cpp:706</a></div></div>
<div class="ttc" id="a00358_html_ad3b5bb26f63db1896fd8976fe356856b"><div class="ttname"><a href="../../df/d73/a00358.html#ad3b5bb26f63db1896fd8976fe356856b">TooN::SE3::inverse</a></div><div class="ttdeci">SE3 inverse() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/a00573_source.html#l00086">se3.h:86</a></div></div>
<div class="ttc" id="a00238_html_a270d6592f31c8026c809501ff4f2c2b9"><div class="ttname"><a href="../../da/d2e/a00238.html#a270d6592f31c8026c809501ff4f2c2b9">MapMaker::~MapMaker</a></div><div class="ttdeci">~MapMaker()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00160">MapMaker.cpp:160</a></div></div>
<div class="ttc" id="a00519_html_a7efec1be8bf6c331182c1470463381a7"><div class="ttname"><a href="../../dd/d4d/a00519.html#a7efec1be8bf6c331182c1470463381a7">MapMakerPlaneAlignerRansacs</a></div><div class="ttdeci">const int MapMakerPlaneAlignerRansacs</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00017">globals.h:17</a></div></div>
<div class="ttc" id="a00618_html"><div class="ttname"><a href="../../de/d85/a00618.html">CVD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d34/a00476_source.html#l00024">abs.h:24</a></div></div>
<div class="ttc" id="a00238_html_abebf774e59b5235bb445fcd1f1e5a95d"><div class="ttname"><a href="../../da/d2e/a00238.html#abebf774e59b5235bb445fcd1f1e5a95d">MapMaker::ReFind_Common</a></div><div class="ttdeci">bool ReFind_Common(KeyFrame &amp;k, MapPoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00911">MapMaker.cpp:911</a></div></div>
<div class="ttc" id="a00238_html_aa7d96efe0b86dcc43c64bce43d94d0fb"><div class="ttname"><a href="../../da/d2e/a00238.html#aa7d96efe0b86dcc43c64bce43d94d0fb">MapMaker::AddKeyFrame</a></div><div class="ttdeci">void AddKeyFrame(KeyFrame &amp;k)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00453">MapMaker.cpp:453</a></div></div>
<div class="ttc" id="a00238_html_af572c94fd8630c331f4f07a0d969b672"><div class="ttname"><a href="../../da/d2e/a00238.html#af572c94fd8630c331f4f07a0d969b672">MapMaker::mdWiggleScaleDepthNormalized</a></div><div class="ttdeci">double mdWiggleScaleDepthNormalized</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00120">MapMaker.h:120</a></div></div>
<div class="ttc" id="a00241_html"><div class="ttname"><a href="../../d6/db6/a00241.html">TooN::Matrix</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/deb/a00545_source.html#l00110">matrix.hh:110</a></div></div>
<div class="ttc" id="a00238_html_a63f5b9461a837c2e20c0905d0ff04df3"><div class="ttname"><a href="../../da/d2e/a00238.html#a63f5b9461a837c2e20c0905d0ff04df3">MapMaker::CalcPlaneAligner</a></div><div class="ttdeci">SE3 CalcPlaneAligner()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l01052">MapMaker.cpp:1052</a></div></div>
<div class="ttc" id="a00251_html_a873c633e494ae2bd6b6bcb5fe8a37018"><div class="ttname"><a href="../../d3/d1a/a00251.html#a873c633e494ae2bd6b6bcb5fe8a37018">Measurement::Source</a></div><div class="ttdeci">enum Measurement::@4 Source</div></div>
<div class="ttc" id="a00312_html_a151b80cb6e09bd8f91171f717379e85a"><div class="ttname"><a href="../../d7/df2/a00312.html#a151b80cb6e09bd8f91171f717379e85a">PatchFinder::GetSubPixPos</a></div><div class="ttdeci">Vector&lt; 2 &gt; GetSubPixPos()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/a00556_source.html#l00095">PatchFinder.h:95</a></div></div>
<div class="ttc" id="a00238_html_a4d21d52cbab5260c2298226164879018"><div class="ttname"><a href="../../da/d2e/a00238.html#a4d21d52cbab5260c2298226164879018">MapMaker::mbBundleRunningIsRecent</a></div><div class="ttdeci">bool mbBundleRunningIsRecent</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00131">MapMaker.h:131</a></div></div>
<div class="ttc" id="a00419_html_a4b5bb123039054efc597f23b9d9e1cd8"><div class="ttname"><a href="../../d3/d29/a00419.html#a4b5bb123039054efc597f23b9d9e1cd8">CVD::Thread::start</a></div><div class="ttdeci">void start(Runnable *runnable=0)</div><div class="ttdoc">Start execution of "run" method in separate thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00032">thread.cpp:32</a></div></div>
<div class="ttc" id="a00027_html_ab7a667985d26a7f200303b5d7a068883"><div class="ttname"><a href="../../d0/d33/a00027.html#ab7a667985d26a7f200303b5d7a068883">ATANCamera::UnProject</a></div><div class="ttdeci">Vector&lt; 2 &gt; UnProject(const Vector&lt; 2 &gt; &amp;imframe)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/a00479_source.html#l00125">ATANCamera.cpp:125</a></div></div>
<div class="ttc" id="a00415_html_af3b55b25ac040ce826a229b4521ea64d"><div class="ttname"><a href="../../d0/dd6/a00415.html#af3b55b25ac040ce826a229b4521ea64d">TooN::SymEigen::get_evectors</a></div><div class="ttdeci">Matrix&lt; Size, Size, Precision &gt; &amp; get_evectors()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dad/a00591_source.html#l00336">SymEigen.h:336</a></div></div>
<div class="ttc" id="a00237_html_a7a2a1024fff77881aaac79ec166f824c"><div class="ttname"><a href="../../d4/d08/a00237.html#a7a2a1024fff77881aaac79ec166f824c">Map::vpPoints</a></div><div class="ttdeci">std::vector&lt; MapPoint * &gt; vpPoints</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d79/a00540_source.html#l00033">Map.h:33</a></div></div>
<div class="ttc" id="a00238_html_a7d73ebc06bba5755f86e62aafa22e422"><div class="ttname"><a href="../../da/d2e/a00238.html#a7d73ebc06bba5755f86e62aafa22e422">MapMaker::run</a></div><div class="ttdeci">virtual void run()</div><div class="ttdoc">Override this method to do whatever it is the thread should do. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00066">MapMaker.cpp:66</a></div></div>
<div class="ttc" id="a00035_html_ae70602edb7b657e68e4219d3f66c491b"><div class="ttname"><a href="../../d4/d8c/a00035.html#ae70602edb7b657e68e4219d3f66c491b">Bundle::AddCamera</a></div><div class="ttdeci">int AddCamera(SE3&lt;&gt; se3CamFromWorld, bool bFixed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00045">Bundle.cpp:45</a></div></div>
<div class="ttc" id="a00312_html_a408d56e1452dedb8ea6e422524efc860"><div class="ttname"><a href="../../d7/df2/a00312.html#a408d56e1452dedb8ea6e422524efc860">PatchFinder::GetCoarsePosAsVector</a></div><div class="ttdeci">Vector&lt; 2 &gt; GetCoarsePosAsVector()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/a00556_source.html#l00087">PatchFinder.h:87</a></div></div>
<div class="ttc" id="a00232_html_af7aeb49dc6feb05123de49d9c17cecfc"><div class="ttname"><a href="../../d0/d53/a00232.html#af7aeb49dc6feb05123de49d9c17cecfc">Level::bImplaneCornersCached</a></div><div class="ttdeci">bool bImplaneCornersCached</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00069">KeyFrame.h:69</a></div></div>
<div class="ttc" id="a00587_html"><div class="ttname"><a href="../../de/dde/a00587.html">SmallMatrixOpts.h</a></div></div>
<div class="ttc" id="a00238_html_a095e4e32cf2d29098f5ba6be201d9daf"><div class="ttname"><a href="../../da/d2e/a00238.html#a095e4e32cf2d29098f5ba6be201d9daf">MapMaker::MapMaker</a></div><div class="ttdeci">MapMaker(Map &amp;m, const ATANCamera &amp;cam)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00029">MapMaker.cpp:29</a></div></div>
<div class="ttc" id="a00519_html_ad998045dffe4236d255e6da207a6bffb"><div class="ttname"><a href="../../dd/d4d/a00519.html#ad998045dffe4236d255e6da207a6bffb">MapMakerWiggleScale</a></div><div class="ttdeci">const double MapMakerWiggleScale</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00025">globals.h:25</a></div></div>
<div class="ttc" id="a00238_html_a2962f5bcf1a82d1a495a22582955cbb2"><div class="ttname"><a href="../../da/d2e/a00238.html#a2962f5bcf1a82d1a495a22582955cbb2">MapMaker::BundleAdjustRecent</a></div><div class="ttdeci">void BundleAdjustRecent()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00739">MapMaker.cpp:739</a></div></div>
<div class="ttc" id="a00312_html_a4cbaa59c947171f27fafe5fcd0523ba0"><div class="ttname"><a href="../../d7/df2/a00312.html#a4cbaa59c947171f27fafe5fcd0523ba0">PatchFinder::mnMaxSSD</a></div><div class="ttdeci">int mnMaxSSD</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/a00556_source.html#l00103">PatchFinder.h:103</a></div></div>
<div class="ttc" id="a00238_html_a8dc84e6436a9d0793a760cd6fb723dfb"><div class="ttname"><a href="../../da/d2e/a00238.html#a8dc84e6436a9d0793a760cd6fb723dfb">MapMaker::ApplyGlobalTransformationToMap</a></div><div class="ttdeci">void ApplyGlobalTransformationToMap(SE3&lt;&gt; se3NewFromOld)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00420">MapMaker.cpp:420</a></div></div>
<div class="ttc" id="a00057_html_a1f0e42bef573f24cf76cff2bcab6dc85"><div class="ttname"><a href="../../d1/d22/a00057.html#a1f0e42bef573f24cf76cff2bcab6dc85">MapMaker::Command::sParams</a></div><div class="ttdeci">std::string sParams</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00108">MapMaker.h:108</a></div></div>
<div class="ttc" id="a00312_html_a8d19042d223df949d37476be75c5c47d"><div class="ttname"><a href="../../d7/df2/a00312.html#a8d19042d223df949d37476be75c5c47d">PatchFinder::IterateSubPixToConvergence</a></div><div class="ttdeci">bool IterateSubPixToConvergence(KeyFrame &amp;kf, int nMaxIts)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/a00555_source.html#l00286">PatchFinder.cpp:286</a></div></div>
<div class="ttc" id="a00238_html_af81acbc8521774e9f6b69efc8f0907e4"><div class="ttname"><a href="../../da/d2e/a00238.html#af81acbc8521774e9f6b69efc8f0907e4">MapMaker::ReFindFromFailureQueue</a></div><div class="ttdeci">void ReFindFromFailureQueue()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l01031">MapMaker.cpp:1031</a></div></div>
<div class="ttc" id="a00238_html"><div class="ttname"><a href="../../da/d2e/a00238.html">MapMaker</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00039">MapMaker.h:39</a></div></div>
<div class="ttc" id="a00312_html_a0eec8894904ce79ec503d556ca853106"><div class="ttname"><a href="../../d7/df2/a00312.html#a0eec8894904ce79ec503d556ca853106">PatchFinder::TemplateBad</a></div><div class="ttdeci">bool TemplateBad()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/a00556_source.html#l00076">PatchFinder.h:76</a></div></div>
<div class="ttc" id="a00238_html_a8cfc18567123cd2d054a41c0a5731ec5"><div class="ttname"><a href="../../da/d2e/a00238.html#a8cfc18567123cd2d054a41c0a5731ec5">MapMaker::mbBundleRunning</a></div><div class="ttdeci">bool mbBundleRunning</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00130">MapMaker.h:130</a></div></div>
<div class="ttc" id="a00190_html"><div class="ttname"><a href="../../d7/d6e/a00190.html">CVD::Image</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d35/a00526_source.html#l00617">image.h:617</a></div></div>
<div class="ttc" id="a00361_html"><div class="ttname"><a href="../../d7/ddb/a00361.html">SendMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d42/a00575_source.html#l00011">SendMessage.h:11</a></div></div>
<div class="ttc" id="a00198_html_a0eb956391ba9f250ee00f15a294dc334"><div class="ttname"><a href="../../d7/da0/a00198.html#a0eb956391ba9f250ee00f15a294dc334">CVD::ImageRef::next</a></div><div class="ttdeci">bool next(const ImageRef &amp;max)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d81/a00528_source.html#l00220">image_ref.h:220</a></div></div>
<div class="ttc" id="a00226_html"><div class="ttname"><a href="../../dc/d55/a00226.html">KeyFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00076">KeyFrame.h:76</a></div></div>
<div class="ttc" id="a00590_html"><div class="ttname"><a href="../../d7/db1/a00590.html">SVD.h</a></div></div>
<div class="ttc" id="a00226_html_a4962879f78735ad057b1e943a36ae9f6"><div class="ttname"><a href="../../dc/d55/a00226.html#a4962879f78735ad057b1e943a36ae9f6">KeyFrame::aLevels</a></div><div class="ttdeci">Level aLevels[LEVELS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00084">KeyFrame.h:84</a></div></div>
<div class="ttc" id="a00240_html_a8f25f0ad4b410ee531991e9dbbd212d5"><div class="ttname"><a href="../../d9/d21/a00240.html#a8f25f0ad4b410ee531991e9dbbd212d5">MapPoint::nSourceLevel</a></div><div class="ttdeci">int nSourceLevel</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00047">MapPoint.h:47</a></div></div>
<div class="ttc" id="a00414_html"><div class="ttname"><a href="../../d4/dbc/a00414.html">TooN::SVD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db1/a00590_source.html#l00089">SVD.h:89</a></div></div>
<div class="ttc" id="a00240_html_ae303940d5542eb614c0609ad0681846f"><div class="ttname"><a href="../../d9/d21/a00240.html#ae303940d5542eb614c0609ad0681846f">MapPoint::irCenter</a></div><div class="ttdeci">CVD::ImageRef irCenter</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00048">MapPoint.h:48</a></div></div>
<div class="ttc" id="a00238_html_aba8f85cb9ffe674f95f5648d4354445c"><div class="ttname"><a href="../../da/d2e/a00238.html#aba8f85cb9ffe674f95f5648d4354445c">MapMaker::mCamera</a></div><div class="ttdeci">ATANCamera mCamera</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00066">MapMaker.h:66</a></div></div>
<div class="ttc" id="a00232_html_a6a78a28fc72de71b2640f6aef2161b07"><div class="ttname"><a href="../../d0/d53/a00232.html#a6a78a28fc72de71b2640f6aef2161b07">Level::vCorners</a></div><div class="ttdeci">std::vector&lt; CVD::ImageRef &gt; vCorners</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00062">KeyFrame.h:62</a></div></div>
<div class="ttc" id="a00312_html"><div class="ttname"><a href="../../d7/df2/a00312.html">PatchFinder</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d95/a00556_source.html#l00049">PatchFinder.h:49</a></div></div>
<div class="ttc" id="a00035_html_a671f50417b518e0930bfcc09a1b1b41e"><div class="ttname"><a href="../../d4/d8c/a00035.html#a671f50417b518e0930bfcc09a1b1b41e">Bundle::AddMeas</a></div><div class="ttdeci">void AddMeas(int nCam, int nPoint, Vector&lt; 2 &gt; v2Pos, double dSigmaSquared)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00080">Bundle.cpp:80</a></div></div>
<div class="ttc" id="a00358_html"><div class="ttname"><a href="../../df/d73/a00358.html">TooN::SE3</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/a00573_source.html#l00050">se3.h:50</a></div></div>
<div class="ttc" id="a00186_html_af17dfb8b7fc2a00fd27329e848067104"><div class="ttname"><a href="../../d8/d00/a00186.html#af17dfb8b7fc2a00fd27329e848067104">HomographyMatch::m2PixelProjectionJac</a></div><div class="ttdeci">Matrix&lt; 2 &gt; m2PixelProjectionJac</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db7/a00525_source.html#l00028">HomographyInit.h:28</a></div></div>
<div class="ttc" id="a00232_html_ae808e99245a500d750e5b2b0020ca4ce"><div class="ttname"><a href="../../d0/d53/a00232.html#ae808e99245a500d750e5b2b0020ca4ce">Level::vImplaneCorners</a></div><div class="ttdeci">std::vector&lt; Vector&lt; 2 &gt; &gt; vImplaneCorners</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00070">KeyFrame.h:70</a></div></div>
<div class="ttc" id="a00238_html_a132fc4c7223676386cb8da420b151796"><div class="ttname"><a href="../../da/d2e/a00238.html#a132fc4c7223676386cb8da420b151796">MapMaker::RequestReset</a></div><div class="ttdeci">void RequestReset()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00120">MapMaker.cpp:120</a></div></div>
<div class="ttc" id="a00226_html_af87142bc44ffa9ed3d9aa11f7f34ae59"><div class="ttname"><a href="../../dc/d55/a00226.html#af87142bc44ffa9ed3d9aa11f7f34ae59">KeyFrame::MakeKeyFrame_Rest</a></div><div class="ttdeci">void MakeKeyFrame_Rest()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d2a/a00531_source.html#l00069">KeyFrame.cpp:69</a></div></div>
<div class="ttc" id="a00237_html_a54fcd84b47c4ddfe95dfb100279d3b50"><div class="ttname"><a href="../../d4/d08/a00237.html#a54fcd84b47c4ddfe95dfb100279d3b50">Map::vpKeyFrames</a></div><div class="ttdeci">std::vector&lt; KeyFrame * &gt; vpKeyFrames</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d79/a00540_source.html#l00035">Map.h:35</a></div></div>
<div class="ttc" id="a00238_html_a3d209f013487695dcfaab1708e62a919"><div class="ttname"><a href="../../da/d2e/a00238.html#a3d209f013487695dcfaab1708e62a919">MapMaker::mvFailureQueue</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; KeyFrame *, MapPoint * &gt; &gt; mvFailureQueue</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00114">MapMaker.h:114</a></div></div>
<div class="ttc" id="a00238_html_ad7c06731385e36073b32dba5d8eadb98"><div class="ttname"><a href="../../da/d2e/a00238.html#ad7c06731385e36073b32dba5d8eadb98">MapMaker::InitFromStereo</a></div><div class="ttdeci">bool InitFromStereo(KeyFrame &amp;kFirst, KeyFrame &amp;kSecond, std::vector&lt; std::pair&lt; CVD::ImageRef, CVD::ImageRef &gt; &gt; &amp;vMatches, SE3&lt;&gt; &amp;se3CameraPos)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00196">MapMaker.cpp:196</a></div></div>
<div class="ttc" id="a00226_html_a11ad67f26985d5400a466e2baa8fafa9"><div class="ttname"><a href="../../dc/d55/a00226.html#a11ad67f26985d5400a466e2baa8fafa9">KeyFrame::se3CfromW</a></div><div class="ttdeci">SE3 se3CfromW</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00082">KeyFrame.h:82</a></div></div>
<div class="ttc" id="a00239_html_aa55693a6fa1a7d6afc7271efb8d8f415"><div class="ttname"><a href="../../d0/d27/a00239.html#aa55693a6fa1a7d6afc7271efb8d8f415">MapMakerData::sMeasurementKFs</a></div><div class="ttdeci">std::set&lt; KeyFrame * &gt; sMeasurementKFs</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00032">MapMaker.h:32</a></div></div>
<div class="ttc" id="a00240_html_a03926fa19108aea2b524e8a244853eb7"><div class="ttname"><a href="../../d9/d21/a00240.html#a03926fa19108aea2b524e8a244853eb7">MapPoint::v3WorldPos</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3WorldPos</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00038">MapPoint.h:38</a></div></div>
<div class="ttc" id="a00232_html"><div class="ttname"><a href="../../d0/d53/a00232.html">Level</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00054">KeyFrame.h:54</a></div></div>
<div class="ttc" id="a00238_html_aacf6ccdbb7319145759f91c26c328925"><div class="ttname"><a href="../../da/d2e/a00238.html#aacf6ccdbb7319145759f91c26c328925">MapMaker::ReFindInSingleKeyFrame</a></div><div class="ttdeci">int ReFindInSingleKeyFrame(KeyFrame &amp;k)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00992">MapMaker.cpp:992</a></div></div>
<div class="ttc" id="a00237_html_a81c598897a9b30ece4f2a9acffaa6572"><div class="ttname"><a href="../../d4/d08/a00237.html#a81c598897a9b30ece4f2a9acffaa6572">Map::IsGood</a></div><div class="ttdeci">bool IsGood()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d79/a00540_source.html#l00027">Map.h:27</a></div></div>
<div class="ttc" id="a00632_html"><div class="ttname"><a href="../../d4/d2a/a00632.html">std</a></div></div>
<div class="ttc" id="a00407_html_a1fe56e4395ac4f7e342c75a222c84e14"><div class="ttname"><a href="../../d1/d98/a00407.html#a1fe56e4395ac4f7e342c75a222c84e14">CVD::SubImage::size</a></div><div class="ttdeci">ImageRef size() const </div><div class="ttdoc">What is the size of this image? </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d35/a00526_source.html#l00370">image.h:370</a></div></div>
<div class="ttc" id="a00238_html_ab299bcefff0f8ff64dcd78d0d4e3a125"><div class="ttname"><a href="../../da/d2e/a00238.html#ab299bcefff0f8ff64dcd78d0d4e3a125">MapMaker::mbBundleConverged_Full</a></div><div class="ttdeci">bool mbBundleConverged_Full</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00123">MapMaker.h:123</a></div></div>
<div class="ttc" id="a00238_html_a4fd01daa4cb3639d06395090393b98ae"><div class="ttname"><a href="../../da/d2e/a00238.html#a4fd01daa4cb3639d06395090393b98ae">MapMaker::HandleBadPoints</a></div><div class="ttdeci">void HandleBadPoints()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00133">MapMaker.cpp:133</a></div></div>
<div class="ttc" id="a00541_html_af90522af8a334fe76d3405d2ba2db72d"><div class="ttname"><a href="../../dd/d72/a00541.html#af90522af8a334fe76d3405d2ba2db72d">CHECK_RESET</a></div><div class="ttdeci">#define CHECK_RESET</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00064">MapMaker.cpp:64</a></div></div>
<div class="ttc" id="a00238_html_a99d08a8ec4f80cfa846ee7bd4da1e485"><div class="ttname"><a href="../../da/d2e/a00238.html#a99d08a8ec4f80cfa846ee7bd4da1e485">MapMaker::mbBundleAbortRequested</a></div><div class="ttdeci">bool mbBundleAbortRequested</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00129">MapMaker.h:129</a></div></div>
<div class="ttc" id="a00037_html"><div class="ttname"><a href="../../d1/dc6/a00037.html">Candidate</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00036">KeyFrame.h:36</a></div></div>
<div class="ttc" id="a00251_html_a5f70cb9184ceda4c08eb7a87ec415017"><div class="ttname"><a href="../../d3/d1a/a00251.html#a5f70cb9184ceda4c08eb7a87ec415017">Measurement::v2RootPos</a></div><div class="ttdeci">Vector&lt; 2 &gt; v2RootPos</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00048">KeyFrame.h:48</a></div></div>
<div class="ttc" id="a00027_html_a47a3acba7e89c611cf41ff92bcce2d20"><div class="ttname"><a href="../../d0/d33/a00027.html#a47a3acba7e89c611cf41ff92bcce2d20">ATANCamera::Invalid</a></div><div class="ttdeci">bool Invalid()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/a00480_source.html#l00089">ATANCamera.h:89</a></div></div>
<div class="ttc" id="a00237_html"><div class="ttname"><a href="../../d4/d08/a00237.html">Map</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d79/a00540_source.html#l00024">Map.h:24</a></div></div>
<div class="ttc" id="a00240_html_a8c958cd63519400a12190d3ed3a7c8e3"><div class="ttname"><a href="../../d9/d21/a00240.html#a8c958cd63519400a12190d3ed3a7c8e3">MapPoint::v3OneRightFromCenter_NC</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3OneRightFromCenter_NC</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00056">MapPoint.h:56</a></div></div>
<div class="ttc" id="a00251_html_a66c7c032b20703d9e081527bb30f086b"><div class="ttname"><a href="../../d3/d1a/a00251.html#a66c7c032b20703d9e081527bb30f086b">Measurement::nLevel</a></div><div class="ttdeci">int nLevel</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00046">KeyFrame.h:46</a></div></div>
<div class="ttc" id="a00618_html_ab323db82d94f28c3a207b04311136a51"><div class="ttname"><a href="../../de/d85/a00618.html#ab323db82d94f28c3a207b04311136a51">CVD::ir</a></div><div class="ttdeci">ImageRef ir(const TooN::Vector&lt; 2 &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d6e/a00610_source.html#l00043">vector_image_ref.h:43</a></div></div>
<div class="ttc" id="a00251_html_a35f6df617a54c2b0feaa68df21fa9113aec472b0785dc395d045fbe27f9a14db0"><div class="ttname"><a href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113aec472b0785dc395d045fbe27f9a14db0">Measurement::SRC_REFIND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00049">KeyFrame.h:49</a></div></div>
<div class="ttc" id="a00240_html_af3b32587aca37b06999a3a896e898dff"><div class="ttname"><a href="../../d9/d21/a00240.html#af3b32587aca37b06999a3a896e898dff">MapPoint::nMEstimatorInlierCount</a></div><div class="ttdeci">int nMEstimatorInlierCount</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00071">MapPoint.h:71</a></div></div>
<div class="ttc" id="a00525_html"><div class="ttname"><a href="../../d7/db7/a00525.html">HomographyInit.h</a></div></div>
<div class="ttc" id="a00238_html_abb1d9ea9b87bb26bf32ffed49e2b0790"><div class="ttname"><a href="../../da/d2e/a00238.html#abb1d9ea9b87bb26bf32ffed49e2b0790">MapMaker::DistToNearestKeyFrame</a></div><div class="ttdeci">double DistToNearestKeyFrame(KeyFrame &amp;kCurrent)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00699">MapMaker.cpp:699</a></div></div>
<div class="ttc" id="a00238_html_a7df530be186d2f1f85601804b9d1749e"><div class="ttname"><a href="../../da/d2e/a00238.html#a7df530be186d2f1f85601804b9d1749e">MapMaker::ThinCandidates</a></div><div class="ttdeci">void ThinCandidates(KeyFrame &amp;k, int nLevel)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00369">MapMaker.cpp:369</a></div></div>
<div class="ttc" id="a00312_html_adafdd7c5bce8800e2219ed1f34e7f2b3"><div class="ttname"><a href="../../d7/df2/a00312.html#adafdd7c5bce8800e2219ed1f34e7f2b3">PatchFinder::ZMSSDAtPoint</a></div><div class="ttdeci">int ZMSSDAtPoint(CVD::BasicImage&lt; CVD::byte &gt; &amp;im, const CVD::ImageRef &amp;ir)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/a00555_source.html#l00400">PatchFinder.cpp:400</a></div></div>
<div class="ttc" id="a00238_html_a87b67b4e9d0f25434c4c30661e068bb8"><div class="ttname"><a href="../../da/d2e/a00238.html#a87b67b4e9d0f25434c4c30661e068bb8">MapMaker::RefreshSceneDepth</a></div><div class="ttdeci">void RefreshSceneDepth(KeyFrame *pKF)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l01159">MapMaker.cpp:1159</a></div></div>
<div class="ttc" id="a00238_html_a919708e6565165405fd5370f0987d63d"><div class="ttname"><a href="../../da/d2e/a00238.html#a919708e6565165405fd5370f0987d63d">MapMaker::mbResetRequested</a></div><div class="ttdeci">bool mbResetRequested</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00127">MapMaker.h:127</a></div></div>
<div class="ttc" id="a00238_html_ae7e294031f100c07e72ac167478fb587"><div class="ttname"><a href="../../da/d2e/a00238.html#ae7e294031f100c07e72ac167478fb587">MapMaker::BundleAdjustAll</a></div><div class="ttdeci">void BundleAdjustAll()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00718">MapMaker.cpp:718</a></div></div>
<div class="ttc" id="a00358_html_a0284c7cd9479da896ab29d6c62c41844"><div class="ttname"><a href="../../df/d73/a00358.html#a0284c7cd9479da896ab29d6c62c41844">TooN::SE3::get_translation</a></div><div class="ttdeci">Vector&lt; 3, Precision &gt; &amp; get_translation()</div><div class="ttdoc">Returns the translation part of the transformation as a Vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/a00573_source.html#l00069">se3.h:69</a></div></div>
<div class="ttc" id="a00240_html"><div class="ttname"><a href="../../d9/d21/a00240.html">MapPoint</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00027">MapPoint.h:27</a></div></div>
<div class="ttc" id="a00226_html_a10f009ec03cf0da1e9d2d22445f492b6"><div class="ttname"><a href="../../dc/d55/a00226.html#a10f009ec03cf0da1e9d2d22445f492b6">KeyFrame::mMeasurements</a></div><div class="ttdeci">std::map&lt; MapPoint *, Measurement &gt; mMeasurements</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00085">KeyFrame.h:85</a></div></div>
<div class="ttc" id="a00523_html_a0bbd0ef9cb4419e4037c4c6e7e2835e3"><div class="ttname"><a href="../../d0/de7/a00523.html#a0bbd0ef9cb4419e4037c4c6e7e2835e3">TooN::makeVector</a></div><div class="ttdeci">Vector&lt; 1 &gt; makeVector(double x1)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d5a/a00538_source.html#l00004">make_vector.hh:4</a></div></div>
<div class="ttc" id="a00414_html_aed67d44bde8f88928223508616471796"><div class="ttname"><a href="../../d4/dbc/a00414.html#aed67d44bde8f88928223508616471796">TooN::SVD::get_VT</a></div><div class="ttdeci">Matrix&lt; Min_Dim, Cols, Precision, Reference::RowMajor &gt; get_VT()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db1/a00590_source.html#l00254">SVD.h:254</a></div></div>
<div class="ttc" id="a00611_html"><div class="ttname"><a href="../../dd/dc0/a00611.html">vision.h</a></div></div>
<div class="ttc" id="a00198_html"><div class="ttname"><a href="../../d7/da0/a00198.html">CVD::ImageRef</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d81/a00528_source.html#l00047">image_ref.h:47</a></div></div>
<div class="ttc" id="a00027_html_a9876a55ce3fbbf3cf9a4a1d1f1f89fd2"><div class="ttname"><a href="../../d0/d33/a00027.html#a9876a55ce3fbbf3cf9a4a1d1f1f89fd2">ATANCamera::OnePixelDist</a></div><div class="ttdeci">double OnePixelDist()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/a00480_source.html#l00091">ATANCamera.h:91</a></div></div>
<div class="ttc" id="a00240_html_a672c3703014d88356b74aab95729522b"><div class="ttname"><a href="../../d9/d21/a00240.html#a672c3703014d88356b74aab95729522b">MapPoint::pPatchSourceKF</a></div><div class="ttdeci">KeyFrame * pPatchSourceKF</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddf/a00544_source.html#l00046">MapPoint.h:46</a></div></div>
<div class="ttc" id="a00057_html"><div class="ttname"><a href="../../d1/d22/a00057.html">MapMaker::Command</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00108">MapMaker.h:108</a></div></div>
<div class="ttc" id="a00035_html_a8ecc89fd42395a78fc286b237f7f4007"><div class="ttname"><a href="../../d4/d8c/a00035.html#a8ecc89fd42395a78fc286b237f7f4007">Bundle::GetCamera</a></div><div class="ttdeci">SE3 GetCamera(int n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00630">Bundle.cpp:630</a></div></div>
<div class="ttc" id="a00186_html"><div class="ttname"><a href="../../d8/d00/a00186.html">HomographyMatch</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db7/a00525_source.html#l00023">HomographyInit.h:23</a></div></div>
<div class="ttc" id="a00027_html_a700b037d4c41f7aa2ab1b42ed57759b8"><div class="ttname"><a href="../../d0/d33/a00027.html#a700b037d4c41f7aa2ab1b42ed57759b8">ATANCamera::SetImageSize</a></div><div class="ttdeci">void SetImageSize(Vector&lt; 2 &gt; v2ImageSize)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/a00479_source.html#l00021">ATANCamera.cpp:21</a></div></div>
<div class="ttc" id="a00186_html_ad617aa0a0a4b0519a96fea4883a2d18c"><div class="ttname"><a href="../../d8/d00/a00186.html#ad617aa0a0a4b0519a96fea4883a2d18c">HomographyMatch::v2CamPlaneFirst</a></div><div class="ttdeci">Vector&lt; 2 &gt; v2CamPlaneFirst</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db7/a00525_source.html#l00026">HomographyInit.h:26</a></div></div>
<div class="ttc" id="a00239_html_ae912e06715985c8b2ea4ab251d49d217"><div class="ttname"><a href="../../d0/d27/a00239.html#ae912e06715985c8b2ea4ab251d49d217">MapMakerData::GoodMeasCount</a></div><div class="ttdeci">int GoodMeasCount()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00034">MapMaker.h:34</a></div></div>
<div class="ttc" id="a00238_html_ac12684b9215fd27c9aff2142d3c399d1"><div class="ttname"><a href="../../da/d2e/a00238.html#ac12684b9215fd27c9aff2142d3c399d1">MapMaker::GUICommandCallBack</a></div><div class="ttdeci">static void GUICommandCallBack(void *ptr, std::string sCommand, std::string sParams)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l01178">MapMaker.cpp:1178</a></div></div>
<div class="ttc" id="a00226_html_a994d0023adb8348cfa6ecd4f61db0b8b"><div class="ttname"><a href="../../dc/d55/a00226.html#a994d0023adb8348cfa6ecd4f61db0b8b">KeyFrame::dSceneDepthMean</a></div><div class="ttdeci">double dSceneDepthMean</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00091">KeyFrame.h:91</a></div></div>
<div class="ttc" id="a00238_html_a182f1ce425b31f467f1f85029fca0b1b"><div class="ttname"><a href="../../da/d2e/a00238.html#a182f1ce425b31f467f1f85029fca0b1b">MapMaker::mdWiggleScale</a></div><div class="ttdeci">double mdWiggleScale</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00117">MapMaker.h:117</a></div></div>
<div class="ttc" id="a00419_html_a875f8d943ae1ca5b78fc5a388ac6107f"><div class="ttname"><a href="../../d3/d29/a00419.html#a875f8d943ae1ca5b78fc5a388ac6107f">CVD::Thread::shouldStop</a></div><div class="ttdeci">bool shouldStop() const </div><div class="ttdoc">Returns true if the stop() method been called, false otherwise. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00048">thread.cpp:48</a></div></div>
<div class="ttc" id="a00035_html_a6e02e2734d763c902a457c2ca6496b3a"><div class="ttname"><a href="../../d4/d8c/a00035.html#a6e02e2734d763c902a457c2ca6496b3a">Bundle::GetPoint</a></div><div class="ttdeci">Vector&lt; 3 &gt; GetPoint(int n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00625">Bundle.cpp:625</a></div></div>
<div class="ttc" id="a00027_html_a0ee8b994cfc26cb8113cb741f116d10a"><div class="ttname"><a href="../../d0/d33/a00027.html#a0ee8b994cfc26cb8113cb741f116d10a">ATANCamera::LargestRadiusInImage</a></div><div class="ttdeci">double LargestRadiusInImage()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/a00480_source.html#l00090">ATANCamera.h:90</a></div></div>
<div class="ttc" id="a00238_html_a85525dbaad3bdbca8bc1bfc7971448bd"><div class="ttname"><a href="../../da/d2e/a00238.html#a85525dbaad3bdbca8bc1bfc7971448bd">MapMaker::mvpKeyFrameQueue</a></div><div class="ttdeci">std::vector&lt; KeyFrame * &gt; mvpKeyFrameQueue</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00113">MapMaker.h:113</a></div></div>
<div class="ttc" id="a00312_html_ac18c27a1e4b82b1ca70f38e7b30e9ca5"><div class="ttname"><a href="../../d7/df2/a00312.html#ac18c27a1e4b82b1ca70f38e7b30e9ca5">PatchFinder::MakeTemplateCoarse</a></div><div class="ttdeci">void MakeTemplateCoarse(MapPoint &amp;p, SE3&lt;&gt; se3CFromW, Matrix&lt; 2 &gt; &amp;m2CamDerivs)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d75/a00555_source.html#l00072">PatchFinder.cpp:72</a></div></div>
<div class="ttc" id="a00238_html_a886570cf889020c5d8fa2e01ce75996c"><div class="ttname"><a href="../../da/d2e/a00238.html#a886570cf889020c5d8fa2e01ce75996c">MapMaker::AddKeyFrameFromTopOfQueue</a></div><div class="ttdeci">void AddKeyFrameFromTopOfQueue()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00464">MapMaker.cpp:464</a></div></div>
<div class="ttc" id="a00536_html_acc2bcb395bb1daa33db81ad8f7de84a5"><div class="ttname"><a href="../../d4/d33/a00536.html#acc2bcb395bb1daa33db81ad8f7de84a5">LevelZeroPos</a></div><div class="ttdeci">double LevelZeroPos(double dLevelPos, int nLevel)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d33/a00536_source.html#l00026">LevelHelpers.h:26</a></div></div>
<div class="ttc" id="a00451_html"><div class="ttname"><a href="../../d9/d69/a00451.html">TooN::Vector&lt; 3 &gt;</a></div></div>
<div class="ttc" id="a00251_html"><div class="ttname"><a href="../../d3/d1a/a00251.html">Measurement</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00044">KeyFrame.h:44</a></div></div>
<div class="ttc" id="a00238_html_a7acc986af8bf436463c1812fe1704c1f"><div class="ttname"><a href="../../da/d2e/a00238.html#a7acc986af8bf436463c1812fe1704c1f">MapMaker::ApplyGlobalScaleToMap</a></div><div class="ttdeci">void ApplyGlobalScaleToMap(double dScale)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00435">MapMaker.cpp:435</a></div></div>
<div class="ttc" id="a00035_html_abd17195bae194ceaa0de36753f73be44"><div class="ttname"><a href="../../d4/d8c/a00035.html#abd17195bae194ceaa0de36753f73be44">Bundle::Converged</a></div><div class="ttdeci">bool Converged()</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00114">Bundle.h:114</a></div></div>
<div class="ttc" id="a00237_html_a3ad3feb9bd254e8c548d79e3ffdfb9a0"><div class="ttname"><a href="../../d4/d08/a00237.html#a3ad3feb9bd254e8c548d79e3ffdfb9a0">Map::MoveBadPointsToTrash</a></div><div class="ttdeci">void MoveBadPointsToTrash()</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d87/a00539_source.html#l00019">Map.cpp:19</a></div></div>
<div class="ttc" id="a00232_html_a36ae51f17356652e76d6ef3f9fb94a06"><div class="ttname"><a href="../../d0/d53/a00232.html#a36ae51f17356652e76d6ef3f9fb94a06">Level::vCandidates</a></div><div class="ttdeci">std::vector&lt; Candidate &gt; vCandidates</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00067">KeyFrame.h:67</a></div></div>
<div class="ttc" id="a00057_html_a79daf7e66fafd4d6e1451ad40953df50"><div class="ttname"><a href="../../d1/d22/a00057.html#a79daf7e66fafd4d6e1451ad40953df50">MapMaker::Command::sCommand</a></div><div class="ttdeci">std::string sCommand</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00108">MapMaker.h:108</a></div></div>
<div class="ttc" id="a00251_html_a35f6df617a54c2b0feaa68df21fa9113ac615ce28616d89dc3458d23f76565256"><div class="ttname"><a href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113ac615ce28616d89dc3458d23f76565256">Measurement::SRC_TRAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00049">KeyFrame.h:49</a></div></div>
<div class="ttc" id="a00238_html_a687938f5c8d31fe2e288154bb5b28d8e"><div class="ttname"><a href="../../da/d2e/a00238.html#a687938f5c8d31fe2e288154bb5b28d8e">MapMaker::mMap</a></div><div class="ttdeci">Map &amp; mMap</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00065">MapMaker.h:65</a></div></div>
<div class="ttc" id="a00238_html_adf4266adb1e18e4e4382060d42c544d9"><div class="ttname"><a href="../../da/d2e/a00238.html#adf4266adb1e18e4e4382060d42c544d9">MapMaker::counterForConvergence</a></div><div class="ttdeci">int counterForConvergence</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00135">MapMaker.h:135</a></div></div>
<div class="ttc" id="a00237_html_a59d9d701fafb7adf3e9754b7b14c8cc0"><div class="ttname"><a href="../../d4/d08/a00237.html#a59d9d701fafb7adf3e9754b7b14c8cc0">Map::Reset</a></div><div class="ttdeci">void Reset()</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d87/a00539_source.html#l00010">Map.cpp:10</a></div></div>
<div class="ttc" id="a00238_html_aee8e87553a9f5093fc3197f08fc7efc5"><div class="ttname"><a href="../../da/d2e/a00238.html#aee8e87553a9f5093fc3197f08fc7efc5">MapMaker::ReFindNewlyMade</a></div><div class="ttdeci">void ReFindNewlyMade()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l01009">MapMaker.cpp:1009</a></div></div>
<div class="ttc" id="a00027_html_ac2d98569d643dc40416fbc5fa1abba19"><div class="ttname"><a href="../../d0/d33/a00027.html#ac2d98569d643dc40416fbc5fa1abba19">ATANCamera::GetProjectionDerivs</a></div><div class="ttdeci">Matrix&lt; 2, 2 &gt; GetProjectionDerivs()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/a00479_source.html#l00172">ATANCamera.cpp:172</a></div></div>
<div class="ttc" id="a00240_html_ae5075b6febd541a4eec4a28653008334"><div class="ttname"><a href="../../d9/d21/a00240.html#ae5075b6febd541a4eec4a28653008334">MapPoint::RefreshPixelVectors</a></div><div class="ttdeci">void RefreshPixelVectors()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d9c/a00543_source.html#l00004">MapPoint.cpp:4</a></div></div>
<div class="ttc" id="a00485_html"><div class="ttname"><a href="../../d6/d1a/a00485.html">Bundle.h</a></div></div>
<div class="ttc" id="a00239_html_abb4c838f83c9a86d5b367193d7beea86"><div class="ttname"><a href="../../d0/d27/a00239.html#abb4c838f83c9a86d5b367193d7beea86">MapMakerData::sNeverRetryKFs</a></div><div class="ttdeci">std::set&lt; KeyFrame * &gt; sNeverRetryKFs</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00033">MapMaker.h:33</a></div></div>
<div class="ttc" id="a00238_html_a8a2a25fb4916fb9537fabe1aa6cb57f1"><div class="ttname"><a href="../../da/d2e/a00238.html#a8a2a25fb4916fb9537fabe1aa6cb57f1">MapMaker::KeyFrameLinearDist</a></div><div class="ttdeci">double KeyFrameLinearDist(KeyFrame &amp;k1, KeyFrame &amp;k2)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00651">MapMaker.cpp:651</a></div></div>
<div class="ttc" id="a00251_html_a35f6df617a54c2b0feaa68df21fa9113ac6ae81d05781e68262cd1b96400f8ae6"><div class="ttname"><a href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113ac6ae81d05781e68262cd1b96400f8ae6">Measurement::SRC_TRACKER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00049">KeyFrame.h:49</a></div></div>
<div class="ttc" id="a00523_html_ae9b2cb48b0a8e681b3dd1ac86f8b9d97"><div class="ttname"><a href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">TooN::Zeros</a></div><div class="ttdeci">static Operator&lt; Internal::Zero &gt; Zeros</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de9/a00552_source.html#l00727">objects.h:727</a></div></div>
<div class="ttc" id="a00238_html_a9010241199b5b242ef3fb56f34c5c6d9"><div class="ttname"><a href="../../da/d2e/a00238.html#a9010241199b5b242ef3fb56f34c5c6d9">MapMaker::mbResetDone</a></div><div class="ttdeci">bool mbResetDone</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00128">MapMaker.h:128</a></div></div>
<div class="ttc" id="a00185_html"><div class="ttname"><a href="../../de/df3/a00185.html">HomographyInit</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db7/a00525_source.html#l00044">HomographyInit.h:44</a></div></div>
<div class="ttc" id="a00523_html_aba317fcd024f7f6e135433caa8d0d6c4"><div class="ttname"><a href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">TooN::project</a></div><div class="ttdeci">Vector&lt;(Size==Dynamic?Dynamic:Size-1), Precision &gt; project(const Vector&lt; Size, Precision, Base &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d14/a00522_source.html#l00157">helpers.h:157</a></div></div>
<div class="ttc" id="a00238_html_a1baa21c897468de2f9ee654a6438e8c9"><div class="ttname"><a href="../../da/d2e/a00238.html#a1baa21c897468de2f9ee654a6438e8c9">MapMaker::Reset</a></div><div class="ttdeci">void Reset()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00038">MapMaker.cpp:38</a></div></div>
<div class="ttc" id="a00238_html_ac002856d5ddb45d7c0b4c5c7881ea5e5"><div class="ttname"><a href="../../da/d2e/a00238.html#ac002856d5ddb45d7c0b4c5c7881ea5e5">MapMaker::BundleAdjust</a></div><div class="ttdeci">void BundleAdjust(std::set&lt; KeyFrame * &gt;, std::set&lt; KeyFrame * &gt;, std::set&lt; MapPoint * &gt;, bool)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d72/a00541_source.html#l00789">MapMaker.cpp:789</a></div></div>
<div class="ttc" id="a00186_html_ac2ba2a37537a9206aae6603d06d0937e"><div class="ttname"><a href="../../d8/d00/a00186.html#ac2ba2a37537a9206aae6603d06d0937e">HomographyMatch::v2CamPlaneSecond</a></div><div class="ttdeci">Vector&lt; 2 &gt; v2CamPlaneSecond</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db7/a00525_source.html#l00027">HomographyInit.h:27</a></div></div>
<div class="ttc" id="a00484_html_a101fd144d7d407e15633eba37102f1ed"><div class="ttname"><a href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a></div><div class="ttdeci">#define cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00016">Bundle.cpp:16</a></div></div>
<div class="ttc" id="a00419_html_a65607c7a8760418de9fbaff0d53e8529"><div class="ttname"><a href="../../d3/d29/a00419.html#a65607c7a8760418de9fbaff0d53e8529">CVD::Thread::join</a></div><div class="ttdeci">void join()</div><div class="ttdoc">This blocks until the thread has actually terminated. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00058">thread.cpp:58</a></div></div>
<div class="ttc" id="a00419_html_a4849f1e10df897f12f9efb89e054f6f2"><div class="ttname"><a href="../../d3/d29/a00419.html#a4849f1e10df897f12f9efb89e054f6f2">CVD::Thread::sleep</a></div><div class="ttdeci">static void sleep(unsigned int milli)</div><div class="ttdoc">Tell the current thread to sleep for milli milliseconds. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00079">thread.cpp:79</a></div></div>
<div class="ttc" id="a00037_html_a6a248428aa892f2f571bd280ff4915ee"><div class="ttname"><a href="../../d1/dc6/a00037.html#a6a248428aa892f2f571bd280ff4915ee">Candidate::irLevelPos</a></div><div class="ttdeci">CVD::ImageRef irLevelPos</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00038">KeyFrame.h:38</a></div></div>
<div class="ttc" id="a00251_html_a35f6df617a54c2b0feaa68df21fa9113a58c1047e24fc271743d242d0dc5cb76b"><div class="ttname"><a href="../../d3/d1a/a00251.html#a35f6df617a54c2b0feaa68df21fa9113a58c1047e24fc271743d242d0dc5cb76b">Measurement::SRC_EPIPOLAR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d41/a00532_source.html#l00049">KeyFrame.h:49</a></div></div>
<div class="ttc" id="a00035_html_a4a797da14a8d29f9bf5f3e39303d3492"><div class="ttname"><a href="../../d4/d8c/a00035.html#a4a797da14a8d29f9bf5f3e39303d3492">Bundle::GetOutlierMeasurements</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int, int &gt; &gt; GetOutlierMeasurements()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00649">Bundle.cpp:649</a></div></div>
<div class="ttc" id="a00238_html_a4c687f57c614a609f7ec434cee0954de"><div class="ttname"><a href="../../da/d2e/a00238.html#a4c687f57c614a609f7ec434cee0954de">MapMaker::mgvdWiggleScale</a></div><div class="ttdeci">double mgvdWiggleScale</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/ddb/a00542_source.html#l00119">MapMaker.h:119</a></div></div>
<div class="ttc" id="a00519_html_a84136448201b0ca697325a75459d7100"><div class="ttname"><a href="../../dd/d4d/a00519.html#a84136448201b0ca697325a75459d7100">MapMakerMaxKFDistWiggleMult</a></div><div class="ttdeci">const double MapMakerMaxKFDistWiggleMult</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00016">globals.h:16</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 25 2015 17:53:29 for SLAMflex SE by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
