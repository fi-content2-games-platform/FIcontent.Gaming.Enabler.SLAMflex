<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SLAMflex SE: libSLAMflex -  android project/jni/Bundle.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../thumbnail.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SLAMflex SE
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">SLAMflex provides detection and tracking of dominant planes for smartphone devices. This plane can then be used to show AR content relative to the plane orientation. The detection of plane is performed in the field of view of the smartphone camera. In subsequent frames it is tracked. The interface returns the plane position and orientation.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_64138f433da6323d37c35d94c20fed44.html">libSLAMflex -  android project</a></li><li class="navelem"><a class="el" href="../../dir_f496a2d090f5040e1d0b8f142d0646a8.html">jni</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Bundle.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d8/d89/a00484.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2008 Isis Innovation Limited</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//#include &lt;BundleHelpers.h&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d1a/a00485.html">Bundle.h</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d8b/a00547.html">MEstimator.h</a>&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d14/a00522.html">helpers.h</a>&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d9c/a00487.html">Cholesky.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d4/d2a/a00632.html">std</a>;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="../../d0/de7/a00523.html#a6630004f166284bce546c4518bea54e9">isnan</a>(<span class="keywordtype">double</span> d) {<span class="keywordflow">return</span> !(d==d);}</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">   16</a></span>&#160;<span class="preprocessor">#define cout if(mgvnBundleCout) cout</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// Some inlines which replace standard matrix multiplications </span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// with LL-triangle-only versions.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="../../d8/d89/a00484.html#a088658376a5aca80742a76db7875bc51">   20</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d89/a00484.html#a088658376a5aca80742a76db7875bc51">BundleTriangle_UpdateM6U_LL</a>(<a class="code" href="../../d6/db6/a00241.html">Matrix&lt;6&gt;</a> &amp;m6U, <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;2,6&gt;</a> &amp;m26A)</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;{</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> r=0; r&lt;6; r++)</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0; c&lt;=r; c++)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;      m6U(r,c)+= m26A.T()(r,0)*m26A(0,c) + m26A.T()(r,1)*m26A(1,c);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;}</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="../../d8/d89/a00484.html#a85fa5b4a1cfa51a1e3906bacb30f450a">   26</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../d8/d89/a00484.html#a85fa5b4a1cfa51a1e3906bacb30f450a">BundleTriangle_UpdateM3V_LL</a>(<a class="code" href="../../d6/db6/a00241.html">Matrix&lt;3&gt;</a> &amp;m3V, <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;2,3&gt;</a> &amp;m23B)</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> r=0; r&lt;3; r++) </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0; c&lt;=r; c++) </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      m3V(r,c)+= m23B.T()(r,0)*m23B(0,c) + m23B.T()(r,1)*m23B(1,c); </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;}</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// Constructor copies MapMaker&#39;s camera parameters</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a37fb3a41680778389df092cdd90e2b15">   34</a></span>&#160;<a class="code" href="../../d4/d8c/a00035.html#a37fb3a41680778389df092cdd90e2b15">Bundle::Bundle</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d33/a00027.html">ATANCamera</a> &amp;TCam)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  : mCamera(TCam)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#af45f2153795ba00d217dcecd3e1494f9">mnCamsToUpdate</a> = 0;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a6e6cf9981efa64e2b2f2594e71be8851">mnStartRow</a> = 0;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a81618fea88a96c2d2325ccb9dba82370">mgvnMaxIterations</a>=<a class="code" href="../../dd/d4d/a00519.html#ad1cb892ae175c8d7f595be47e6e16c4b">BundleMaxIterations</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a22357272762d823c2a891ea85edb09e6">mgvdUpdateConvergenceLimit</a>= <a class="code" href="../../dd/d4d/a00519.html#ac9e27bd27207a6b97da14573eef3d85b">BundleUpdateSquaredConvergenceLimit</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#ae89eaca6fd79e53d22e4556654dee4fe">mgvnBundleCout</a> = <a class="code" href="../../dd/d4d/a00519.html#a7499cd10bd65903cd85f1ed6b4c544a7">BundleCout</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;};</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// Add a camera to the system, return value is the bundle adjuster&#39;s ID for the camera</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#ae70602edb7b657e68e4219d3f66c491b">   45</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/d8c/a00035.html#ae70602edb7b657e68e4219d3f66c491b">Bundle::AddCamera</a>(<a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> se3CamFromWorld, <span class="keywordtype">bool</span> bFixed)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">int</span> n = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="../../de/d8c/a00036.html">Camera</a> c;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  c.<a class="code" href="../../de/d8c/a00036.html#ac4a084203a2f051c9b41ef2f552517d1">bFixed</a> = bFixed;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  c.<a class="code" href="../../de/d8c/a00036.html#a6db112ab3a07d13290bc72654b4a494a">se3CfW</a> = se3CamFromWorld;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">if</span>(!bFixed)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      c.<a class="code" href="../../de/d8c/a00036.html#aa97ebd03827e09ad7ea072eecf80026e">nStartRow</a> = <a class="code" href="../../d4/d8c/a00035.html#a6e6cf9981efa64e2b2f2594e71be8851">mnStartRow</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a6e6cf9981efa64e2b2f2594e71be8851">mnStartRow</a> += 6;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#af45f2153795ba00d217dcecd3e1494f9">mnCamsToUpdate</a>++;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    c.<a class="code" href="../../de/d8c/a00036.html#aa97ebd03827e09ad7ea072eecf80026e">nStartRow</a> = -999999999; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.push_back(c);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// Add a map point to the system, return value is the bundle adjuster&#39;s ID for the point</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#add96334653e0619414c6f695eb876c1e">   65</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/d8c/a00035.html#add96334653e0619414c6f695eb876c1e">Bundle::AddPoint</a>(<a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Pos)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span> n = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="../../db/ddf/a00164.html">ExtendedMapPoint</a> p;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">//  if(isnan(v3Pos * v3Pos))</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//    {</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">//      cerr &lt;&lt; &quot; You sucker, tried to give me a nan &quot; &lt;&lt; v3Pos &lt;&lt; endl;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">//      v3Pos = Zeros;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">//    }</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  p.<a class="code" href="../../db/ddf/a00164.html#acd19d8aaeee9346c22c14075af6a6c9b">v3Pos</a> = v3Pos;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.push_back(p);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">// Add a measurement of one point with one camera</span></div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a671f50417b518e0930bfcc09a1b1b41e">   80</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8c/a00035.html#a671f50417b518e0930bfcc09a1b1b41e">Bundle::AddMeas</a>(<span class="keywordtype">int</span> nCam, <span class="keywordtype">int</span> nPoint, <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2Pos, <span class="keywordtype">double</span> dSigmaSquared)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  assert(nCam &lt; (<span class="keywordtype">int</span>) <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size());</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  assert(nPoint &lt; (<span class="keywordtype">int</span>) <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size());</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[nPoint].nMeasurements++;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[nPoint].sCameras.insert(nCam);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <a class="code" href="../../d0/da7/a00250.html">Meas</a> m;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  m.<a class="code" href="../../d0/da7/a00250.html#ab0e7b8d9424ef99b8203257d7083e83a">p</a> = nPoint;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  m.<a class="code" href="../../d0/da7/a00250.html#abcf5bf4ba83521664da4e2d2187dd85e">c</a> = nCam;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  m.<a class="code" href="../../d0/da7/a00250.html#adad84be45c6ac5f8abe9d003ae5b15b5">v2Found</a> = v2Pos;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  m.<a class="code" href="../../d0/da7/a00250.html#a70eb53731067ad51799651e3b900ca9d">dSqrtInvNoise</a> = sqrt(1.0 / dSigmaSquared);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.push_back(m);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">// Zero temporary quantities stored in cameras and points</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a5de538c7a4aa6eb4915c9c2ec022f706">   95</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8c/a00035.html#a5de538c7a4aa6eb4915c9c2ec022f706">Bundle::ClearAccumulators</a>()</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;{</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); ++i)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].m3V = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].v3EpsilonB = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size(); ++i)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[i].m6U = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[i].v6EpsilonA = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">// Perform bundle adjustment. The parameter points to a signal bool </span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">// which mapmaker will set to high if another keyframe is incoming</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">// and bundle adjustment needs to be aborted.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">// Returns number of accepted iterations if all good, negative </span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">// value for big error.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a5352ae090e38171322b6037776d0ff95">  114</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d4/d8c/a00035.html#a5352ae090e38171322b6037776d0ff95">Bundle::Compute</a>(<span class="keywordtype">bool</span> *pbAbortSignal)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#aed90a60c6f2610155e62432832b1a797">mpbAbortSignal</a> = pbAbortSignal;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="comment">// Some speedup data structures</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a648ab9410d3de60042bc70236232941d">GenerateMeasLUTs</a>();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a30c11c59f067b47ead152fd467e58b0a">GenerateOffDiagScripts</a>();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">// Initially behave like gauss-newton</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">mdLambda</a> = 0.0001;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#ae0021b043e59d902a87a0a5c91f17c2a">mdLambdaFactor</a> = 2.0;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a6da9c6a4ca90ebc748231f990fdc1d24">mbConverged</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a56e6ba045da1462be2b8e2215e6f6727">mbHitMaxIterations</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#ab521e83e08b3906e73b9bb66e208c151">mnCounter</a> = 0;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#ade4e715b810343aac84a4dd4289a5988">mnAccepted</a> = 0;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordtype">double</span> lastMdSigmaSquared = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// What MEstimator are we using today?</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">string</span> gvsMEstimator=<a class="code" href="../../dd/d4d/a00519.html#afa9142e1a9c29c3a1c3d3c753d634237">BundleMEstimator</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="../../d4/d8c/a00035.html#a6da9c6a4ca90ebc748231f990fdc1d24">mbConverged</a>  &amp;&amp; !<a class="code" href="../../d4/d8c/a00035.html#a56e6ba045da1462be2b8e2215e6f6727">mbHitMaxIterations</a> &amp;&amp; !*pbAbortSignal)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keywordtype">bool</span> bNoError;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordflow">if</span>(gvsMEstimator == <span class="stringliteral">&quot;Cauchy&quot;</span>)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    bNoError = Do_LM_Step&lt;Cauchy&gt;(pbAbortSignal, &amp;lastMdSigmaSquared);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(gvsMEstimator == <span class="stringliteral">&quot;Tukey&quot;</span>)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    bNoError = Do_LM_Step&lt;Tukey&gt;(pbAbortSignal, &amp;lastMdSigmaSquared);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(gvsMEstimator == <span class="stringliteral">&quot;Huber&quot;</span>)</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    bNoError = Do_LM_Step&lt;Huber&gt;(pbAbortSignal, &amp;lastMdSigmaSquared);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;Invalid BundleMEstimator selected !! &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;Defaulting to Tukey.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      gvsMEstimator = <span class="stringliteral">&quot;Tukey&quot;</span>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      bNoError = Do_LM_Step&lt;Tukey&gt;(pbAbortSignal,  &amp;lastMdSigmaSquared);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    };</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">if</span>(!bNoError)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d4/d8c/a00035.html#a56e6ba045da1462be2b8e2215e6f6727">mbHitMaxIterations</a>)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;  Hit max iterations.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: %s&quot;</span>, <span class="stringliteral">&quot; Hit max iterations.&quot;</span>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;Final Sigma Squared: &quot;</span> &lt;&lt; <a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a> &lt;&lt; <span class="stringliteral">&quot; (= &quot;</span> &lt;&lt; sqrt(<a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a>) / 4.685 &lt;&lt; <span class="stringliteral">&quot; pixels.)&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d8c/a00035.html#ade4e715b810343aac84a4dd4289a5988">mnAccepted</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;};</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">// Reproject a single measurement, find error</span></div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a150deeb75e0b4a641cabacb906546ecb">  166</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../d4/d8c/a00035.html#a150deeb75e0b4a641cabacb906546ecb">Bundle::ProjectAndFindSquaredError</a>(<a class="code" href="../../d0/da7/a00250.html">Meas</a> &amp;meas)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="../../de/d8c/a00036.html">Camera</a> &amp;cam = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[meas.<a class="code" href="../../d0/da7/a00250.html#abcf5bf4ba83521664da4e2d2187dd85e">c</a>];</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="../../db/ddf/a00164.html">ExtendedMapPoint</a> &amp;point = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[meas.<a class="code" href="../../d0/da7/a00250.html#ab0e7b8d9424ef99b8203257d7083e83a">p</a>];</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">// Project the point.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  meas.<a class="code" href="../../d0/da7/a00250.html#afd36be4f2c034fb894b2b4ceae296fe4">v3Cam</a> = cam.<a class="code" href="../../de/d8c/a00036.html#a6db112ab3a07d13290bc72654b4a494a">se3CfW</a> * point.<a class="code" href="../../db/ddf/a00164.html#acd19d8aaeee9346c22c14075af6a6c9b">v3Pos</a>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">if</span>(meas.<a class="code" href="../../d0/da7/a00250.html#afd36be4f2c034fb894b2b4ceae296fe4">v3Cam</a>[2] &lt;= 0)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      meas.<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  meas.<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2ImPlane = <a class="code" href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">project</a>(meas.<a class="code" href="../../d0/da7/a00250.html#afd36be4f2c034fb894b2b4ceae296fe4">v3Cam</a>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2Image   = <a class="code" href="../../d4/d8c/a00035.html#af18c4caf50d892e95ac4dd28a6af7df3">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a7b8759d7fec56601d10e60ae487b96f7">Project</a>(v2ImPlane);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  meas.<a class="code" href="../../d0/da7/a00250.html#afaa80fd03932c3fa501907a8dff5b7cb">m2CamDerivs</a> = <a class="code" href="../../d4/d8c/a00035.html#af18c4caf50d892e95ac4dd28a6af7df3">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#ac2d98569d643dc40416fbc5fa1abba19">GetProjectionDerivs</a>();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  meas.<a class="code" href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">v2Epsilon</a> = meas.<a class="code" href="../../d0/da7/a00250.html#a70eb53731067ad51799651e3b900ca9d">dSqrtInvNoise</a> * (meas.<a class="code" href="../../d0/da7/a00250.html#adad84be45c6ac5f8abe9d003ae5b15b5">v2Found</a> - v2Image);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  meas.<a class="code" href="../../d0/da7/a00250.html#a709bd4c18cac0ffc5aa44b15629c8783">dErrorSquared</a> = meas.<a class="code" href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">v2Epsilon</a> * meas.<a class="code" href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">v2Epsilon</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> MEstimator&gt;</div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a539da777aa7e730a718bff15db6f817b">  187</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d4/d8c/a00035.html#a539da777aa7e730a718bff15db6f817b">Bundle::Do_LM_Step</a>(<span class="keywordtype">bool</span> *pbAbortSignal, <span class="keywordtype">double</span> *lastMdSigmaSquared)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;{</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// Reset all accumulators to zero</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a5de538c7a4aa6eb4915c9c2ec022f706">ClearAccumulators</a>();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="comment">//  Do a LM step according to Hartley and Zisserman Algo A6.4 in MVG 2nd Edition</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">//  Actual work starts a bit further down - first we have to work out the </span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">//  projections and errors for each point, so we can do tukey reweighting</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  vector&lt;double&gt; vdErrorSquared;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordflow">for</span>(list&lt;Meas&gt;::iterator itr = <a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.begin(); itr!=<a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.end(); itr++)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <a class="code" href="../../d0/da7/a00250.html">Meas</a> &amp;meas = *itr;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a150deeb75e0b4a641cabacb906546ecb">ProjectAndFindSquaredError</a>(meas);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">if</span>(!meas.<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a>)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    vdErrorSquared.push_back(meas.<a class="code" href="../../d0/da7/a00250.html#a709bd4c18cac0ffc5aa44b15629c8783">dErrorSquared</a>);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    };</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// Projected all points and got vector of errors; find the median, </span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">// And work out robust estimate of sigma, then scale this for the tukey</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="comment">// estimator</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a> = MEstimator::FindSigmaSquared(vdErrorSquared);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// Initially the median error might be very small - set a minimum</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">// value so that good measurements don&#39;t get erased!</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> gvdMinSigma=<a class="code" href="../../dd/d4d/a00519.html#abd70d42818792b1e5d83a58fbc72dd18">BundleMinTukeySigma</a>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> dMinSigmaSquared = gvdMinSigma * gvdMinSigma;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a> &lt; dMinSigmaSquared)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a> = dMinSigmaSquared;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">//  OK - good to go! weights can now be calced on second run through the loop.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">//  Back to Hartley and Zisserman....</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">//  `` (i) Compute the derivative matrices Aij = [dxij/daj]</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">//      and Bij = [dxij/dbi] and the error vectors eij&#39;&#39;</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">//  Here we do this by looping over all measurements</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">// </span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">//  While we&#39;re here, might as well update the accumulators U, ea, B, eb</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">//  from part (ii) as well, and let&#39;s calculate Wij while we&#39;re here as well.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordtype">double</span> dCurrentError = 0.0;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">for</span>(list&lt;Meas&gt;::iterator itr = <a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.begin(); itr!=<a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.end(); itr++)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <a class="code" href="../../d0/da7/a00250.html">Meas</a> &amp;meas = *itr;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <a class="code" href="../../de/d8c/a00036.html">Camera</a> &amp;cam = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[meas.<a class="code" href="../../d0/da7/a00250.html#abcf5bf4ba83521664da4e2d2187dd85e">c</a>];</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <a class="code" href="../../db/ddf/a00164.html">ExtendedMapPoint</a> &amp;point = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[meas.<a class="code" href="../../d0/da7/a00250.html#ab0e7b8d9424ef99b8203257d7083e83a">p</a>];</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">// Project the point.</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="comment">// We&#39;ve done this before - results are still cached in meas.</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordflow">if</span>(meas.<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a>)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      dCurrentError += 1.0;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    };</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="comment">// What to do with the weights? The easiest option is to independently weight</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="comment">// The two jacobians, A and B, with sqrt of the tukey weight w;</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="comment">// And also weight the error vector v2Epsilon.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="comment">// That makes everything else automatic.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="comment">// Calc the square root of the tukey weight:</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordtype">double</span> dWeight= MEstimator::SquareRootWeight(meas.<a class="code" href="../../d0/da7/a00250.html#a709bd4c18cac0ffc5aa44b15629c8783">dErrorSquared</a>, <a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="comment">// Re-weight error:</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      meas.<a class="code" href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">v2Epsilon</a> = dWeight * meas.<a class="code" href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">v2Epsilon</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span>(dWeight == 0)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      meas.<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a> = <span class="keyword">true</span>;  </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      dCurrentError += 1.0;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      dCurrentError += MEstimator::ObjectiveScore(meas.<a class="code" href="../../d0/da7/a00250.html#a709bd4c18cac0ffc5aa44b15629c8783">dErrorSquared</a>, <a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">// To re-weight the jacobians, I&#39;ll just re-weight the camera param matrix</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">// This is only used for the jacs and will save a few fmuls</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;2&gt;</a> m2CamDerivs = dWeight * meas.<a class="code" href="../../d0/da7/a00250.html#afaa80fd03932c3fa501907a8dff5b7cb">m2CamDerivs</a>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">double</span> dOneOverCameraZ = 1.0 / meas.<a class="code" href="../../d0/da7/a00250.html#afd36be4f2c034fb894b2b4ceae296fe4">v3Cam</a>[2];</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d9/d69/a00451.html">Vector&lt;4&gt;</a> v4Cam = <a class="code" href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">unproject</a>(meas.<a class="code" href="../../d0/da7/a00250.html#afd36be4f2c034fb894b2b4ceae296fe4">v3Cam</a>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="comment">// Calculate A: (the proj derivs WRT the camera)</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">if</span>(cam.<a class="code" href="../../de/d8c/a00036.html#ac4a084203a2f051c9b41ef2f552517d1">bFixed</a>)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    meas.<a class="code" href="../../d0/da7/a00250.html#a74feb9f272e220fa975e10bf30efe7ba">m26A</a> = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordflow">else</span> </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m=0;m&lt;6;m++)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          <span class="keyword">const</span> <a class="code" href="../../d9/d69/a00451.html">Vector&lt;4&gt;</a> v4Motion = <a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;::generator_field</a>(m, v4Cam);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2CamFrameMotion;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          v2CamFrameMotion[0] = (v4Motion[0] - v4Cam[0] * v4Motion[2] * dOneOverCameraZ) * dOneOverCameraZ;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          v2CamFrameMotion[1] = (v4Motion[1] - v4Cam[1] * v4Motion[2] * dOneOverCameraZ) * dOneOverCameraZ;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          meas.<a class="code" href="../../d0/da7/a00250.html#a74feb9f272e220fa975e10bf30efe7ba">m26A</a>.T()[m] = meas.<a class="code" href="../../d0/da7/a00250.html#a70eb53731067ad51799651e3b900ca9d">dSqrtInvNoise</a> * m2CamDerivs * v2CamFrameMotion;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        };</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="comment">// Calculate B: (the proj derivs WRT the point)</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m=0;m&lt;3;m++)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keyword">const</span> <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Motion = cam.<a class="code" href="../../de/d8c/a00036.html#a6db112ab3a07d13290bc72654b4a494a">se3CfW</a>.<a class="code" href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">get_rotation</a>().get_matrix().T()[m];</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2CamFrameMotion;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      v2CamFrameMotion[0] = (v3Motion[0] - v4Cam[0] * v3Motion[2] * dOneOverCameraZ) * dOneOverCameraZ;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      v2CamFrameMotion[1] = (v3Motion[1] - v4Cam[1] * v3Motion[2] * dOneOverCameraZ) * dOneOverCameraZ;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      meas.<a class="code" href="../../d0/da7/a00250.html#aa8501ded46e3bd6c35c3b11bb9cac8c9">m23B</a>.T()[m] = meas.<a class="code" href="../../d0/da7/a00250.html#a70eb53731067ad51799651e3b900ca9d">dSqrtInvNoise</a> * m2CamDerivs * v2CamFrameMotion;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    };</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="comment">// Update the accumulators</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordflow">if</span>(!cam.<a class="code" href="../../de/d8c/a00036.html#ac4a084203a2f051c9b41ef2f552517d1">bFixed</a>)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="comment">//      cam.m6U += meas.m26A.T() * meas.m26A;       // SLOW SLOW this matrix is symmetric</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a088658376a5aca80742a76db7875bc51">BundleTriangle_UpdateM6U_LL</a>(cam.<a class="code" href="../../de/d8c/a00036.html#a0ab90dd2552d9f611dc17076212d8c42">m6U</a>, meas.<a class="code" href="../../d0/da7/a00250.html#a74feb9f272e220fa975e10bf30efe7ba">m26A</a>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      cam.<a class="code" href="../../de/d8c/a00036.html#a525ab230a879409ada62de33e348aa73">v6EpsilonA</a> += meas.<a class="code" href="../../d0/da7/a00250.html#a74feb9f272e220fa975e10bf30efe7ba">m26A</a>.T() * meas.<a class="code" href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">v2Epsilon</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="comment">// NOISE COVAR OMITTED because it&#39;s the 2-Identity</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="comment">//            point.m3V += meas.m23B.T() * meas.m23B;             // SLOW-ish this is symmetric too</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a85fa5b4a1cfa51a1e3906bacb30f450a">BundleTriangle_UpdateM3V_LL</a>(point.<a class="code" href="../../db/ddf/a00164.html#a37d016543bd5a32e324eae787afb4298">m3V</a>, meas.<a class="code" href="../../d0/da7/a00250.html#aa8501ded46e3bd6c35c3b11bb9cac8c9">m23B</a>);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      point.<a class="code" href="../../db/ddf/a00164.html#a4865341c971f8cab239995a469363926">v3EpsilonB</a> += meas.<a class="code" href="../../d0/da7/a00250.html#aa8501ded46e3bd6c35c3b11bb9cac8c9">m23B</a>.T() * meas.<a class="code" href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">v2Epsilon</a>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">if</span>(cam.<a class="code" href="../../de/d8c/a00036.html#ac4a084203a2f051c9b41ef2f552517d1">bFixed</a>)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    meas.<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a> = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    meas.<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a> = meas.<a class="code" href="../../d0/da7/a00250.html#a74feb9f272e220fa975e10bf30efe7ba">m26A</a>.T() * meas.<a class="code" href="../../d0/da7/a00250.html#aa8501ded46e3bd6c35c3b11bb9cac8c9">m23B</a>;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">// OK, done (i) and most of (ii) except calcing Yij; this depends on Vi, which should </span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// be finished now. So we can find V*i (by adding lambda) and then invert.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">// The next bits depend on mdLambda! So loop this next bit until error goes down.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">double</span> dNewError = dCurrentError + 9999;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">while</span>(dNewError &gt; dCurrentError &amp;&amp; !<a class="code" href="../../d4/d8c/a00035.html#a6da9c6a4ca90ebc748231f990fdc1d24">mbConverged</a> &amp;&amp; !<a class="code" href="../../d4/d8c/a00035.html#a56e6ba045da1462be2b8e2215e6f6727">mbHitMaxIterations</a> &amp;&amp; !*pbAbortSignal)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">// Rest of part (ii) : find V*i inverse</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">for</span>(vector&lt;ExtendedMapPoint&gt;::iterator itr = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.begin(); itr!=<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.end(); itr++)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <a class="code" href="../../db/ddf/a00164.html">ExtendedMapPoint</a> &amp;point = *itr;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;3&gt;</a> m3VStar = point.<a class="code" href="../../db/ddf/a00164.html#a37d016543bd5a32e324eae787afb4298">m3V</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">if</span>(m3VStar[0][0] * m3VStar[1][1] * m3VStar[2][2] == 0)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        point.<a class="code" href="../../db/ddf/a00164.html#ad1292ecc4603bd068dfb76d26f1d8c2e">m3VStarInv</a> = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;          <span class="comment">// Fill in the upper-r triangle from the LL;</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;          m3VStar[0][1] = m3VStar[1][0];</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;          m3VStar[0][2] = m3VStar[2][0];</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;          m3VStar[1][2] = m3VStar[2][1];</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;           </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;3; i++)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        m3VStar[i][i] *= (1.0 + <a class="code" href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">mdLambda</a>);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          <a class="code" href="../../d2/dee/a00049.html">Cholesky&lt;3&gt;</a> chol(m3VStar);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          point.<a class="code" href="../../db/ddf/a00164.html#ad1292ecc4603bd068dfb76d26f1d8c2e">m3VStarInv</a> = chol.<a class="code" href="../../d2/dee/a00049.html#adf85bb1a4d9d63e39c0a5b82f9f46ac5">get_inverse</a>();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        };</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="comment">// Done part (ii), except calculating Yij;</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="comment">// But we can do this inline when we calculate S in part (iii).</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="comment">// Part (iii): Construct the the big block-matrix S which will be inverted.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;&gt;</a> mS(<a class="code" href="../../d4/d8c/a00035.html#af45f2153795ba00d217dcecd3e1494f9">mnCamsToUpdate</a> * 6, <a class="code" href="../../d4/d8c/a00035.html#af45f2153795ba00d217dcecd3e1494f9">mnCamsToUpdate</a> * 6);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      mS = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;&gt;</a> vE(<a class="code" href="../../d4/d8c/a00035.html#af45f2153795ba00d217dcecd3e1494f9">mnCamsToUpdate</a> * 6);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      vE = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;6&gt;</a> m6; <span class="comment">// Temp working space</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;6&gt;</a> v6; <span class="comment">// Temp working space</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="comment">// Calculate on-diagonal blocks of S (i.e. only one camera at a time:)</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size(); j++)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <a class="code" href="../../de/d8c/a00036.html">Camera</a> &amp;cam_j = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j];</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">if</span>(cam_j.<a class="code" href="../../de/d8c/a00036.html#ac4a084203a2f051c9b41ef2f552517d1">bFixed</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordtype">int</span> nCamJStartRow = cam_j.<a class="code" href="../../de/d8c/a00036.html#aa97ebd03827e09ad7ea072eecf80026e">nStartRow</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="comment">// First, do the diagonal elements.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="comment">//m6= cam_j.m6U;     // can&#39;t do this anymore because cam_j.m6U is LL!!</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> r=0; r&lt;6; r++)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=0; c&lt;r; c++)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        m6[r][c] = m6[c][r] = cam_j.<a class="code" href="../../de/d8c/a00036.html#a0ab90dd2552d9f611dc17076212d8c42">m6U</a>[r][c];</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;          m6[r][r] = cam_j.<a class="code" href="../../de/d8c/a00036.html#a0ab90dd2552d9f611dc17076212d8c42">m6U</a>[r][r];</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        };</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> nn = 0; nn&lt; 6; nn++)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        m6[nn][nn] *= (1.0 + <a class="code" href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">mdLambda</a>);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      v6 = cam_j.<a class="code" href="../../de/d8c/a00036.html#a525ab230a879409ada62de33e348aa73">v6EpsilonA</a>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      vector&lt;Meas*&gt; &amp;vMeasLUTj = <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[j];</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="comment">// Sum over measurements (points):</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); i++)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          <a class="code" href="../../d0/da7/a00250.html">Meas</a>* pMeas = vMeasLUTj[i];</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          <span class="keywordflow">if</span>(pMeas == NULL || pMeas-&gt;<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a>)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          m6 -= pMeas-&gt;<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a> * <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].m3VStarInv * pMeas-&gt;<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a>.T();  <span class="comment">// SLOW SLOW should by 6x6sy</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          v6 -= pMeas-&gt;<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a> * (<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].m3VStarInv * <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].v3EpsilonB);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      mS.slice(nCamJStartRow, nCamJStartRow, 6, 6) = m6;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      vE.slice(nCamJStartRow,6) = v6;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="comment">// Now find off-diag elements of S. These are camera-point-camera combinations, of which there are lots.</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="comment">// New code which doesn&#39;t waste as much time finding i-jk pairs; these are pre-stored in a per-i list.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); i++)</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <a class="code" href="../../db/ddf/a00164.html">ExtendedMapPoint</a> &amp;p = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i];</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordtype">int</span> nCurrentJ = -1;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordtype">int</span> nJRow = -1;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <a class="code" href="../../d0/da7/a00250.html">Meas</a>* pMeas_ij;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <a class="code" href="../../d0/da7/a00250.html">Meas</a>* pMeas_ik;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;6,3&gt;</a> m63_MIJW_times_m3VStarInv;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordflow">for</span>(vector&lt;OffDiagScriptEntry&gt;::iterator it=p.<a class="code" href="../../db/ddf/a00164.html#aa39606136143ab8c89f7f9d3f080482b">vOffDiagonalScript</a>.begin();</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          it!=p.<a class="code" href="../../db/ddf/a00164.html#aa39606136143ab8c89f7f9d3f080482b">vOffDiagonalScript</a>.end();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          it++)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;          <a class="code" href="../../dd/d86/a00271.html">OffDiagScriptEntry</a> &amp;e = *it;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          pMeas_ik = <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[e.<a class="code" href="../../dd/d86/a00271.html#a3612a5381e369b88d44c68b3ee18ba0d">k</a>][i];</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          <span class="keywordflow">if</span>(pMeas_ik == NULL || pMeas_ik-&gt;<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a>)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          <span class="keywordflow">if</span>(e.<a class="code" href="../../dd/d86/a00271.html#a8c2d25fd8c758dfd1bc154993265a63b">j</a> != nCurrentJ)</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          pMeas_ij = <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[e.<a class="code" href="../../dd/d86/a00271.html#a8c2d25fd8c758dfd1bc154993265a63b">j</a>][i];</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="keywordflow">if</span>(pMeas_ij == NULL || pMeas_ij-&gt;<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a>)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          nCurrentJ = e.<a class="code" href="../../dd/d86/a00271.html#a8c2d25fd8c758dfd1bc154993265a63b">j</a>;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          nJRow = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[e.<a class="code" href="../../dd/d86/a00271.html#a8c2d25fd8c758dfd1bc154993265a63b">j</a>].nStartRow;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          m63_MIJW_times_m3VStarInv = pMeas_ij-&gt;<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a> * p.<a class="code" href="../../db/ddf/a00164.html#ad1292ecc4603bd068dfb76d26f1d8c2e">m3VStarInv</a>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          <span class="keywordtype">int</span> nKRow = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[pMeas_ik-&gt;<a class="code" href="../../d0/da7/a00250.html#abcf5bf4ba83521664da4e2d2187dd85e">c</a>].nStartRow;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="preprocessor">#ifndef WIN32</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          mS.slice(nJRow, nKRow, 6, 6) -= m63_MIJW_times_m3VStarInv * pMeas_ik-&gt;<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a>.T();</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;          <a class="code" href="../../d6/db6/a00241.html">Matrix&lt;6&gt;</a> m = mS.slice(nJRow, nKRow, 6, 6);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;          m -= m63_MIJW_times_m3VStarInv * pMeas_ik-&gt;<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a>.T();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          mS.slice(nJRow, nKRow, 6, 6) = m;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          assert(nKRow &lt; nJRow);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="comment">// Did this purely LL triangle - now update the TR bit as well!</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="comment">// (This is actually unneccessary since the lapack cholesky solver</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="comment">// uses only one triangle, but I&#39;m leaving it in here anyway.)</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;mS.num_rows(); i++)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;i; j++)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      mS[j][i] = mS[i][j];</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="comment">// Got fat matrix S and vector E from part(iii). Now Cholesky-decompose</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="comment">// the matrix, and find the camera update vector.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;&gt;</a> vCamerasUpdate(mS.num_rows());</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      vCamerasUpdate = <a class="code" href="../../d2/dee/a00049.html">Cholesky&lt;&gt;</a>(mS).backsub(vE);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">// Part (iv): Compute the map updates</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;&gt;</a> vMapUpdates(<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size() * 3);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); i++)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Sum;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      v3Sum = <a class="code" href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">Zeros</a>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size(); j++)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;          <a class="code" href="../../de/d8c/a00036.html">Camera</a> &amp;cam = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j];</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          <span class="keywordflow">if</span>(cam.<a class="code" href="../../de/d8c/a00036.html#ac4a084203a2f051c9b41ef2f552517d1">bFixed</a>)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          <a class="code" href="../../d0/da7/a00250.html">Meas</a> *pMeas = <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[j][i];</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          <span class="keywordflow">if</span>(pMeas == NULL || pMeas-&gt;<a class="code" href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">bBad</a>)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          v3Sum+=pMeas-&gt;<a class="code" href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">m63W</a>.T() * vCamerasUpdate.slice(cam.<a class="code" href="../../de/d8c/a00036.html#aa97ebd03827e09ad7ea072eecf80026e">nStartRow</a>,6);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3 = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].v3EpsilonB - v3Sum;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      vMapUpdates.slice(i * 3, 3) = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].m3VStarInv * v3;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">//    if(isnan(vMapUpdates.slice(i * 3, 3) * vMapUpdates.slice(i * 3, 3)))</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">//      {</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">//        cerr &lt;&lt; &quot;NANNERY! &quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">//        cerr &lt;&lt; mvPoints[i].m3VStarInv &lt;&lt; endl;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">//      };</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="comment">// OK, got the two update vectors.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="comment">// First check for convergence..</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="comment">// (this is a very poor convergence test)</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordtype">double</span> dSumSquaredUpdate = vCamerasUpdate * vCamerasUpdate + vMapUpdates * vMapUpdates;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: dSumSquaredUpdate: %g lastMdSigmaSquared: %g, difference: %g&quot;</span>,  dSumSquaredUpdate, *lastMdSigmaSquared, dSumSquaredUpdate - (*lastMdSigmaSquared));</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      *lastMdSigmaSquared = dSumSquaredUpdate;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keywordflow">if</span>(dSumSquaredUpdate &lt; <a class="code" href="../../d4/d8c/a00035.html#a22357272762d823c2a891ea85edb09e6">mgvdUpdateConvergenceLimit</a>)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          <a class="code" href="../../d4/d8c/a00035.html#a6da9c6a4ca90ebc748231f990fdc1d24">mbConverged</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="comment">// Now re-project everything and measure the error;</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="comment">// NB we don&#39;t keep these projections, SLOW, bit of a waste.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="comment">// Temp versions of updated pose and pos:</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size(); j++)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].bFixed)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].se3CfWNew = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].se3CfW;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].se3CfWNew = <a class="code" href="../../d0/de7/a00523.html#a031ca1778b1ff08a51f74daa820bb5d7">SE3&lt;&gt;::exp</a>(vCamerasUpdate.slice(<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].nStartRow, 6)) * <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].se3CfW;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); i++)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].v3PosNew = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].v3Pos + vMapUpdates.slice(i*3, 3);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">// Calculate new error by re-projecting, doing tukey, etc etc:</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      dNewError = FindNewError&lt;MEstimator&gt;();</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt;setprecision(1) &lt;&lt; <span class="stringliteral">&quot;L&quot;</span> &lt;&lt; <a class="code" href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">mdLambda</a> &lt;&lt; setprecision(3) &lt;&lt;  <span class="stringliteral">&quot;\tOld &quot;</span> &lt;&lt; dCurrentError &lt;&lt; <span class="stringliteral">&quot;  New &quot;</span> &lt;&lt; dNewError &lt;&lt; <span class="stringliteral">&quot;  Diff &quot;</span> &lt;&lt; dCurrentError - dNewError &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="comment">// Was the step good? If not, modify lambda and try again!!</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="comment">// (if it was good, will break from this loop.)</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">if</span>(dNewError &gt; dCurrentError)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot; TRY AGAIN &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <a class="code" href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a>(<a class="code" href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a>, <span class="stringliteral">&quot;Info: Try Again&quot;</span>);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a82e68ed2de942674776c4a5c9b0c93c8">ModifyLambda_BadStep</a>();</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    };</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#ab521e83e08b3906e73b9bb66e208c151">mnCounter</a>++;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d4/d8c/a00035.html#ab521e83e08b3906e73b9bb66e208c151">mnCounter</a> &gt;= <a class="code" href="../../d4/d8c/a00035.html#a81618fea88a96c2d2325ccb9dba82370">mgvnMaxIterations</a>)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a56e6ba045da1462be2b8e2215e6f6727">mbHitMaxIterations</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }   <span class="comment">// End of while error too big loop</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">if</span>(dNewError &lt; dCurrentError) <span class="comment">// Was the last step a good one?</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot; WINNER            ------------ &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="comment">// Woo! got somewhere. Update lambda and make changes permanent.</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#a8c8a36acc35ebc91269a98ad8afcadd5">ModifyLambda_GoodStep</a>();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size(); j++)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].se3CfW = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].se3CfWNew;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); i++)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].v3Pos = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i].v3PosNew; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#ade4e715b810343aac84a4dd4289a5988">mnAccepted</a>++;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">// Finally, ditch all the outliers.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  vector&lt;list&lt;Meas&gt;::iterator&gt; vit;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordflow">for</span>(list&lt;Meas&gt;::iterator itr = <a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.begin(); itr!=<a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.end(); itr++)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">if</span>(itr-&gt;bBad)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    vit.push_back(itr);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a69935075648a203647d2460b18aa300d">mvOutlierMeasurementIdx</a>.push_back(make_pair(itr-&gt;p, itr-&gt;c));</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[itr-&gt;p].nOutliers++;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[itr-&gt;c][itr-&gt;p] = NULL;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      };</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;vit.size(); i++)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.erase(vit[i]);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;Nuked &quot;</span> &lt;&lt; vit.size() &lt;&lt; <span class="stringliteral">&quot; measurements.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;}</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">// Find the new total error if cameras and points used their </span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">// new coordinates</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> MEstimator&gt;</div>
<div class="line"><a name="l00537"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a48c9f7eebdfc5f79e9e43e3665725975">  537</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d4/d8c/a00035.html#a48c9f7eebdfc5f79e9e43e3665725975">Bundle::FindNewError</a>()</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;{</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  ofstream ofs;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordtype">double</span> dNewError = 0;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  vector&lt;double&gt; vdErrorSquared;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">for</span>(list&lt;Meas&gt;::iterator itr = <a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.begin(); itr!=<a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.end(); itr++)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="../../d0/da7/a00250.html">Meas</a> &amp;meas = *itr;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="comment">// Project the point.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> v3Cam = <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[meas.<a class="code" href="../../d0/da7/a00250.html#abcf5bf4ba83521664da4e2d2187dd85e">c</a>].se3CfWNew * <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[meas.<a class="code" href="../../d0/da7/a00250.html#ab0e7b8d9424ef99b8203257d7083e83a">p</a>].v3PosNew;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">if</span>(v3Cam[2] &lt;= 0)</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      dNewError += 1.0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <a class="code" href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a> &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    };</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2ImPlane = <a class="code" href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">project</a>(v3Cam);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2Image   = <a class="code" href="../../d4/d8c/a00035.html#af18c4caf50d892e95ac4dd28a6af7df3">mCamera</a>.<a class="code" href="../../d0/d33/a00027.html#a7b8759d7fec56601d10e60ae487b96f7">Project</a>(v2ImPlane);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <a class="code" href="../../d9/d69/a00451.html">Vector&lt;2&gt;</a> v2Error =   meas.<a class="code" href="../../d0/da7/a00250.html#a70eb53731067ad51799651e3b900ca9d">dSqrtInvNoise</a> * (meas.<a class="code" href="../../d0/da7/a00250.html#adad84be45c6ac5f8abe9d003ae5b15b5">v2Found</a> - v2Image);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordtype">double</span> dErrorSquared = v2Error * v2Error;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      dNewError += MEstimator::ObjectiveScore(dErrorSquared, <a class="code" href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">mdSigmaSquared</a>);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordflow">return</span> dNewError;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;}</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">// Optimisation: make a bunch of tables, one per camera</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">// which point to measurements (if any) for each point</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">// This is faster than a std::map lookup.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a648ab9410d3de60042bc70236232941d">  565</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8c/a00035.html#a648ab9410d3de60042bc70236232941d">Bundle::GenerateMeasLUTs</a>()</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;{</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>.clear();</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nCam = 0; nCam &lt; <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.size(); nCam++)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>.push_back(vector&lt;Meas*&gt;());</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>.back().resize(<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(), NULL);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    };</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordflow">for</span>(list&lt;Meas&gt;::iterator it = <a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.begin(); it!=<a class="code" href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">mMeasList</a>.end(); it++)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[it-&gt;c][it-&gt;p] =  &amp;(*it);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">// Optimisation: make a per-point list of all</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">// observation camera-camera pairs; this is then</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">// scanned to make the off-diagonal elements of matrix S</span></div>
<div class="line"><a name="l00580"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a30c11c59f067b47ead152fd467e58b0a">  580</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8c/a00035.html#a30c11c59f067b47ead152fd467e58b0a">Bundle::GenerateOffDiagScripts</a>()</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;{</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); i++)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <a class="code" href="../../db/ddf/a00164.html">ExtendedMapPoint</a> &amp;p = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i];</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      p.<a class="code" href="../../db/ddf/a00164.html#aa39606136143ab8c89f7f9d3f080482b">vOffDiagonalScript</a>.clear();</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordflow">for</span>(set&lt;int&gt;::iterator it_j = p.<a class="code" href="../../db/ddf/a00164.html#ab8a0abbff29712ce64e95661c2be6b6e">sCameras</a>.begin(); it_j!=p.<a class="code" href="../../db/ddf/a00164.html#ab8a0abbff29712ce64e95661c2be6b6e">sCameras</a>.end(); it_j++)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordtype">int</span> j = *it_j;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[j].bFixed)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <a class="code" href="../../d0/da7/a00250.html">Meas</a> *pMeas_j = <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[j][i];</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      assert(pMeas_j != NULL);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">for</span>(set&lt;int&gt;::iterator it_k = p.<a class="code" href="../../db/ddf/a00164.html#ab8a0abbff29712ce64e95661c2be6b6e">sCameras</a>.begin(); it_k!=it_j; it_k++)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          <span class="keywordtype">int</span> k = *it_k;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>[k].bFixed)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;          </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;          <a class="code" href="../../d0/da7/a00250.html">Meas</a> *pMeas_k = <a class="code" href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">mvMeasLUTs</a>[k][i];</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          assert(pMeas_k != NULL);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          <a class="code" href="../../dd/d86/a00271.html">OffDiagScriptEntry</a> e;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          e.<a class="code" href="../../dd/d86/a00271.html#a8c2d25fd8c758dfd1bc154993265a63b">j</a> = j;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          e.<a class="code" href="../../dd/d86/a00271.html#a3612a5381e369b88d44c68b3ee18ba0d">k</a> = k;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          p.<a class="code" href="../../db/ddf/a00164.html#aa39606136143ab8c89f7f9d3f080482b">vOffDiagonalScript</a>.push_back(e);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;}</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a8c8a36acc35ebc91269a98ad8afcadd5">  612</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8c/a00035.html#a8c8a36acc35ebc91269a98ad8afcadd5">Bundle::ModifyLambda_GoodStep</a>()</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;{</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#ae0021b043e59d902a87a0a5c91f17c2a">mdLambdaFactor</a> = 2.0;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">mdLambda</a> *= 0.3;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;};</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div>
<div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a82e68ed2de942674776c4a5c9b0c93c8">  618</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d4/d8c/a00035.html#a82e68ed2de942674776c4a5c9b0c93c8">Bundle::ModifyLambda_BadStep</a>()</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;{</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <a class="code" href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">mdLambda</a> = <a class="code" href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">mdLambda</a> * <a class="code" href="../../d4/d8c/a00035.html#ae0021b043e59d902a87a0a5c91f17c2a">mdLambdaFactor</a>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  mdLambdaFactor = mdLambdaFactor * 2;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;};</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a6e02e2734d763c902a457c2ca6496b3a">  625</a></span>&#160;<a class="code" href="../../d9/d69/a00451.html">Vector&lt;3&gt;</a> <a class="code" href="../../d4/d8c/a00035.html#a6e02e2734d763c902a457c2ca6496b3a">Bundle::GetPoint</a>(<span class="keywordtype">int</span> n)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;{</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.at(n).v3Pos;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;}</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a8ecc89fd42395a78fc286b237f7f4007">  630</a></span>&#160;<a class="code" href="../../df/d73/a00358.html">SE3&lt;&gt;</a> <a class="code" href="../../d4/d8c/a00035.html#a8ecc89fd42395a78fc286b237f7f4007">Bundle::GetCamera</a>(<span class="keywordtype">int</span> n)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;{</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">mvCameras</a>.at(n).se3CfW;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a17ff2ab36bede8715c136030f5d66bac">  635</a></span>&#160;set&lt;int&gt; <a class="code" href="../../d4/d8c/a00035.html#a17ff2ab36bede8715c136030f5d66bac">Bundle::GetOutliers</a>()</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;{</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  set&lt;int&gt; sOutliers;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  set&lt;int&gt;::iterator hint = sOutliers.begin();</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>.size(); i++)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <a class="code" href="../../db/ddf/a00164.html">ExtendedMapPoint</a> &amp;p = <a class="code" href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">mvPoints</a>[i];</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">if</span>(p.<a class="code" href="../../db/ddf/a00164.html#ada0f036beb33aee0af5425e66dcb4c01">nMeasurements</a> &gt; 0 &amp;&amp; p.<a class="code" href="../../db/ddf/a00164.html#ada0f036beb33aee0af5425e66dcb4c01">nMeasurements</a> == p.<a class="code" href="../../db/ddf/a00164.html#a197531e9cd7b27dbc909dde2de38d95a">nOutliers</a>)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    hint = sOutliers.insert(hint, i);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordflow">return</span> sOutliers;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;};</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno"><a class="line" href="../../d4/d8c/a00035.html#a4a797da14a8d29f9bf5f3e39303d3492">  649</a></span>&#160;vector&lt;pair&lt;int, int&gt; &gt; <a class="code" href="../../d4/d8c/a00035.html#a4a797da14a8d29f9bf5f3e39303d3492">Bundle::GetOutlierMeasurements</a>()</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;{</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d4/d8c/a00035.html#a69935075648a203647d2460b18aa300d">mvOutlierMeasurementIdx</a>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;}</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="ttc" id="a00035_html_a531fe606b3a7030d7220e9301264264d"><div class="ttname"><a href="../../d4/d8c/a00035.html#a531fe606b3a7030d7220e9301264264d">Bundle::mdLambda</a></div><div class="ttdeci">double mdLambda</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00141">Bundle.h:141</a></div></div>
<div class="ttc" id="a00035_html_ab521e83e08b3906e73b9bb66e208c151"><div class="ttname"><a href="../../d4/d8c/a00035.html#ab521e83e08b3906e73b9bb66e208c151">Bundle::mnCounter</a></div><div class="ttdeci">int mnCounter</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00145">Bundle.h:145</a></div></div>
<div class="ttc" id="a00250_html_aa8501ded46e3bd6c35c3b11bb9cac8c9"><div class="ttname"><a href="../../d0/da7/a00250.html#aa8501ded46e3bd6c35c3b11bb9cac8c9">Meas::m23B</a></div><div class="ttdeci">Matrix&lt; 2, 3 &gt; m23B</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00093">Bundle.h:93</a></div></div>
<div class="ttc" id="a00035_html_a8c8a36acc35ebc91269a98ad8afcadd5"><div class="ttname"><a href="../../d4/d8c/a00035.html#a8c8a36acc35ebc91269a98ad8afcadd5">Bundle::ModifyLambda_GoodStep</a></div><div class="ttdeci">void ModifyLambda_GoodStep()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00612">Bundle.cpp:612</a></div></div>
<div class="ttc" id="a00164_html_ab8a0abbff29712ce64e95661c2be6b6e"><div class="ttname"><a href="../../db/ddf/a00164.html#ab8a0abbff29712ce64e95661c2be6b6e">ExtendedMapPoint::sCameras</a></div><div class="ttdeci">std::set&lt; int &gt; sCameras</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00070">Bundle.h:70</a></div></div>
<div class="ttc" id="a00522_html"><div class="ttname"><a href="../../d8/d14/a00522.html">helpers.h</a></div></div>
<div class="ttc" id="a00250_html_abcf5bf4ba83521664da4e2d2187dd85e"><div class="ttname"><a href="../../d0/da7/a00250.html#abcf5bf4ba83521664da4e2d2187dd85e">Meas::c</a></div><div class="ttdeci">int c</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00083">Bundle.h:83</a></div></div>
<div class="ttc" id="a00035_html_add96334653e0619414c6f695eb876c1e"><div class="ttname"><a href="../../d4/d8c/a00035.html#add96334653e0619414c6f695eb876c1e">Bundle::AddPoint</a></div><div class="ttdeci">int AddPoint(Vector&lt; 3 &gt; v3Pos)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00065">Bundle.cpp:65</a></div></div>
<div class="ttc" id="a00519_html_a72e78bd45df360f888f03e1280e7c09c"><div class="ttname"><a href="../../dd/d4d/a00519.html#a72e78bd45df360f888f03e1280e7c09c">LOGV</a></div><div class="ttdeci">#define LOGV(LOG_TAG,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00010">globals.h:10</a></div></div>
<div class="ttc" id="a00519_html_a7ce0df38eb467e59f209470c8f5ac4e6"><div class="ttname"><a href="../../dd/d4d/a00519.html#a7ce0df38eb467e59f209470c8f5ac4e6">LOG_TAG</a></div><div class="ttdeci">#define LOG_TAG</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00009">globals.h:9</a></div></div>
<div class="ttc" id="a00027_html"><div class="ttname"><a href="../../d0/d33/a00027.html">ATANCamera</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/a00480_source.html#l00066">ATANCamera.h:66</a></div></div>
<div class="ttc" id="a00035_html_a5352ae090e38171322b6037776d0ff95"><div class="ttname"><a href="../../d4/d8c/a00035.html#a5352ae090e38171322b6037776d0ff95">Bundle::Compute</a></div><div class="ttdeci">int Compute(bool *pbAbortSignal)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00114">Bundle.cpp:114</a></div></div>
<div class="ttc" id="a00036_html_a6db112ab3a07d13290bc72654b4a494a"><div class="ttname"><a href="../../de/d8c/a00036.html#a6db112ab3a07d13290bc72654b4a494a">Camera::se3CfW</a></div><div class="ttdeci">SE3 se3CfW</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00043">Bundle.h:43</a></div></div>
<div class="ttc" id="a00358_html_a6f349984d701630586ac4955c35733f7"><div class="ttname"><a href="../../df/d73/a00358.html#a6f349984d701630586ac4955c35733f7">TooN::SE3::get_rotation</a></div><div class="ttdeci">SO3&lt; Precision &gt; &amp; get_rotation()</div><div class="ttdoc">Returns the rotation part of the transformation as a SO3. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/a00573_source.html#l00064">se3.h:64</a></div></div>
<div class="ttc" id="a00035_html_ae89eaca6fd79e53d22e4556654dee4fe"><div class="ttname"><a href="../../d4/d8c/a00035.html#ae89eaca6fd79e53d22e4556654dee4fe">Bundle::mgvnBundleCout</a></div><div class="ttdeci">int mgvnBundleCout</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00150">Bundle.h:150</a></div></div>
<div class="ttc" id="a00027_html_a7b8759d7fec56601d10e60ae487b96f7"><div class="ttname"><a href="../../d0/d33/a00027.html#a7b8759d7fec56601d10e60ae487b96f7">ATANCamera::Project</a></div><div class="ttdeci">Vector&lt; 2 &gt; Project(const Vector&lt; 2 &gt; &amp;camframe)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/a00479_source.html#l00109">ATANCamera.cpp:109</a></div></div>
<div class="ttc" id="a00164_html_a37d016543bd5a32e324eae787afb4298"><div class="ttname"><a href="../../db/ddf/a00164.html#a37d016543bd5a32e324eae787afb4298">ExtendedMapPoint::m3V</a></div><div class="ttdeci">Matrix&lt; 3 &gt; m3V</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00064">Bundle.h:64</a></div></div>
<div class="ttc" id="a00250_html_a3cb2a838d808566c0a2a7608078a631f"><div class="ttname"><a href="../../d0/da7/a00250.html#a3cb2a838d808566c0a2a7608078a631f">Meas::m63W</a></div><div class="ttdeci">Matrix&lt; 6, 3 &gt; m63W</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00094">Bundle.h:94</a></div></div>
<div class="ttc" id="a00250_html_a171c59779a71948990c27e9d937d4b2c"><div class="ttname"><a href="../../d0/da7/a00250.html#a171c59779a71948990c27e9d937d4b2c">Meas::v2Epsilon</a></div><div class="ttdeci">Vector&lt; 2 &gt; v2Epsilon</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00091">Bundle.h:91</a></div></div>
<div class="ttc" id="a00547_html"><div class="ttname"><a href="../../d9/d8b/a00547.html">MEstimator.h</a></div></div>
<div class="ttc" id="a00164_html"><div class="ttname"><a href="../../db/ddf/a00164.html">ExtendedMapPoint</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00058">Bundle.h:58</a></div></div>
<div class="ttc" id="a00035_html_a22357272762d823c2a891ea85edb09e6"><div class="ttname"><a href="../../d4/d8c/a00035.html#a22357272762d823c2a891ea85edb09e6">Bundle::mgvdUpdateConvergenceLimit</a></div><div class="ttdeci">double mgvdUpdateConvergenceLimit</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00149">Bundle.h:149</a></div></div>
<div class="ttc" id="a00519_html_afa9142e1a9c29c3a1c3d3c753d634237"><div class="ttname"><a href="../../dd/d4d/a00519.html#afa9142e1a9c29c3a1c3d3c753d634237">BundleMEstimator</a></div><div class="ttdeci">const std::string BundleMEstimator</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00026">globals.h:26</a></div></div>
<div class="ttc" id="a00035_html_a56e6ba045da1462be2b8e2215e6f6727"><div class="ttname"><a href="../../d4/d8c/a00035.html#a56e6ba045da1462be2b8e2215e6f6727">Bundle::mbHitMaxIterations</a></div><div class="ttdeci">bool mbHitMaxIterations</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00144">Bundle.h:144</a></div></div>
<div class="ttc" id="a00036_html_ac4a084203a2f051c9b41ef2f552517d1"><div class="ttname"><a href="../../de/d8c/a00036.html#ac4a084203a2f051c9b41ef2f552517d1">Camera::bFixed</a></div><div class="ttdeci">bool bFixed</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00042">Bundle.h:42</a></div></div>
<div class="ttc" id="a00250_html"><div class="ttname"><a href="../../d0/da7/a00250.html">Meas</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00076">Bundle.h:76</a></div></div>
<div class="ttc" id="a00035_html_a150deeb75e0b4a641cabacb906546ecb"><div class="ttname"><a href="../../d4/d8c/a00035.html#a150deeb75e0b4a641cabacb906546ecb">Bundle::ProjectAndFindSquaredError</a></div><div class="ttdeci">void ProjectAndFindSquaredError(Meas &amp;meas)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00166">Bundle.cpp:166</a></div></div>
<div class="ttc" id="a00035_html_a6e6cf9981efa64e2b2f2594e71be8851"><div class="ttname"><a href="../../d4/d8c/a00035.html#a6e6cf9981efa64e2b2f2594e71be8851">Bundle::mnStartRow</a></div><div class="ttdeci">int mnStartRow</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00139">Bundle.h:139</a></div></div>
<div class="ttc" id="a00523_html_addcb08d3afb49cc2c43beb32546b9aa2"><div class="ttname"><a href="../../d0/de7/a00523.html#addcb08d3afb49cc2c43beb32546b9aa2">TooN::unproject</a></div><div class="ttdeci">Vector&lt;(Size==Dynamic?Dynamic:Size+1), Precision &gt; unproject(const Vector&lt; Size, Precision, Base &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d14/a00522_source.html#l00166">helpers.h:166</a></div></div>
<div class="ttc" id="a00035_html_a6da9c6a4ca90ebc748231f990fdc1d24"><div class="ttname"><a href="../../d4/d8c/a00035.html#a6da9c6a4ca90ebc748231f990fdc1d24">Bundle::mbConverged</a></div><div class="ttdeci">bool mbConverged</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00143">Bundle.h:143</a></div></div>
<div class="ttc" id="a00250_html_afd36be4f2c034fb894b2b4ceae296fe4"><div class="ttname"><a href="../../d0/da7/a00250.html#afd36be4f2c034fb894b2b4ceae296fe4">Meas::v3Cam</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3Cam</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00099">Bundle.h:99</a></div></div>
<div class="ttc" id="a00035_html_a539da777aa7e730a718bff15db6f817b"><div class="ttname"><a href="../../d4/d8c/a00035.html#a539da777aa7e730a718bff15db6f817b">Bundle::Do_LM_Step</a></div><div class="ttdeci">bool Do_LM_Step(bool *pbAbortSignal, double *lastMdSigmaSquared)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00187">Bundle.cpp:187</a></div></div>
<div class="ttc" id="a00164_html_a197531e9cd7b27dbc909dde2de38d95a"><div class="ttname"><a href="../../db/ddf/a00164.html#a197531e9cd7b27dbc909dde2de38d95a">ExtendedMapPoint::nOutliers</a></div><div class="ttdeci">int nOutliers</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00069">Bundle.h:69</a></div></div>
<div class="ttc" id="a00241_html"><div class="ttname"><a href="../../d6/db6/a00241.html">TooN::Matrix&lt; 6 &gt;</a></div></div>
<div class="ttc" id="a00035_html_a6a863117606a50a3f186ce9794613b85"><div class="ttname"><a href="../../d4/d8c/a00035.html#a6a863117606a50a3f186ce9794613b85">Bundle::mdSigmaSquared</a></div><div class="ttdeci">double mdSigmaSquared</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00140">Bundle.h:140</a></div></div>
<div class="ttc" id="a00487_html"><div class="ttname"><a href="../../dd/d9c/a00487.html">Cholesky.h</a></div></div>
<div class="ttc" id="a00049_html_adf85bb1a4d9d63e39c0a5b82f9f46ac5"><div class="ttname"><a href="../../d2/dee/a00049.html#adf85bb1a4d9d63e39c0a5b82f9f46ac5">TooN::Cholesky::get_inverse</a></div><div class="ttdeci">Matrix&lt; Size, Size, Precision &gt; get_inverse()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d9c/a00487_source.html#l00196">Cholesky.h:196</a></div></div>
<div class="ttc" id="a00035_html_ae70602edb7b657e68e4219d3f66c491b"><div class="ttname"><a href="../../d4/d8c/a00035.html#ae70602edb7b657e68e4219d3f66c491b">Bundle::AddCamera</a></div><div class="ttdeci">int AddCamera(SE3&lt;&gt; se3CamFromWorld, bool bFixed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00045">Bundle.cpp:45</a></div></div>
<div class="ttc" id="a00035_html_ae0021b043e59d902a87a0a5c91f17c2a"><div class="ttname"><a href="../../d4/d8c/a00035.html#ae0021b043e59d902a87a0a5c91f17c2a">Bundle::mdLambdaFactor</a></div><div class="ttdeci">double mdLambdaFactor</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00142">Bundle.h:142</a></div></div>
<div class="ttc" id="a00036_html_a0ab90dd2552d9f611dc17076212d8c42"><div class="ttname"><a href="../../de/d8c/a00036.html#a0ab90dd2552d9f611dc17076212d8c42">Camera::m6U</a></div><div class="ttdeci">Matrix&lt; 6 &gt; m6U</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00045">Bundle.h:45</a></div></div>
<div class="ttc" id="a00250_html_a709bd4c18cac0ffc5aa44b15629c8783"><div class="ttname"><a href="../../d0/da7/a00250.html#a709bd4c18cac0ffc5aa44b15629c8783">Meas::dErrorSquared</a></div><div class="ttdeci">double dErrorSquared</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00100">Bundle.h:100</a></div></div>
<div class="ttc" id="a00250_html_adad84be45c6ac5f8abe9d003ae5b15b5"><div class="ttname"><a href="../../d0/da7/a00250.html#adad84be45c6ac5f8abe9d003ae5b15b5">Meas::v2Found</a></div><div class="ttdeci">Vector&lt; 2 &gt; v2Found</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00090">Bundle.h:90</a></div></div>
<div class="ttc" id="a00035_html_a30c11c59f067b47ead152fd467e58b0a"><div class="ttname"><a href="../../d4/d8c/a00035.html#a30c11c59f067b47ead152fd467e58b0a">Bundle::GenerateOffDiagScripts</a></div><div class="ttdeci">void GenerateOffDiagScripts()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00580">Bundle.cpp:580</a></div></div>
<div class="ttc" id="a00035_html_a48c9f7eebdfc5f79e9e43e3665725975"><div class="ttname"><a href="../../d4/d8c/a00035.html#a48c9f7eebdfc5f79e9e43e3665725975">Bundle::FindNewError</a></div><div class="ttdeci">double FindNewError()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00537">Bundle.cpp:537</a></div></div>
<div class="ttc" id="a00035_html_a214f74212f2043b03ac2e349dd24e2fb"><div class="ttname"><a href="../../d4/d8c/a00035.html#a214f74212f2043b03ac2e349dd24e2fb">Bundle::mMeasList</a></div><div class="ttdeci">std::list&lt; Meas &gt; mMeasList</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00133">Bundle.h:133</a></div></div>
<div class="ttc" id="a00035_html_a671f50417b518e0930bfcc09a1b1b41e"><div class="ttname"><a href="../../d4/d8c/a00035.html#a671f50417b518e0930bfcc09a1b1b41e">Bundle::AddMeas</a></div><div class="ttdeci">void AddMeas(int nCam, int nPoint, Vector&lt; 2 &gt; v2Pos, double dSigmaSquared)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00080">Bundle.cpp:80</a></div></div>
<div class="ttc" id="a00358_html"><div class="ttname"><a href="../../df/d73/a00358.html">TooN::SE3</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/a00573_source.html#l00050">se3.h:50</a></div></div>
<div class="ttc" id="a00035_html_aed90a60c6f2610155e62432832b1a797"><div class="ttname"><a href="../../d4/d8c/a00035.html#aed90a60c6f2610155e62432832b1a797">Bundle::mpbAbortSignal</a></div><div class="ttdeci">bool * mpbAbortSignal</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00152">Bundle.h:152</a></div></div>
<div class="ttc" id="a00035_html_a37fb3a41680778389df092cdd90e2b15"><div class="ttname"><a href="../../d4/d8c/a00035.html#a37fb3a41680778389df092cdd90e2b15">Bundle::Bundle</a></div><div class="ttdeci">Bundle(const ATANCamera &amp;TCam)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00034">Bundle.cpp:34</a></div></div>
<div class="ttc" id="a00250_html_ab0e7b8d9424ef99b8203257d7083e83a"><div class="ttname"><a href="../../d0/da7/a00250.html#ab0e7b8d9424ef99b8203257d7083e83a">Meas::p</a></div><div class="ttdeci">int p</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00082">Bundle.h:82</a></div></div>
<div class="ttc" id="a00523_html_a031ca1778b1ff08a51f74daa820bb5d7"><div class="ttname"><a href="../../d0/de7/a00523.html#a031ca1778b1ff08a51f74daa820bb5d7">TooN::exp</a></div><div class="ttdeci">Matrix&lt; R, C, P &gt; exp(const Matrix&lt; R, C, P, B &gt; &amp;m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d14/a00522_source.html#l00284">helpers.h:284</a></div></div>
<div class="ttc" id="a00250_html_a74feb9f272e220fa975e10bf30efe7ba"><div class="ttname"><a href="../../d0/da7/a00250.html#a74feb9f272e220fa975e10bf30efe7ba">Meas::m26A</a></div><div class="ttdeci">Matrix&lt; 2, 6 &gt; m26A</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00092">Bundle.h:92</a></div></div>
<div class="ttc" id="a00271_html_a3612a5381e369b88d44c68b3ee18ba0d"><div class="ttname"><a href="../../dd/d86/a00271.html#a3612a5381e369b88d44c68b3ee18ba0d">OffDiagScriptEntry::k</a></div><div class="ttdeci">int k</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00054">Bundle.h:54</a></div></div>
<div class="ttc" id="a00632_html"><div class="ttname"><a href="../../d4/d2a/a00632.html">std</a></div></div>
<div class="ttc" id="a00035_html_a4965716bca1e5a6ee6ea83505e0c8872"><div class="ttname"><a href="../../d4/d8c/a00035.html#a4965716bca1e5a6ee6ea83505e0c8872">Bundle::mvCameras</a></div><div class="ttdeci">std::vector&lt; Camera &gt; mvCameras</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00132">Bundle.h:132</a></div></div>
<div class="ttc" id="a00049_html"><div class="ttname"><a href="../../d2/dee/a00049.html">TooN::Cholesky</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d9c/a00487_source.html#l00069">Cholesky.h:69</a></div></div>
<div class="ttc" id="a00164_html_ada0f036beb33aee0af5425e66dcb4c01"><div class="ttname"><a href="../../db/ddf/a00164.html#ada0f036beb33aee0af5425e66dcb4c01">ExtendedMapPoint::nMeasurements</a></div><div class="ttdeci">int nMeasurements</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00068">Bundle.h:68</a></div></div>
<div class="ttc" id="a00519_html_abd70d42818792b1e5d83a58fbc72dd18"><div class="ttname"><a href="../../dd/d4d/a00519.html#abd70d42818792b1e5d83a58fbc72dd18">BundleMinTukeySigma</a></div><div class="ttdeci">const double BundleMinTukeySigma</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00027">globals.h:27</a></div></div>
<div class="ttc" id="a00250_html_a9bfb1b901c5eba5f13c33069d4991e9c"><div class="ttname"><a href="../../d0/da7/a00250.html#a9bfb1b901c5eba5f13c33069d4991e9c">Meas::bBad</a></div><div class="ttdeci">bool bBad</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00088">Bundle.h:88</a></div></div>
<div class="ttc" id="a00035_html_af18c4caf50d892e95ac4dd28a6af7df3"><div class="ttname"><a href="../../d4/d8c/a00035.html#af18c4caf50d892e95ac4dd28a6af7df3">Bundle::mCamera</a></div><div class="ttdeci">ATANCamera mCamera</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00137">Bundle.h:137</a></div></div>
<div class="ttc" id="a00271_html_a8c2d25fd8c758dfd1bc154993265a63b"><div class="ttname"><a href="../../dd/d86/a00271.html#a8c2d25fd8c758dfd1bc154993265a63b">OffDiagScriptEntry::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00053">Bundle.h:53</a></div></div>
<div class="ttc" id="a00036_html_a525ab230a879409ada62de33e348aa73"><div class="ttname"><a href="../../de/d8c/a00036.html#a525ab230a879409ada62de33e348aa73">Camera::v6EpsilonA</a></div><div class="ttdeci">Vector&lt; 6 &gt; v6EpsilonA</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00046">Bundle.h:46</a></div></div>
<div class="ttc" id="a00035_html_ade4e715b810343aac84a4dd4289a5988"><div class="ttname"><a href="../../d4/d8c/a00035.html#ade4e715b810343aac84a4dd4289a5988">Bundle::mnAccepted</a></div><div class="ttdeci">int mnAccepted</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00146">Bundle.h:146</a></div></div>
<div class="ttc" id="a00164_html_acd19d8aaeee9346c22c14075af6a6c9b"><div class="ttname"><a href="../../db/ddf/a00164.html#acd19d8aaeee9346c22c14075af6a6c9b">ExtendedMapPoint::v3Pos</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3Pos</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00062">Bundle.h:62</a></div></div>
<div class="ttc" id="a00035_html_a82e68ed2de942674776c4a5c9b0c93c8"><div class="ttname"><a href="../../d4/d8c/a00035.html#a82e68ed2de942674776c4a5c9b0c93c8">Bundle::ModifyLambda_BadStep</a></div><div class="ttdeci">void ModifyLambda_BadStep()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00618">Bundle.cpp:618</a></div></div>
<div class="ttc" id="a00035_html_a17ff2ab36bede8715c136030f5d66bac"><div class="ttname"><a href="../../d4/d8c/a00035.html#a17ff2ab36bede8715c136030f5d66bac">Bundle::GetOutliers</a></div><div class="ttdeci">std::set&lt; int &gt; GetOutliers()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00635">Bundle.cpp:635</a></div></div>
<div class="ttc" id="a00519_html_ac9e27bd27207a6b97da14573eef3d85b"><div class="ttname"><a href="../../dd/d4d/a00519.html#ac9e27bd27207a6b97da14573eef3d85b">BundleUpdateSquaredConvergenceLimit</a></div><div class="ttdeci">const double BundleUpdateSquaredConvergenceLimit</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00022">globals.h:22</a></div></div>
<div class="ttc" id="a00035_html_a8ecc89fd42395a78fc286b237f7f4007"><div class="ttname"><a href="../../d4/d8c/a00035.html#a8ecc89fd42395a78fc286b237f7f4007">Bundle::GetCamera</a></div><div class="ttdeci">SE3 GetCamera(int n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00630">Bundle.cpp:630</a></div></div>
<div class="ttc" id="a00164_html_aa39606136143ab8c89f7f9d3f080482b"><div class="ttname"><a href="../../db/ddf/a00164.html#aa39606136143ab8c89f7f9d3f080482b">ExtendedMapPoint::vOffDiagonalScript</a></div><div class="ttdeci">std::vector&lt; OffDiagScriptEntry &gt; vOffDiagonalScript</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00071">Bundle.h:71</a></div></div>
<div class="ttc" id="a00035_html_a5de538c7a4aa6eb4915c9c2ec022f706"><div class="ttname"><a href="../../d4/d8c/a00035.html#a5de538c7a4aa6eb4915c9c2ec022f706">Bundle::ClearAccumulators</a></div><div class="ttdeci">void ClearAccumulators()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00095">Bundle.cpp:95</a></div></div>
<div class="ttc" id="a00250_html_afaa80fd03932c3fa501907a8dff5b7cb"><div class="ttname"><a href="../../d0/da7/a00250.html#afaa80fd03932c3fa501907a8dff5b7cb">Meas::m2CamDerivs</a></div><div class="ttdeci">Matrix&lt; 2 &gt; m2CamDerivs</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00101">Bundle.h:101</a></div></div>
<div class="ttc" id="a00484_html_a85fa5b4a1cfa51a1e3906bacb30f450a"><div class="ttname"><a href="../../d8/d89/a00484.html#a85fa5b4a1cfa51a1e3906bacb30f450a">BundleTriangle_UpdateM3V_LL</a></div><div class="ttdeci">void BundleTriangle_UpdateM3V_LL(Matrix&lt; 3 &gt; &amp;m3V, Matrix&lt; 2, 3 &gt; &amp;m23B)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00026">Bundle.cpp:26</a></div></div>
<div class="ttc" id="a00035_html_a6e02e2734d763c902a457c2ca6496b3a"><div class="ttname"><a href="../../d4/d8c/a00035.html#a6e02e2734d763c902a457c2ca6496b3a">Bundle::GetPoint</a></div><div class="ttdeci">Vector&lt; 3 &gt; GetPoint(int n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00625">Bundle.cpp:625</a></div></div>
<div class="ttc" id="a00036_html_aa97ebd03827e09ad7ea072eecf80026e"><div class="ttname"><a href="../../de/d8c/a00036.html#aa97ebd03827e09ad7ea072eecf80026e">Camera::nStartRow</a></div><div class="ttdeci">int nStartRow</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00047">Bundle.h:47</a></div></div>
<div class="ttc" id="a00164_html_ad1292ecc4603bd068dfb76d26f1d8c2e"><div class="ttname"><a href="../../db/ddf/a00164.html#ad1292ecc4603bd068dfb76d26f1d8c2e">ExtendedMapPoint::m3VStarInv</a></div><div class="ttdeci">Matrix&lt; 3 &gt; m3VStarInv</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00066">Bundle.h:66</a></div></div>
<div class="ttc" id="a00035_html_a648ab9410d3de60042bc70236232941d"><div class="ttname"><a href="../../d4/d8c/a00035.html#a648ab9410d3de60042bc70236232941d">Bundle::GenerateMeasLUTs</a></div><div class="ttdeci">void GenerateMeasLUTs()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00565">Bundle.cpp:565</a></div></div>
<div class="ttc" id="a00250_html_a70eb53731067ad51799651e3b900ca9d"><div class="ttname"><a href="../../d0/da7/a00250.html#a70eb53731067ad51799651e3b900ca9d">Meas::dSqrtInvNoise</a></div><div class="ttdeci">double dSqrtInvNoise</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00096">Bundle.h:96</a></div></div>
<div class="ttc" id="a00451_html"><div class="ttname"><a href="../../d9/d69/a00451.html">TooN::Vector&lt; 3 &gt;</a></div></div>
<div class="ttc" id="a00035_html_a81618fea88a96c2d2325ccb9dba82370"><div class="ttname"><a href="../../d4/d8c/a00035.html#a81618fea88a96c2d2325ccb9dba82370">Bundle::mgvnMaxIterations</a></div><div class="ttdeci">int mgvnMaxIterations</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00148">Bundle.h:148</a></div></div>
<div class="ttc" id="a00035_html_a379dd6826aeccef5a2fbe3855a65e0d1"><div class="ttname"><a href="../../d4/d8c/a00035.html#a379dd6826aeccef5a2fbe3855a65e0d1">Bundle::mvPoints</a></div><div class="ttdeci">std::vector&lt; ExtendedMapPoint &gt; mvPoints</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00131">Bundle.h:131</a></div></div>
<div class="ttc" id="a00519_html_a7499cd10bd65903cd85f1ed6b4c544a7"><div class="ttname"><a href="../../dd/d4d/a00519.html#a7499cd10bd65903cd85f1ed6b4c544a7">BundleCout</a></div><div class="ttdeci">const int BundleCout</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00023">globals.h:23</a></div></div>
<div class="ttc" id="a00035_html_a69935075648a203647d2460b18aa300d"><div class="ttname"><a href="../../d4/d8c/a00035.html#a69935075648a203647d2460b18aa300d">Bundle::mvOutlierMeasurementIdx</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int, int &gt; &gt; mvOutlierMeasurementIdx</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00134">Bundle.h:134</a></div></div>
<div class="ttc" id="a00035_html_af45f2153795ba00d217dcecd3e1494f9"><div class="ttname"><a href="../../d4/d8c/a00035.html#af45f2153795ba00d217dcecd3e1494f9">Bundle::mnCamsToUpdate</a></div><div class="ttdeci">int mnCamsToUpdate</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00138">Bundle.h:138</a></div></div>
<div class="ttc" id="a00027_html_ac2d98569d643dc40416fbc5fa1abba19"><div class="ttname"><a href="../../d0/d33/a00027.html#ac2d98569d643dc40416fbc5fa1abba19">ATANCamera::GetProjectionDerivs</a></div><div class="ttdeci">Matrix&lt; 2, 2 &gt; GetProjectionDerivs()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/a00479_source.html#l00172">ATANCamera.cpp:172</a></div></div>
<div class="ttc" id="a00485_html"><div class="ttname"><a href="../../d6/d1a/a00485.html">Bundle.h</a></div></div>
<div class="ttc" id="a00035_html_ae91413d21ab3299b200edd9740cedf40"><div class="ttname"><a href="../../d4/d8c/a00035.html#ae91413d21ab3299b200edd9740cedf40">Bundle::mvMeasLUTs</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; Meas * &gt; &gt; mvMeasLUTs</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00135">Bundle.h:135</a></div></div>
<div class="ttc" id="a00523_html_ae9b2cb48b0a8e681b3dd1ac86f8b9d97"><div class="ttname"><a href="../../d0/de7/a00523.html#ae9b2cb48b0a8e681b3dd1ac86f8b9d97">TooN::Zeros</a></div><div class="ttdeci">static Operator&lt; Internal::Zero &gt; Zeros</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de9/a00552_source.html#l00727">objects.h:727</a></div></div>
<div class="ttc" id="a00523_html_aba317fcd024f7f6e135433caa8d0d6c4"><div class="ttname"><a href="../../d0/de7/a00523.html#aba317fcd024f7f6e135433caa8d0d6c4">TooN::project</a></div><div class="ttdeci">Vector&lt;(Size==Dynamic?Dynamic:Size-1), Precision &gt; project(const Vector&lt; Size, Precision, Base &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d14/a00522_source.html#l00157">helpers.h:157</a></div></div>
<div class="ttc" id="a00523_html_a6630004f166284bce546c4518bea54e9"><div class="ttname"><a href="../../d0/de7/a00523.html#a6630004f166284bce546c4518bea54e9">TooN::isnan</a></div><div class="ttdeci">bool isnan(const Vector&lt; S, P, B &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d14/a00522_source.html#l00308">helpers.h:308</a></div></div>
<div class="ttc" id="a00484_html_a088658376a5aca80742a76db7875bc51"><div class="ttname"><a href="../../d8/d89/a00484.html#a088658376a5aca80742a76db7875bc51">BundleTriangle_UpdateM6U_LL</a></div><div class="ttdeci">void BundleTriangle_UpdateM6U_LL(Matrix&lt; 6 &gt; &amp;m6U, Matrix&lt; 2, 6 &gt; &amp;m26A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00020">Bundle.cpp:20</a></div></div>
<div class="ttc" id="a00484_html_a101fd144d7d407e15633eba37102f1ed"><div class="ttname"><a href="../../d8/d89/a00484.html#a101fd144d7d407e15633eba37102f1ed">cout</a></div><div class="ttdeci">#define cout</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00016">Bundle.cpp:16</a></div></div>
<div class="ttc" id="a00036_html"><div class="ttname"><a href="../../de/d8c/a00036.html">Camera</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00040">Bundle.h:40</a></div></div>
<div class="ttc" id="a00035_html_a4a797da14a8d29f9bf5f3e39303d3492"><div class="ttname"><a href="../../d4/d8c/a00035.html#a4a797da14a8d29f9bf5f3e39303d3492">Bundle::GetOutlierMeasurements</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; int, int &gt; &gt; GetOutlierMeasurements()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d89/a00484_source.html#l00649">Bundle.cpp:649</a></div></div>
<div class="ttc" id="a00519_html_ad1cb892ae175c8d7f595be47e6e16c4b"><div class="ttname"><a href="../../dd/d4d/a00519.html#ad1cb892ae175c8d7f595be47e6e16c4b">BundleMaxIterations</a></div><div class="ttdeci">const int BundleMaxIterations</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d4d/a00519_source.html#l00021">globals.h:21</a></div></div>
<div class="ttc" id="a00271_html"><div class="ttname"><a href="../../dd/d86/a00271.html">OffDiagScriptEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00051">Bundle.h:51</a></div></div>
<div class="ttc" id="a00164_html_a4865341c971f8cab239995a469363926"><div class="ttname"><a href="../../db/ddf/a00164.html#a4865341c971f8cab239995a469363926">ExtendedMapPoint::v3EpsilonB</a></div><div class="ttdeci">Vector&lt; 3 &gt; v3EpsilonB</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00065">Bundle.h:65</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 25 2015 17:53:27 for SLAMflex SE by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
